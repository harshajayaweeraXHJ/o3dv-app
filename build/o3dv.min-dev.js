var OV=(()=>{var Gi=Object.defineProperty;var Pn=Object.getOwnPropertyDescriptor;var On=Object.getOwnPropertyNames;var Bn=Object.prototype.hasOwnProperty;var Ln=(o,e)=>{for(var t in e)Gi(o,t,{get:e[t],enumerable:!0})},Un=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of On(e))!Bn.call(o,i)&&i!==t&&Gi(o,i,{get:()=>e[i],enumerable:!(r=Pn(e,i))||r.enumerable});return o};var zn=o=>Un(Gi({},"__esModule",{value:!0}),o);var _n={};Ln(_n,{AddCheckbox:()=>pn,AddCoord2D:()=>nn,AddCoord3D:()=>ri,AddDiv:()=>br,AddDomElement:()=>ke,AddRangeSlider:()=>xn,AddSelect:()=>gn,AddToggle:()=>Cn,ArrayBufferToAsciiString:()=>Qi,ArrayBufferToUtf8String:()=>J,ArrayToColor:()=>si,ArrayToCoord3D:()=>we,ArrayToQuaternion:()=>Ze,AsciiStringToArrayBuffer:()=>$i,Base64DataURIToArrayBuffer:()=>it,BezierTweenFunction:()=>En,BigEps:()=>xr,BinaryReader:()=>ne,BinaryWriter:()=>Ie,BoundingBoxCalculator3D:()=>Bt,Box3D:()=>ht,CalculateSurfaceArea:()=>Vn,CalculateTriangleNormal:()=>ut,CalculateVolume:()=>Dn,Camera:()=>Ae,CameraIsEqual3D:()=>Gr,CheckModel:()=>Gn,ClearDomElement:()=>on,ClickDetector:()=>Ar,Color:()=>F,ColorComponentFromFloat:()=>fe,ColorFromFloatComponents:()=>Ve,ColorIsEqual:()=>je,ColorToHexString:()=>ni,ConvertColorToThreeColor:()=>de,ConvertMeshToMeshBuffer:()=>or,ConvertModelToThreeObject:()=>wi,ConvertThreeColorToColor:()=>Ft,ConvertThreeGeometryToMesh:()=>ot,Coord2D:()=>v,Coord3D:()=>y,Coord4D:()=>Xe,CoordDistance2D:()=>yr,CoordDistance3D:()=>Ce,CoordIsEqual2D:()=>Se,CoordIsEqual3D:()=>ge,CopyObjectAttributes:()=>Mt,CreateDiv:()=>Tn,CreateDomElement:()=>fi,CreateModelUrlParameters:()=>Fn,CreateObjectUrl:()=>nt,CreateObjectUrlWithMimeType:()=>pr,CreateUrlBuilder:()=>qi,CreateUrlParser:()=>Rn,CrossVector3D:()=>be,DegRad:()=>Je,Direction:()=>R,DotVector3D:()=>Tr,EmbeddedViewer:()=>_r,Eps:()=>en,ExportedFile:()=>W,Exporter:()=>Si,Exporter3dm:()=>lr,ExporterBase:()=>ie,ExporterGltf:()=>ar,ExporterModel:()=>ur,ExporterObj:()=>hr,ExporterOff:()=>fr,ExporterPly:()=>dr,ExporterSettings:()=>Wr,ExporterStl:()=>mr,FaceMaterial:()=>Rt,File:()=>lt,FileFormat:()=>L,FileList:()=>at,FileSource:()=>X,FinalizeModel:()=>Ti,FlipMeshTrianglesOrientation:()=>Ci,GenerateCuboid:()=>Ei,GenerateCylinder:()=>yi,GeneratePlatonicSolid:()=>Ii,GenerateSphere:()=>Mi,Generator:()=>$e,GeneratorHelper:()=>pt,GeneratorParams:()=>ct,GetBoundingBox:()=>Di,GetDefaultCamera:()=>ci,GetDomElementClientCoordinates:()=>We,GetDomElementExternalHeight:()=>ui,GetDomElementExternalWidth:()=>ai,GetDomElementInnerDimensions:()=>hi,GetDomElementOuterHeight:()=>dn,GetDomElementOuterWidth:()=>fn,GetFileExtension:()=>De,GetFileExtensionFromMimeType:()=>Ye,GetFileName:()=>Y,GetIntegerFromStyle:()=>K,GetMeshType:()=>Qe,GetShadingType:()=>li,GetShadingTypeOfObject:()=>Ni,GetTetrahedronSignedVolume:()=>Ji,GetTopology:()=>Vi,GetTriangleArea:()=>Yi,HasDefaultMaterial:()=>Sn,HasHighpDriverIssue:()=>oi,HexStringToColor:()=>rn,ImportError:()=>tt,ImportErrorCode:()=>_e,ImportResult:()=>Or,ImportSettings:()=>tr,Importer:()=>rr,Importer3dm:()=>_t,Importer3ds:()=>jt,ImporterBase:()=>k,ImporterFileAccessor:()=>Br,ImporterGltf:()=>kt,ImporterIfc:()=>Wt,ImporterO3dv:()=>qt,ImporterObj:()=>Xt,ImporterOff:()=>Yt,ImporterPly:()=>Jt,ImporterStl:()=>Kt,ImporterThree3mf:()=>er,ImporterThreeBase:()=>He,ImporterThreeDae:()=>Qt,ImporterThreeFbx:()=>Zt,ImporterThreeSvg:()=>Ai,ImporterThreeWrl:()=>$t,Init3DViewerElement:()=>Xi,Init3DViewerElements:()=>Nn,InsertDomElementAfter:()=>an,InsertDomElementBefore:()=>ln,IntegerToHexString:()=>se,IsDefined:()=>yt,IsDomElementVisible:()=>hn,IsEqual:()=>P,IsEqualEps:()=>gr,IsGreater:()=>ei,IsGreaterOrEqual:()=>At,IsLower:()=>wt,IsLowerOrEqual:()=>St,IsModelEmpty:()=>zt,IsNegative:()=>Gt,IsPositive:()=>Cr,IsPowerOfTwo:()=>Bi,IsSolid:()=>wn,IsZero:()=>bt,LinearToSRGB:()=>st,LinearTweenFunction:()=>yn,LoadExternalLibrary:()=>he,MaterialBase:()=>Mr,MaterialType:()=>ee,Matrix:()=>O,MatrixIsEqual:()=>gi,MeasureTool:()=>ti,Mesh:()=>j,MeshBuffer:()=>kr,MeshInstance:()=>dt,MeshInstanceId:()=>qe,MeshPrimitiveBuffer:()=>jr,MeshType:()=>Le,Model:()=>Ht,ModelObject3D:()=>Be,ModelToThreeConversionOutput:()=>nr,ModelToThreeConversionParams:()=>ir,MouseInteraction:()=>wr,NameFromLine:()=>ze,Navigation:()=>Dt,NavigationType:()=>le,NextPowerOfTwo:()=>vn,Node:()=>pe,NodeType:()=>Ge,Object3D:()=>Ir,Octree:()=>Lt,OctreeNode:()=>ft,ParabolicTweenFunction:()=>di,ParameterConverter:()=>Z,ParameterListBuilder:()=>Lr,ParameterListParser:()=>Ur,ParametersFromLine:()=>ve,PhongMaterial:()=>q,PhysicalMaterial:()=>Oe,Property:()=>re,PropertyGroup:()=>Te,PropertyType:()=>ce,Quaternion:()=>me,QuaternionFromAxisAngle:()=>xi,QuaternionFromXYZ:()=>In,QuaternionIsEqual:()=>Mn,RadDeg:()=>tn,ReadFile:()=>Zr,ReadLines:()=>Me,ReplaceDefaultMaterialColor:()=>An,RequestUrl:()=>Kr,RevokeObjectUrl:()=>$r,RunTaskAsync:()=>cr,RunTasks:()=>Xr,RunTasksBatch:()=>Yr,SRGBToLinear:()=>Pe,SetDomElementHeight:()=>Fi,SetDomElementOuterHeight:()=>cn,SetDomElementOuterWidth:()=>mn,SetDomElementWidth:()=>Ri,SetExternalLibLocation:()=>Zi,SetThreeMeshPolygonOffset:()=>mi,ShadingModel:()=>Rr,ShadingType:()=>oe,ShowDomElement:()=>un,SubCoord2D:()=>Er,SubCoord3D:()=>$,TaskRunner:()=>Et,TextWriter:()=>ue,TextureIsEqual:()=>sn,TextureMap:()=>ye,TextureMapIsEqual:()=>Ke,ThreeConversionStateHandler:()=>zr,ThreeModelLoader:()=>sr,ThreeNodeTree:()=>Hr,Topology:()=>Ut,TopologyEdge:()=>Nr,TopologyTriangle:()=>Vr,TopologyTriangleEdge:()=>Dr,TopologyVertex:()=>Fr,TouchInteraction:()=>Sr,TransformFileHostUrls:()=>Qr,TransformMesh:()=>Ue,Transformation:()=>H,TransformationIsEqual:()=>bn,TraverseThreeObject:()=>pi,Triangle:()=>U,TweenCoord3D:()=>Nt,UpVector:()=>vr,UpdateMaterialTransparency:()=>ae,Utf8StringToArrayBuffer:()=>It,ValueOrDefault:()=>Ne,VectorAngle3D:()=>ii,VectorLength3D:()=>vt,Viewer:()=>Ot,ViewerExtraGeometry:()=>Pt,ViewerGeometry:()=>Vt,WaitWhile:()=>Jr});var Et=class{constructor(){this.count=null,this.current=null,this.callbacks=null}Run(e,t){this.count=e,this.current=0,this.callbacks=t,e===0?this.TaskReady():this.RunOnce()}RunBatch(e,t,r){let i=0;e>0&&(i=parseInt((e-1)/t,10)+1),this.Run(i,{runTask:(n,s)=>{let l=n*t,a=Math.min((n+1)*t,e)-1;r.runTask(l,a,s)},onReady:r.onReady})}RunOnce(){setTimeout(()=>{this.callbacks.runTask(this.current,this.TaskReady.bind(this))},0)}TaskReady(){this.current+=1,this.current<this.count?this.RunOnce():this.callbacks.onReady&&this.callbacks.onReady()}};function cr(o){setTimeout(()=>{o()},0)}function Xr(o,e){new Et().Run(o,e)}function Yr(o,e,t){new Et().RunBatch(o,e,t)}function Jr(o){function e(t){t()&&setTimeout(()=>{e(t)},1)}e(o)}function yt(o){return o!=null}function Ne(o,e){return o??e}function Mt(o,e){if(!!yt(o))for(let t of Object.keys(o))yt(o[t])&&(e[t]=o[t])}var X={Url:1,File:2,Decompressed:3},L={Text:1,Binary:2};function Y(o){let e=o.lastIndexOf("/");e===-1&&(e=o.lastIndexOf("\\"));let t=o;e!==-1&&(t=o.substring(e+1));let r=t.indexOf("?");return r!==-1&&(t=t.substring(0,r)),decodeURI(t)}function De(o){let e=Y(o),t=e.lastIndexOf(".");return t===-1?"":e.substring(t+1).toLowerCase()}function Kr(o,e){return new Promise((t,r)=>{let i=new XMLHttpRequest;if(i.open("GET",o,!0),e===L.Text)i.responseType="text";else if(e===L.Binary)i.responseType="arraybuffer";else{r();return}i.onload=function(){i.status===200?t(i.response):r()},i.onerror=function(){r()},i.send(null)})}function Zr(o,e){return new Promise((t,r)=>{let i=new FileReader;i.onloadend=function(n){n.target.readyState===FileReader.DONE&&t(n.target.result)},i.onerror=function(){r()},e===L.Text?i.readAsText(o):e===L.Binary?i.readAsArrayBuffer(o):r()})}function Qr(o){for(let e=0;e<o.length;e++){let t=o[e];if(t.search(/www\.dropbox\.com/u)!==-1){t=t.replace("www.dropbox.com","dl.dropbox.com");let r=t.indexOf("?");r!==-1&&(t=t.substring(0,r)),o[e]=t}else if(t.search(/github\.com/u)!==-1){t=t.replace("github.com","raw.githubusercontent.com"),t=t.replace("/blob","");let r=t.indexOf("?");r!==-1&&(t=t.substring(0,r)),o[e]=t}}}var ue=class{constructor(){this.text="",this.indentation=0}GetText(){return this.text}Indent(e){this.indentation+=e}WriteArrayLine(e){this.WriteLine(e.join(" "))}WriteLine(e){this.WriteIndentation(),this.Write(e+`
`)}WriteIndentation(){for(let e=0;e<this.indentation;e++)this.Write("  ")}Write(e){this.text+=e}};var ne=class{constructor(e,t){this.arrayBuffer=e,this.dataView=new DataView(e),this.isLittleEndian=t,this.position=0}GetPosition(){return this.position}SetPosition(e){this.position=e}GetByteLength(){return this.arrayBuffer.byteLength}Skip(e){this.position=this.position+e}End(){return this.position>=this.arrayBuffer.byteLength}ReadArrayBuffer(e){let t=new Uint8Array(this.arrayBuffer),r=new ArrayBuffer(e),i=new Uint8Array(r),n=t.subarray(this.position,this.position+e);return i.set(n,0),this.position+=e,r}ReadBoolean8(){let e=this.dataView.getInt8(this.position);return this.position=this.position+1,!!e}ReadCharacter8(){let e=this.dataView.getInt8(this.position);return this.position=this.position+1,e}ReadUnsignedCharacter8(){let e=this.dataView.getUint8(this.position);return this.position=this.position+1,e}ReadInteger16(){let e=this.dataView.getInt16(this.position,this.isLittleEndian);return this.position=this.position+2,e}ReadUnsignedInteger16(){let e=this.dataView.getUint16(this.position,this.isLittleEndian);return this.position=this.position+2,e}ReadInteger32(){let e=this.dataView.getInt32(this.position,this.isLittleEndian);return this.position=this.position+4,e}ReadUnsignedInteger32(){let e=this.dataView.getUint32(this.position,this.isLittleEndian);return this.position=this.position+4,e}ReadFloat32(){let e=this.dataView.getFloat32(this.position,this.isLittleEndian);return this.position=this.position+4,e}ReadDouble64(){let e=this.dataView.getFloat64(this.position,this.isLittleEndian);return this.position=this.position+8,e}};var Ie=class{constructor(e,t){this.arrayBuffer=new ArrayBuffer(e),this.dataView=new DataView(this.arrayBuffer),this.isLittleEndian=t,this.position=0}GetPosition(){return this.position}SetPosition(e){this.position=e}End(){return this.position>=this.arrayBuffer.byteLength}GetBuffer(){return this.arrayBuffer}WriteArrayBuffer(e){let t=new Uint8Array(e);new Uint8Array(this.arrayBuffer).set(t,this.position),this.position+=e.byteLength}WriteBoolean8(e){this.dataView.setInt8(this.position,e?1:0),this.position=this.position+1}WriteCharacter8(e){this.dataView.setInt8(this.position,e),this.position=this.position+1}WriteUnsignedCharacter8(e){this.dataView.setUint8(this.position,e),this.position=this.position+1}WriteInteger16(e){this.dataView.setInt16(this.position,e,this.isLittleEndian),this.position=this.position+2}WriteUnsignedInteger16(e){this.dataView.setUint16(this.position,e,this.isLittleEndian),this.position=this.position+2}WriteInteger32(e){this.dataView.setInt32(this.position,e,this.isLittleEndian),this.position=this.position+4}WriteUnsignedInteger32(e){this.dataView.setUint32(this.position,e,this.isLittleEndian),this.position=this.position+4}WriteFloat32(e){this.dataView.setFloat32(this.position,e,this.isLittleEndian),this.position=this.position+4}WriteDouble64(e){this.dataView.setFloat64(this.position,e,this.isLittleEndian),this.position=this.position+8}};var vi=null,Ki=new Set;function Zi(o){vi=o}function he(o){return new Promise((e,t)=>{if(vi===null){t();return}if(Ki.has(o)){e();return}let r=document.createElement("script");r.type="text/javascript",r.src=vi+"/"+o,r.onload=()=>{Ki.add(o),e()},r.onerror=()=>{t()},document.head.appendChild(r)})}function J(o){return new TextDecoder("utf-8").decode(o)}function Qi(o){let e="",t=new Uint8Array(o);for(let r=0;r<t.byteLength;r++)e+=String.fromCharCode(t[r]);return e}function $i(o){let e=new ArrayBuffer(o.length),t=new Uint8Array(e);for(let r=0;r<o.length;r++)t[r]=o.charCodeAt(r);return e}function It(o){return new TextEncoder().encode(o).buffer}function it(o){let e="data:";if(!o.startsWith(e))return null;let t=o.indexOf(";");if(t===-1)return null;let r=o.indexOf(",");if(r===-1)return null;let i=o.substring(e.length,e.length+t-5),n=atob(o.substring(r+1)),s=new ArrayBuffer(n.length),l=new Uint8Array(s);for(let a=0;a<n.length;a++)l[a]=n.charCodeAt(a);return{mimeType:i,buffer:s}}function Ye(o){if(o==null)return"";let e=o.split("/");return e.length===0?"":e[e.length-1]}function nt(o){let e=new Blob([o]);return URL.createObjectURL(e)}function pr(o,e){let t=new Blob([o],{type:e});return URL.createObjectURL(t)}function $r(o){URL.revokeObjectURL(o)}var en=1e-8,xr=1e-4,tn=57.29577951308232,Je=.017453292519943;function bt(o){return Math.abs(o)<1e-8}function wt(o,e){return e-o>1e-8}function ei(o,e){return o-e>1e-8}function St(o,e){return e-o>-1e-8}function At(o,e){return o-e>-1e-8}function P(o,e){return Math.abs(e-o)<1e-8}function gr(o,e,t){return Math.abs(e-o)<t}function Cr(o){return o>1e-8}function Gt(o){return o<-1e-8}var R={X:1,Y:2,Z:3};var ti=class{constructor(){this.viewer=null,this.highlightColor=null,this.isActive=!1,this.markers=[]}Init(e,t){this.viewer=e,this.highlightColor=t}IsActive(){return this.isActive}SetActive(e){this.isActive=e,this.isActive||this.Clear()}Click(e){let t=this.viewer.GetMeshIntersectionUnderMouse(e);if(t===null){this.Clear();return}this.markers.length===2&&this.Clear(),this.AddMarker(t)}GetMarkerCount(){return this.markers.length}AddMarker(e){this.markers.push(e),this.GenerateMarker(e)}Calculate(){if(this.markers.length!==2)return null;let e=this.markers[0],t=this.markers[1],r={pointsDistance:null,parallelFacesDistance:null,facesAngle:null},i=this.GetFaceWorldNormal(e),n=this.GetFaceWorldNormal(t);if(r.pointsDistance=e.point.distanceTo(t.point),r.facesAngle=i.angleTo(n),gr(r.facesAngle,0,1e-4)||gr(r.facesAngle,Math.PI,1e-4)){let s=new THREE.Plane().setFromNormalAndCoplanarPoint(i,e.point);r.parallelFacesDistance=Math.abs(s.distanceToPoint(t.point))}return r}Clear(){this.viewer.ClearExtra(),this.markers=[]}GenerateMarker(e){let r=this.viewer.GetBoundingSphere(u=>!0).radius/5,i=r/2,n=new THREE.ConeGeometry(i,r,32);n.translate(0,-r/2,0),n.rotateX(-Math.PI/2);let s=this.viewer.CreateHighlightMaterial(this.highlightColor);s.opacity=.6,s.transparent=!0;let l=new THREE.Mesh(n,s),a=this.GetFaceWorldNormal(e);l.lookAt(a),l.position.set(e.point.x,e.point.y,e.point.z),this.viewer.AddExtraObject(l)}GetFaceWorldNormal(e){let t=new THREE.Matrix4;e.object.updateWorldMatrix(!0,!1),t.extractRotation(e.object.matrixWorld);let r=e.face.normal.clone();return r.applyMatrix4(t),r}};var y=class{constructor(e,t,r){this.x=e,this.y=t,this.z=r}Length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}MultiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}Normalize(){let e=this.Length();return e>0&&this.MultiplyScalar(1/e),this}Offset(e,t){let r=e.Clone().Normalize();return this.x+=r.x*t,this.y+=r.y*t,this.z+=r.z*t,this}Rotate(e,t,r){let i=e.Clone().Normalize(),n=i.x,s=i.y,l=i.z,a=this.x-r.x,u=this.y-r.y,h=this.z-r.z,f=Math.sin(t),d=Math.cos(t);return this.x=-n*(-n*a-s*u-l*h)*(1-d)+a*d+(-l*u+s*h)*f,this.y=-s*(-n*a-s*u-l*h)*(1-d)+u*d+(l*a-n*h)*f,this.z=-l*(-n*a-s*u-l*h)*(1-d)+h*d+(-s*a+n*u)*f,this.x+=r.x,this.y+=r.y,this.z+=r.z,this}Clone(){return new y(this.x,this.y,this.z)}};function ge(o,e){return P(o.x,e.x)&&P(o.y,e.y)&&P(o.z,e.z)}function ri(o,e){return new y(o.x+e.x,o.y+e.y,o.z+e.z)}function $(o,e){return new y(o.x-e.x,o.y-e.y,o.z-e.z)}function Ce(o,e){return Math.sqrt((o.x-e.x)*(o.x-e.x)+(o.y-e.y)*(o.y-e.y)+(o.z-e.z)*(o.z-e.z))}function Tr(o,e){return o.x*e.x+o.y*e.y+o.z*e.z}function ii(o,e){let t=o.Clone().Normalize(),r=e.Clone().Normalize();if(ge(t,r))return 0;let i=Tr(t,r);return Math.acos(i)}function be(o,e){let t=new y(0,0,0);return t.x=o.y*e.z-o.z*e.y,t.y=o.z*e.x-o.x*e.z,t.z=o.x*e.y-o.y*e.x,t}function vt(o,e,t){return Math.sqrt(o*o+e*e+t*t)}function we(o){return new y(o[0],o[1],o[2])}var F=class{constructor(e,t,r){this.r=e,this.g=t,this.b=r}Set(e,t,r){this.r=e,this.g=t,this.b=r}Clone(){return new F(this.r,this.g,this.b)}};function fe(o){return parseInt(Math.round(o*255),10)}function Ve(o,e,t){return new F(fe(o),fe(e),fe(t))}function Pe(o){return o<.04045?o*.0773993808:Math.pow(o*.9478672986+.0521327014,2.4)}function st(o){return o<.0031308?o*12.92:1.055*Math.pow(o,.41666)-.055}function se(o){let e=parseInt(o,10).toString(16);for(;e.length<2;)e="0"+e;return e}function ni(o){let e=se(o.r),t=se(o.g),r=se(o.b);return e+t+r}function rn(o){if(o.length!==6)return null;let e=parseInt(o.substring(0,2),16),t=parseInt(o.substring(2,4),16),r=parseInt(o.substring(4,6),16);return new F(e,t,r)}function si(o){return new F(o[0],o[1],o[2])}function je(o,e){return o.r===e.r&&o.g===e.g&&o.b===e.b}var v=class{constructor(e,t){this.x=e,this.y=t}Clone(){return new v(this.x,this.y)}};function Se(o,e){return P(o.x,e.x)&&P(o.y,e.y)}function nn(o,e){return new v(o.x+e.x,o.y+e.y)}function Er(o,e){return new v(o.x-e.x,o.y-e.y)}function yr(o,e){return Math.sqrt((o.x-e.x)*(o.x-e.x)+(o.y-e.y)*(o.y-e.y))}var ye=class{constructor(){this.name=null,this.url=null,this.buffer=null,this.offset=new v(0,0),this.scale=new v(1,1),this.rotation=0}IsValid(){return this.name!==null&&this.url!==null&&this.buffer!==null}HasTransformation(){return!Se(this.offset,new v(0,0))||!Se(this.scale,new v(1,1))||!P(this.rotation,0)}IsEqual(e){return!(this.name!==e.name||this.name!==e.name||this.url!==e.url||!Se(this.offset,e.offset)||!Se(this.scale,e.scale)||!P(this.rotation,e.rotation))}};function Ke(o,e){return o===null&&e===null?!0:o===null||e===null?!1:o.IsEqual(e)}var ee={Phong:1,Physical:2},Mr=class{constructor(e){this.type=e,this.isDefault=!1,this.name="",this.color=new F(0,0,0),this.vertexColors=!1}IsEqual(e){return!(this.type!==e.type||this.isDefault!==e.isDefault||this.name!==e.name||!je(this.color,e.color)||this.vertexColors!==e.vertexColors)}},Rt=class extends Mr{constructor(e){super(e),this.emissive=new F(0,0,0),this.opacity=1,this.transparent=!1,this.diffuseMap=null,this.bumpMap=null,this.normalMap=null,this.emissiveMap=null,this.alphaTest=0,this.multiplyDiffuseMap=!1}IsEqual(e){return!(!super.IsEqual(e)||!je(this.emissive,e.emissive)||!P(this.opacity,e.opacity)||this.transparent!==e.transparent||!Ke(this.diffuseMap,e.diffuseMap)||!Ke(this.bumpMap,e.bumpMap)||!Ke(this.normalMap,e.normalMap)||!Ke(this.emissiveMap,e.emissiveMap)||!P(this.alphaTest,e.alphaTest)||this.multiplyDiffuseMap!==e.multiplyDiffuseMap)}EnumerateTextureMaps(e){this.diffuseMap!==null&&e(this.diffuseMap),this.bumpMap!==null&&e(this.bumpMap),this.normalMap!==null&&e(this.normalMap),this.emissiveMap!==null&&e(this.emissiveMap)}},q=class extends Rt{constructor(){super(ee.Phong),this.ambient=new F(0,0,0),this.specular=new F(0,0,0),this.shininess=0,this.specularMap=null}IsEqual(e){return!(!super.IsEqual(e)||!je(this.ambient,e.ambient)||!je(this.specular,e.specular)||!P(this.shininess,e.shininess)||!Ke(this.specularMap,e.specularMap))}EnumerateTextureMaps(e){super.EnumerateTextureMaps(e),this.specularMap!==null&&e(this.specularMap)}},Oe=class extends Rt{constructor(){super(ee.Physical),this.metalness=0,this.roughness=1,this.metalnessMap=null}IsEqual(e){return!(!super.IsEqual(e)||!P(this.metalness,e.metalness)||!P(this.roughness,e.roughness)||!Ke(this.metalnessMap,e.metalnessMap))}EnumerateTextureMaps(e){super.EnumerateTextureMaps(e),this.metalnessMap!==null&&e(this.metalnessMap)}};function sn(o,e){return!(o.name!==e.name||o.name!==e.name||o.url!==e.url||!Se(o.offset,e.offset)||!Se(o.scale,e.scale)||!P(o.rotation,e.rotation))}var Ir=class{constructor(){}VertexCount(){return 0}VertexColorCount(){return 0}NormalCount(){return 0}TextureUVCount(){return 0}TriangleCount(){return 0}EnumerateVertices(e){}EnumerateTriangleVertexIndices(e){}EnumerateTriangleVertices(e){}},Be=class extends Ir{constructor(){super(),this.name="",this.propertyGroups=[]}GetName(){return this.name}SetName(e){this.name=e}PropertyGroupCount(){return this.propertyGroups.length}AddPropertyGroup(e){return this.propertyGroups.push(e),this.propertyGroups.length-1}GetPropertyGroup(e){return this.propertyGroups[e]}};var j=class extends Be{constructor(){super(),this.vertices=[],this.vertexColors=[],this.normals=[],this.uvs=[],this.triangles=[]}VertexCount(){return this.vertices.length}VertexColorCount(){return this.vertexColors.length}NormalCount(){return this.normals.length}TextureUVCount(){return this.uvs.length}TriangleCount(){return this.triangles.length}AddVertex(e){return this.vertices.push(e),this.vertices.length-1}SetVertex(e,t){this.vertices[e]=t}GetVertex(e){return this.vertices[e]}AddVertexColor(e){return this.vertexColors.push(e),this.vertexColors.length-1}SetVertexColor(e,t){this.vertexColors[e]=t}GetVertexColor(e){return this.vertexColors[e]}AddNormal(e){return this.normals.push(e),this.normals.length-1}SetNormal(e,t){this.normals[e]=t}GetNormal(e){return this.normals[e]}AddTextureUV(e){return this.uvs.push(e),this.uvs.length-1}SetTextureUV(e,t){this.uvs[e]=t}GetTextureUV(e){return this.uvs[e]}AddTriangle(e){return this.triangles.push(e),this.triangles.length-1}GetTriangle(e){return this.triangles[e]}EnumerateVertices(e){for(let t of this.vertices)e(t)}EnumerateTriangleVertexIndices(e){for(let t of this.triangles)e(t.v0,t.v1,t.v2)}EnumerateTriangleVertices(e){for(let t of this.triangles){let r=this.vertices[t.v0],i=this.vertices[t.v1],n=this.vertices[t.v2];e(r,i,n)}}Clone(){let e=new j;e.SetName(this.GetName());for(let t=0;t<this.VertexCount();t++){let r=this.GetVertex(t);e.AddVertex(r.Clone())}for(let t=0;t<this.VertexColorCount();t++){let r=this.GetVertexColor(t);e.AddVertexColor(r.Clone())}for(let t=0;t<this.NormalCount();t++){let r=this.GetNormal(t);e.AddNormal(r.Clone())}for(let t=0;t<this.TextureUVCount();t++){let r=this.GetTextureUV(t);e.AddTextureUV(r.Clone())}for(let t=0;t<this.TriangleCount();t++){let r=this.GetTriangle(t);e.AddTriangle(r.Clone())}return e}};var U=class{constructor(e,t,r){this.v0=e,this.v1=t,this.v2=r,this.c0=null,this.c1=null,this.c2=null,this.n0=null,this.n1=null,this.n2=null,this.u0=null,this.u1=null,this.u2=null,this.mat=null,this.curve=null}HasVertices(){return this.v0!==null&&this.v1!==null&&this.v2!==null}HasVertexColors(){return this.c0!==null&&this.c1!==null&&this.c2!==null}HasNormals(){return this.n0!==null&&this.n1!==null&&this.n2!==null}HasTextureUVs(){return this.u0!==null&&this.u1!==null&&this.u2!==null}SetVertices(e,t,r){return this.v0=e,this.v1=t,this.v2=r,this}SetVertexColors(e,t,r){return this.c0=e,this.c1=t,this.c2=r,this}SetNormals(e,t,r){return this.n0=e,this.n1=t,this.n2=r,this}SetTextureUVs(e,t,r){return this.u0=e,this.u1=t,this.u2=r,this}SetMaterial(e){return this.mat=e,this}SetCurve(e){return this.curve=e,this}Clone(){let e=new U(this.v0,this.v1,this.v2);return e.SetVertexColors(this.c0,this.c1,this.c2),e.SetNormals(this.n0,this.n1,this.n2),e.SetTextureUVs(this.u0,this.u1,this.u2),e.SetMaterial(this.mat),e.SetCurve(this.curve),e}};function oi(){let o=document.createElement("canvas");document.body.appendChild(o);let e={canvas:o,antialias:!0},t=new THREE.WebGLRenderer(e);t.setClearColor("#ffffff",1),t.setSize(10,10);let r=new THREE.Scene,i=new THREE.AmbientLight(8947848);r.add(i);let n=new THREE.DirectionalLight(8947848);n.position.set(0,0,1),r.add(n);let s=new THREE.PerspectiveCamera(45,1,.1,1e3);s.position.set(0,0,1),s.up.set(0,1,0),s.lookAt(new THREE.Vector3(0,0,0)),r.add(s);let l=new THREE.PlaneGeometry(1,1),a=new THREE.Mesh(l,new THREE.MeshPhongMaterial({color:13369344}));r.add(a),t.render(r,s);let u=t.getContext(),h=new Uint8Array(4);u.readPixels(5,5,1,1,u.RGBA,u.UNSIGNED_BYTE,h),document.body.removeChild(o);let f=50;return h[0]<f&&h[1]<f&&h[2]<f}var oe={Phong:1,Physical:2};function li(o){let e=0,t=0;for(let r=0;r<o.MaterialCount();r++){let i=o.GetMaterial(r);i.type===ee.Phong?e+=1:i.type===ee.Physical&&(t+=1)}return e>=t?oe.Phong:oe.Physical}function Ft(o){return Ve(o.r,o.g,o.b)}function de(o){return new THREE.Color(o.r/255,o.g/255,o.b/255)}function ot(o,e){let t=new j,r=o.attributes.position.array;for(let a=0;a<r.length;a+=3){let u=r[a],h=r[a+1],f=r[a+2];t.AddVertex(new y(u,h,f))}let i=o.attributes.color!==void 0;if(i){let a=o.attributes.color.array,u=o.attributes.color.itemSize;for(let h=0;h<a.length;h+=u){let f=new THREE.Color(a[h],a[h+1],a[h+2]);t.AddVertexColor(Ft(f))}}let n=o.attributes.normal!==void 0;if(n){let a=o.attributes.normal.array;for(let u=0;u<a.length;u+=3){let h=a[u],f=a[u+1],d=a[u+2];t.AddNormal(new y(h,f,d))}}let s=o.attributes.uv!==void 0;if(s){let a=o.attributes.uv.array;for(let u=0;u<a.length;u+=2){let h=a[u],f=a[u+1];t.AddTextureUV(new v(h,f))}}let l=null;if(o.index!==null)l=o.index.array;else{l=[];for(let a=0;a<r.length/3;a++)l.push(a)}for(let a=0;a<l.length;a+=3){let u=l[a],h=l[a+1],f=l[a+2],d=new U(u,h,f);i&&d.SetVertexColors(u,h,f),n&&d.SetNormals(u,h,f),s&&d.SetTextureUVs(u,h,f),e!==null&&d.SetMaterial(e),t.AddTriangle(d)}return t}function K(o){return Math.round(parseFloat(o))}function ai(o){let e=K(o.paddingLeft)+K(o.paddingRight),t=K(o.borderLeftWidth)+K(o.borderRightWidth),r=K(o.marginLeft)+K(o.marginRight);return e+t+r}function ui(o){let e=K(o.paddingTop)+K(o.paddingBottom),t=K(o.borderTopWidth)+K(o.borderBottomWidth),r=K(o.marginTop)+K(o.marginBottom);return e+t+r}function hi(o,e,t){let r=getComputedStyle(o),i=e-ai(r),n=t-ui(r);return{width:i,height:n}}function We(o,e,t){if(o.getBoundingClientRect){let r=o.getBoundingClientRect();e-=r.left,t-=r.top}return window.pageXOffset&&window.pageYOffset&&(e+=window.pageXOffset,t+=window.pageYOffset),new v(e,t)}function fi(o,e,t){let r=document.createElement(o);return e&&(r.className=e),t&&(r.innerHTML=t),r}function ke(o,e,t,r){let i=fi(e,t,r);return o.appendChild(i),i}function br(o,e,t){return ke(o,"div",e,t)}function on(o){for(;o.firstChild;)o.removeChild(o.firstChild)}function ln(o,e){e.parentNode.insertBefore(o,e)}function an(o,e){e.parentNode.insertBefore(o,e.nextSibling)}function un(o,e){e?o.style.display="block":o.style.display="none"}function hn(o){return o.offsetParent!==null}function Ri(o,e){o.style.width=e.toString()+"px"}function Fi(o,e){o.style.height=e.toString()+"px"}function fn(o){let e=getComputedStyle(o);return o.offsetWidth+K(e.marginLeft)+K(e.marginRight)}function dn(o){let e=getComputedStyle(o);return o.offsetHeight+K(e.marginTop)+K(e.marginBottom)}function mn(o,e){let t=getComputedStyle(o);Ri(o,e-ai(t))}function cn(o,e){let t=getComputedStyle(o);Fi(o,e-ui(t))}function pn(o,e,t,r,i){let n=ke(o,"label");n.setAttribute("for",e);let s=ke(n,"input","ov_checkbox");return s.setAttribute("type","checkbox"),s.setAttribute("id",e),s.checked=r,ke(n,"span",null,t),i&&s.addEventListener("change",i),s}function xn(o,e,t){let r=ke(o,"input","ov_slider");return r.setAttribute("type","range"),r.setAttribute("min",e.toString()),r.setAttribute("max",t.toString()),r}function gn(o,e,t,r){let i=br(o,"ov_select_container"),n=ke(i,"select","ov_select");for(let s of e)ke(n,"option",null,s);return n.selectedIndex=t,r&&n.addEventListener("change",()=>{r(n.selectedIndex)}),n}function Cn(o,e){function t(l,a){a?l.classList.add("on"):l.classList.remove("on")}let r=!1,i=null,n="ov_toggle";e&&(n+=" "+e);let s=br(o,n);return br(s,"ov_toggle_slider"),s.addEventListener("click",()=>{r=!r,t(s,r),i&&i()}),{element:s,GetStatus:()=>r,SetStatus:l=>{r=l,t(s,r)},OnChange:l=>{i=l}}}function Tn(o,e){return fi("div",o,e)}function En(o,e,t){let r=e/t;return o*(r*r*(3-2*r))}function yn(o,e,t){return e*o/t}function di(o,e,t){let r=e/t,i=r*r;return o*(i/(2*(i-r)+1))}function Nt(o,e,t,r){let i=$(e,o).Normalize(),n=Ce(o,e),s=[];for(let l=0;l<t;l++){let a=r(n,l,t-1);s.push(o.Clone().Offset(i,a))}return s}var Ae=class{constructor(e,t,r){this.eye=e,this.center=t,this.up=r}Clone(){return new Ae(this.eye.Clone(),this.center.Clone(),this.up.Clone())}};function Gr(o,e){return ge(o.eye,e.eye)&&ge(o.center,e.center)&&ge(o.up,e.up)}var wr=class{constructor(){this.prev=new v(0,0),this.curr=new v(0,0),this.diff=new v(0,0),this.buttons=[]}Down(e,t){this.buttons.push(t.which),this.curr=this.GetPositionFromEvent(e,t),this.prev=this.curr.Clone()}Move(e,t){this.curr=this.GetPositionFromEvent(e,t),this.diff=Er(this.curr,this.prev),this.prev=this.curr.Clone()}Up(e,t){let r=this.buttons.indexOf(t.which);r!==-1&&this.buttons.splice(r,1),this.curr=this.GetPositionFromEvent(e,t)}Leave(e,t){this.buttons=[],this.curr=this.GetPositionFromEvent(e,t)}IsButtonDown(){return this.buttons.length>0}GetButton(){let e=this.buttons.length;return e===0?0:this.buttons[e-1]}GetPosition(){return this.curr}GetMoveDiff(){return this.diff}GetPositionFromEvent(e,t){return We(e,t.clientX,t.clientY)}},Sr=class{constructor(){this.prevPos=new v(0,0),this.currPos=new v(0,0),this.diffPos=new v(0,0),this.prevDist=0,this.currDist=0,this.diffDist=0,this.fingers=0}Start(e,t){t.touches.length!==0&&(this.fingers=t.touches.length,this.currPos=this.GetPositionFromEvent(e,t),this.prevPos=this.currPos.Clone(),this.currDist=this.GetTouchDistanceFromEvent(e,t),this.prevDist=this.currDist)}Move(e,t){t.touches.length!==0&&(this.currPos=this.GetPositionFromEvent(e,t),this.diffPos=Er(this.currPos,this.prevPos),this.prevPos=this.currPos.Clone(),this.currDist=this.GetTouchDistanceFromEvent(e,t),this.diffDist=this.currDist-this.prevDist,this.prevDist=this.currDist)}End(e,t){t.touches.length!==0&&(this.fingers=0,this.currPos=this.GetPositionFromEvent(e,t),this.currDist=this.GetTouchDistanceFromEvent(e,t))}IsFingerDown(){return this.fingers!==0}GetFingerCount(){return this.fingers}GetPosition(){return this.currPos}GetMoveDiff(){return this.diffPos}GetDistanceDiff(){return this.diffDist}GetPositionFromEvent(e,t){let r=null;if(t.touches.length!==0){let i=t.touches[0];r=We(e,i.pageX,i.pageY)}return r}GetTouchDistanceFromEvent(e,t){if(t.touches.length!==2)return 0;let r=t.touches[0],i=t.touches[1];return yr(We(e,r.pageX,r.pageY),We(e,i.pageX,i.pageY))}},Ar=class{constructor(){this.isClick=!1,this.startPosition=null}Start(e){this.isClick=!0,this.startPosition=e}Move(e){!this.isClick||(this.startPosition!==null?yr(this.startPosition,e)>3&&this.Cancel():this.Cancel())}End(){this.startPosition=null}Cancel(){this.isClick=!1,this.startPosition=null}IsClick(){return this.isClick}},le={None:0,Orbit:1,Pan:2,Zoom:3},Dt=class{constructor(e,t,r){this.canvas=e,this.camera=t,this.callbacks=r,this.fixUpVector=!0,this.mouse=new wr,this.touch=new Sr,this.clickDetector=new Ar,this.onMouseClick=null,this.onMouseMove=null,this.onContext=null,this.canvas.addEventListener&&(this.canvas.addEventListener("mousedown",this.OnMouseDown.bind(this)),this.canvas.addEventListener("wheel",this.OnMouseWheel.bind(this)),this.canvas.addEventListener("touchstart",this.OnTouchStart.bind(this)),this.canvas.addEventListener("touchmove",this.OnTouchMove.bind(this)),this.canvas.addEventListener("touchcancel",this.OnTouchEnd.bind(this)),this.canvas.addEventListener("touchend",this.OnTouchEnd.bind(this)),this.canvas.addEventListener("contextmenu",this.OnContextMenu.bind(this))),document.addEventListener&&(document.addEventListener("mousemove",this.OnMouseMove.bind(this)),document.addEventListener("mouseup",this.OnMouseUp.bind(this)),document.addEventListener("mouseleave",this.OnMouseLeave.bind(this)))}SetMouseClickHandler(e){this.onMouseClick=e}SetMouseMoveHandler(e){this.onMouseMove=e}SetContextMenuHandler(e){this.onContext=e}IsFixUpVector(){return this.fixUpVector}SetFixUpVector(e){this.fixUpVector=e}GetCamera(){return this.camera}SetCamera(e){this.camera=e}MoveCamera(e,t){function r(i,n,s,l){i.camera.eye=n.eye[l],i.camera.center=n.center[l],i.camera.up=n.up[l],i.Update(),l<s-1&&requestAnimationFrame(()=>{r(i,n,s,l+1)})}if(e!==null){if(t===0||Gr(this.camera,e))this.camera=e;else{let i=di,n={eye:Nt(this.camera.eye,e.eye,t,i),center:Nt(this.camera.center,e.center,t,i),up:Nt(this.camera.up,e.up,t,i)};requestAnimationFrame(()=>{r(this,n,t,0)})}this.Update()}}GetFitToSphereCamera(e,t,r){if(bt(t))return null;let i=this.camera.Clone(),n=$(i.center,e);i.eye=$(i.eye,n),i.center=e.Clone();let s=$(i.eye,i.center).Normalize(),l=r/2;this.canvas.width<this.canvas.height&&(l=l*this.canvas.width/this.canvas.height);let a=t/Math.sin(l*Je);return i.eye=i.center.Clone().Offset(s,a),i}OnMouseDown(e){e.preventDefault(),this.mouse.Down(this.canvas,e),this.clickDetector.Start(this.mouse.GetPosition())}OnMouseMove(e){if(this.mouse.Move(this.canvas,e),this.clickDetector.Move(this.mouse.GetPosition()),this.onMouseMove){let n=We(this.canvas,e.clientX,e.clientY);this.onMouseMove(n)}if(!this.mouse.IsButtonDown())return;let t=this.mouse.GetMoveDiff(),r=this.mouse.GetButton(),i=le.None;if(r===1?e.ctrlKey?i=le.Zoom:e.shiftKey?i=le.Pan:i=le.Orbit:(r===2||r===3)&&(i=le.Pan),i===le.Orbit){let n=.5;this.Orbit(t.x*n,t.y*n)}else if(i===le.Pan){let n=Ce(this.camera.eye,this.camera.center),s=.001*n;this.Pan(t.x*s,t.y*s)}else if(i===le.Zoom){let n=.005;this.Zoom(-t.y*n)}this.Update()}OnMouseUp(e){if(this.mouse.Up(this.canvas,e),this.clickDetector.End(),this.clickDetector.IsClick()){let t=this.mouse.GetPosition();this.Click(e.which,t)}}OnMouseLeave(e){this.mouse.Leave(this.canvas,e),this.clickDetector.Cancel()}OnTouchStart(e){e.preventDefault(),this.touch.Start(this.canvas,e),this.clickDetector.Start(this.touch.GetPosition())}OnTouchMove(e){if(e.preventDefault(),this.touch.Move(this.canvas,e),this.clickDetector.Move(this.touch.GetPosition()),!this.touch.IsFingerDown())return;let t=this.touch.GetMoveDiff(),r=this.touch.GetDistanceDiff(),i=this.touch.GetFingerCount(),n=le.None;if(i===1?n=le.Orbit:i===2&&(n=le.Pan),n===le.Orbit){let s=.5;this.Orbit(t.x*s,t.y*s)}else if(n===le.Pan){let s=.005;this.Zoom(r*s);let l=.001*Ce(this.camera.eye,this.camera.center);this.Pan(t.x*l,t.y*l)}this.Update()}OnTouchEnd(e){if(e.preventDefault(),this.touch.End(this.canvas,e),this.clickDetector.End(),this.clickDetector.IsClick()){let t=this.touch.GetPosition();this.touch.GetFingerCount()===1&&this.Click(1,t)}}OnMouseWheel(e){e.preventDefault();let r=-(e||window.event).deltaY/40,i=.1;r<0&&(i=i*-1),this.Zoom(i),this.Update()}OnContextMenu(e){e.preventDefault(),this.clickDetector.IsClick()&&(this.Context(e.clientX,e.clientY),this.clickDetector.Cancel())}Orbit(e,t){let r=e*Je,i=t*Je,n=$(this.camera.center,this.camera.eye).Normalize(),s=be(n,this.camera.up).Normalize();if(this.fixUpVector){let a=ii(n,this.camera.up)+i;ei(a,0)&&wt(a,Math.PI)&&this.camera.eye.Rotate(s,-i,this.camera.center),this.camera.eye.Rotate(this.camera.up,-r,this.camera.center)}else{let l=be(s,n).Normalize();this.camera.eye.Rotate(s,-i,this.camera.center),this.camera.eye.Rotate(l,-r,this.camera.center),this.camera.up=l}}Pan(e,t){let r=$(this.camera.center,this.camera.eye).Normalize(),i=be(r,this.camera.up).Normalize(),n=be(i,r).Normalize();this.camera.eye.Offset(i,-e),this.camera.center.Offset(i,-e),this.camera.eye.Offset(n,t),this.camera.center.Offset(n,t)}Zoom(e){let t=$(this.camera.center,this.camera.eye),i=t.Length()*e;this.camera.eye.Offset(t,i)}Update(){this.callbacks.onUpdate()}Click(e,t){this.onMouseClick&&this.onMouseClick(e,t)}Context(e,t){if(this.onContext){let r={x:e,y:t},i=We(this.canvas,e,t);this.onContext(r,i)}}};function mi(o,e){function t(r,i){for(let n of r)n.polygonOffset=i,n.polygonOffsetUnit=1,n.polygonOffsetFactor=1}t(o.material,e),o.userData.threeMaterials&&t(o.userData.threeMaterials,e)}var Vt=class{constructor(e){this.scene=e,this.mainObject=null,this.mainGridObject=null,this.mainEdgeObject=null,this.gridSettings={showGrid:!1},this.edgeSettings={showEdges:!1,edgeColor:new F(0,0,0),edgeThreshold:1}}SetMainObject(e){this.mainObject=e,this.scene.add(this.mainObject),this.gridSettings.showGrid&&this.GenerateMainGridObject(),this.edgeSettings.showEdges&&this.GenerateMainEdgeObject()}UpdateWorldMatrix(){this.mainObject!==null&&this.mainObject.updateWorldMatrix(!0,!0)}SetGridSettings(e){this.gridSettings.showGrid=e,this.mainObject!==null&&(this.gridSettings.showGrid?(this.ClearMainGridObject(),this.GenerateMainGridObject()):this.ClearMainGridObject())}SetEdgeSettings(e,t,r){let i=!1;if(e&&(!this.edgeSettings.showEdges||this.edgeSettings.edgeThreshold!==r)&&(i=!0),this.edgeSettings.showEdges=e,this.edgeSettings.edgeThreshold=r,this.edgeSettings.edgeColor=t,this.mainObject!==null)if(this.edgeSettings.showEdges)if(i)this.ClearMainEdgeObject(),this.GenerateMainEdgeObject();else{let n=de(this.edgeSettings.edgeColor);this.EnumerateEdges(s=>{s.material.color=n})}else this.ClearMainEdgeObject()}GenerateMainGridObject(){function e(m,x,g){let C=[m,x],E=new THREE.BufferGeometry().setFromPoints(C);return new THREE.Line(E,g)}this.UpdateWorldMatrix();let t=this.GetBoundingBox(m=>!0);if(t===null)return;this.mainGridObject=new THREE.Object3D;let r=new THREE.LineBasicMaterial({color:8947848}),i=new THREE.LineBasicMaterial({color:14540253}),n=new THREE.Vector3;t.getSize(n);let s=1,l=new THREE.Vector2(t.min.z-s,t.min.x-s),a=new THREE.Vector2(t.max.z+s,t.max.x+s),u=1,h=new THREE.Vector2(Math.floor(l.x/u)*u,Math.floor(l.y/u)*u),f=new THREE.Vector2(Math.ceil(a.x/u)*u,Math.ceil(a.y/u)*u),d=t.min.y,c=Math.floor((f.x-h.x)/u),p=Math.floor((f.y-h.y)/u);for(let m=0;m<c+1;m++){let x=h.x+m*u,g=new THREE.Vector3(h.y,d,x),C=new THREE.Vector3(f.y,d,x),E=P(x,0)?r:i;this.mainGridObject.add(e(g,C,E))}for(let m=0;m<p+1;m++){let x=h.y+m*u,g=new THREE.Vector3(x,d,h.x),C=new THREE.Vector3(x,d,f.x),E=P(x,0)?r:i;this.mainGridObject.add(e(g,C,E))}this.scene.add(this.mainGridObject)}GenerateMainEdgeObject(){let e=de(this.edgeSettings.edgeColor);this.mainEdgeObject=new THREE.Object3D,this.UpdateWorldMatrix(),this.EnumerateMeshes(t=>{mi(t,!0);let r=new THREE.EdgesGeometry(t.geometry,this.edgeSettings.edgeThreshold),i=new THREE.LineSegments(r,new THREE.LineBasicMaterial({color:e}));i.applyMatrix4(t.matrixWorld),i.userData=t.userData,i.visible=t.visible,this.mainEdgeObject.add(i)}),this.scene.add(this.mainEdgeObject)}GetBoundingBox(e){let t=!1,r=new THREE.Box3;return this.EnumerateMeshes(i=>{e(i.userData)&&(r.union(new THREE.Box3().setFromObject(i)),t=!0)}),t?r:null}GetBoundingSphere(e){let t=this.GetBoundingBox(e);if(t===null)return null;let r=new THREE.Sphere;return t.getBoundingSphere(r),r}Clear(){this.ClearMainObject(),this.ClearMainGridObject(),this.ClearMainEdgeObject()}ClearMainObject(){this.mainObject!==null&&(this.EnumerateMeshes(e=>{e.geometry.dispose()}),this.scene.remove(this.mainObject),this.mainObject=null)}ClearMainGridObject(){this.mainGridObject!==null&&(this.mainGridObject.traverse(e=>{e.isLineSegments&&e.geometry.dispose()}),this.scene.remove(this.mainGridObject),this.mainGridObject=null)}ClearMainEdgeObject(){this.mainEdgeObject!==null&&(this.EnumerateMeshes(e=>{mi(e,!1)}),this.EnumerateEdges(e=>{e.geometry.dispose()}),this.scene.remove(this.mainEdgeObject),this.mainEdgeObject=null)}EnumerateMeshes(e){this.mainObject!==null&&this.mainObject.traverse(t=>{t.isMesh&&e(t)})}EnumerateEdges(e){this.mainEdgeObject!==null&&this.mainEdgeObject.traverse(t=>{t.isLineSegments&&e(t)})}GetMeshIntersectionUnderMouse(e,t,r,i){if(this.mainObject===null)return null;let n=new THREE.Raycaster,s=new THREE.Vector2;s.x=e.x/r*2-1,s.y=-(e.y/i)*2+1,n.setFromCamera(s,t);let l=n.intersectObject(this.mainObject,!0);for(let a=0;a<l.length;a++){let u=l[a];if(u.object.type==="Mesh"&&u.object.visible)return u}return null}},Pt=class{constructor(e){this.scene=e,this.mainObject=null}AddObject(e){this.mainObject===null&&(this.mainObject=new THREE.Object3D,this.scene.add(this.mainObject)),this.mainObject.add(e)}Clear(){this.mainObject!==null&&(this.mainObject.traverse(e=>{(e.isMesh||e.isLineSegments)&&e.geometry.dispose()}),this.scene.remove(this.mainObject),this.mainObject=null)}};function ci(o){return o===R.X?new Gr(new y(2,-3,1.5),new y(0,0,0),new y(1,0,0)):o===R.Y?new Ae(new y(-1.5,2,3),new y(0,0,0),new y(0,1,0)):o===R.Z?new Ae(new y(-1.5,-3,2),new y(0,0,0),new y(0,0,1)):null}function pi(o,e){if(!e(o))return!1;for(let t of o.children)if(!pi(t,e))return!1;return!0}function Ni(o){let e=null;return pi(o,t=>{if(t.isMesh)for(let r of t.material)return r.type==="MeshPhongMaterial"?e=oe.Phong:r.type==="MeshStandardMaterial"&&(e=oe.Physical),!1;return!0}),e}var vr=class{constructor(){this.direction=R.Z,this.isFixed=!0,this.isFlipped=!1}SetDirection(e,t){this.direction=e,this.isFlipped=!1;let r=ci(this.direction),i=$(r.eye,r.center),n=Ce(t.center,t.eye),s=t.center.Clone().Offset(i,n),l=t.Clone();return this.direction===R.X&&(l.up=new y(1,0,0),l.eye=s),this.direction===R.Y?(l.up=new y(0,1,0),l.eye=s):this.direction===R.Z&&(l.up=new y(0,0,1),l.eye=s),l}SetFixed(e,t){return this.isFixed=e,this.isFixed?this.SetDirection(this.direction,t):null}Flip(e){this.isFlipped=!this.isFlipped;let t=e.Clone();return t.up.MultiplyScalar(-1),t}},Rr=class{constructor(e){this.scene=e,this.type=oe.Phong,this.ambientLight=new THREE.AmbientLight(8947848),this.directionalLight=new THREE.DirectionalLight(8947848),this.environment=null,this.scene.add(this.ambientLight),this.scene.add(this.directionalLight)}SetType(e){this.type=e,this.type===oe.Phong?(this.ambientLight.color.set(8947848),this.directionalLight.color.set(8947848),this.scene.environment=null):this.type===oe.Physical&&(this.ambientLight.color.set(0),this.directionalLight.color.set(5592405),this.scene.environment=this.environment)}SetEnvironment(e,t){let r=new THREE.CubeTextureLoader;this.environment=r.load(e,()=>{t()})}UpdateByCamera(e){let t=$(e.eye,e.center);this.directionalLight.position.set(t.x,t.y,t.z)}CreateHighlightMaterial(e,t){let r=null;return this.type===oe.Phong?r=new THREE.MeshPhongMaterial({color:e,side:THREE.DoubleSide}):this.type===oe.Physical&&(r=new THREE.MeshStandardMaterial({color:e,side:THREE.DoubleSide})),r!==null&&t&&(r.polygonOffset=!0,r.polygonOffsetUnit=1,r.polygonOffsetFactor=1),r}},Ot=class{constructor(){this.canvas=null,this.renderer=null,this.scene=null,this.geometry=null,this.extraGeometry=null,this.camera=null,this.shading=null,this.navigation=null,this.upVector=null,this.settings={animationSteps:40}}Init(e){this.canvas=e,this.canvas.id="viewer";let t={canvas:this.canvas,antialias:!0};this.renderer=new THREE.WebGLRenderer(t),window.devicePixelRatio&&this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setClearColor("#ffffff",1),this.renderer.setSize(this.canvas.width,this.canvas.height),this.scene=new THREE.Scene,this.geometry=new Vt(this.scene),this.extraGeometry=new Pt(this.scene),this.InitNavigation(),this.InitShading(),this.Render()}SetMouseClickHandler(e){this.navigation.SetMouseClickHandler(e)}SetMouseMoveHandler(e){this.navigation.SetMouseMoveHandler(e)}SetContextMenuHandler(e){this.navigation.SetContextMenuHandler(e)}SetBackgroundColor(e){let t="#"+ni(e);this.renderer.setClearColor(t,1),this.Render()}SetGridSettings(e){this.geometry.SetGridSettings(e),this.Render()}SetEdgeSettings(e,t,r){this.geometry.SetEdgeSettings(e,t,r),this.Render()}SetEnvironmentMap(e){this.shading.SetEnvironment(e,()=>{this.Render()})}GetCanvas(){return this.canvas}GetCamera(){return this.navigation.GetCamera()}SetCamera(e){this.navigation.SetCamera(e),this.Render()}Resize(e,t){let r=hi(this.canvas,e,t);this.ResizeRenderer(r.width,r.height)}ResizeRenderer(e,t){window.devicePixelRatio&&this.renderer.setPixelRatio(window.devicePixelRatio),this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t),this.Render()}FitSphereToWindow(e,t){if(e===null)return;let r=new y(e.center.x,e.center.y,e.center.z),i=e.radius,n=this.camera.fov,s=this.navigation.GetFitToSphereCamera(r,i,n);this.navigation.MoveCamera(s,t?this.settings.animationSteps:0)}AdjustClippingPlanesToSphere(e){e!==null&&(e.radius<10?(this.camera.near=.01,this.camera.far=100):e.radius<100?(this.camera.near=.1,this.camera.far=1e3):e.radius<1e3?(this.camera.near=10,this.camera.far=1e4):(this.camera.near=100,this.camera.far=1e6),this.camera.updateProjectionMatrix(),this.Render())}IsFixUpVector(){return this.navigation.IsFixUpVector()}SetFixUpVector(e){let t=this.navigation.GetCamera(),r=this.upVector.SetFixed(e,t);this.navigation.SetFixUpVector(e),r!==null&&this.navigation.MoveCamera(r,this.settings.animationSteps),this.Render()}SetUpVector(e,t){let r=this.navigation.GetCamera(),i=this.upVector.SetDirection(e,r),n=t?this.settings.animationSteps:0;this.navigation.MoveCamera(i,n),this.Render()}FlipUpVector(){let e=this.navigation.GetCamera(),t=this.upVector.Flip(e);this.navigation.MoveCamera(t,0),this.Render()}Render(){let e=this.navigation.GetCamera();this.camera.position.set(e.eye.x,e.eye.y,e.eye.z),this.camera.up.set(e.up.x,e.up.y,e.up.z),this.camera.lookAt(new THREE.Vector3(e.center.x,e.center.y,e.center.z)),this.shading.UpdateByCamera(e),this.renderer.render(this.scene,this.camera)}SetMainObject(e){let t=Ni(e);this.geometry.SetMainObject(e),this.shading.SetType(t),this.Render()}AddExtraObject(e){this.extraGeometry.AddObject(e),this.Render()}Clear(){this.geometry.Clear(),this.extraGeometry.Clear(),this.Render()}ClearExtra(){this.extraGeometry.Clear(),this.Render()}SetMeshesVisibility(e){this.geometry.EnumerateMeshes(t=>{let r=e(t.userData);t.visible!==r&&(t.visible=r)}),this.geometry.EnumerateEdges(t=>{let r=e(t.userData);t.visible!==r&&(t.visible=r)}),this.Render()}SetMeshesHighlight(e,t){function r(n,s){let l=[];for(let a=0;a<n.length;a++)l.push(s);return l}let i=this.CreateHighlightMaterial(e);this.geometry.EnumerateMeshes(n=>{t(n.userData)?n.userData.threeMaterials===null&&(n.userData.threeMaterials=n.material,n.material=r(n.material,i)):n.userData.threeMaterials!==null&&(n.material=n.userData.threeMaterials,n.userData.threeMaterials=null)}),this.Render()}CreateHighlightMaterial(e){let t=this.geometry.edgeSettings.showEdges;return this.shading.CreateHighlightMaterial(e,t)}GetMeshUserDataUnderMouse(e){let t=this.GetMeshIntersectionUnderMouse(e);return t===null?null:t.object.userData}GetMeshIntersectionUnderMouse(e){let t=this.GetCanvasSize(),r=this.geometry.GetMeshIntersectionUnderMouse(e,this.camera,t.width,t.height);return r===null?null:r}GetBoundingBox(e){return this.geometry.GetBoundingBox(e)}GetBoundingSphere(e){return this.geometry.GetBoundingSphere(e)}EnumerateMeshesUserData(e){this.geometry.EnumerateMeshes(t=>{e(t.userData)})}InitNavigation(){this.camera=new THREE.PerspectiveCamera(45,this.canvas.width/this.canvas.height,.1,1e3),this.scene.add(this.camera);let e=this.renderer.domElement,t=ci(R.Z);this.navigation=new Dt(e,t,{onUpdate:()=>{this.Render()}}),this.upVector=new vr}InitShading(){this.shading=new Rr(this.scene)}GetImageSize(){let e=new THREE.Vector2;return this.renderer.getSize(e),{width:parseInt(e.x,10),height:parseInt(e.y,10)}}GetCanvasSize(){let e=this.canvas.width,t=this.canvas.height;return window.devicePixelRatio&&(e/=window.devicePixelRatio,t/=window.devicePixelRatio),{width:e,height:t}}GetImageAsDataUrl(e,t){let r=this.GetImageSize(),i=e,n=t;window.devicePixelRatio&&(i/=window.devicePixelRatio,n/=window.devicePixelRatio),this.ResizeRenderer(i,n),this.Render();let s=this.renderer.domElement.toDataURL();return this.ResizeRenderer(r.width,r.height),s}};var lt=class{constructor(e,t){this.source=t,t===X.Url?(this.fileUrl=e,this.fileObject=null,this.name=Y(e),this.extension=De(e)):t===X.File?(this.fileUrl=null,this.fileObject=e,this.name=Y(e.name),this.extension=De(e.name)):t===X.Decompressed&&(this.fileUrl=null,this.fileObject=null,this.name=Y(e),this.extension=De(e)),this.content=null}SetContent(e){this.content=e}},at=class{constructor(){this.files=[]}FillFromFileUrls(e){this.Fill(e,X.Url)}FillFromFileObjects(e){this.Fill(e,X.File)}ExtendFromFileList(e){for(let t=0;t<e.length;t++){let r=e[t];this.ContainsFileByPath(r.name)||this.files.push(r)}}GetFiles(){return this.files}GetContent(e){Xr(this.files.length,{runTask:(t,r)=>{this.GetFileContent(this.files[t],r)},onReady:e})}ContainsFileByPath(e){return this.FindFileByPath(e)!==null}FindFileByPath(e){let t=Y(e).toLowerCase();for(let r=0;r<this.files.length;r++){let i=this.files[r];if(i.name.toLowerCase()===t)return i}return null}IsOnlyUrlSource(){if(this.files.length===0)return!1;for(let e=0;e<this.files.length;e++){let t=this.files[e];if(t.source!==X.Url&&t.source!==X.Decompressed)return!1}return!0}Fill(e,t){this.files=[];for(let r=0;r<e.length;r++){let i=e[r],n=new lt(i,t);this.AddFile(n)}}AddFile(e){this.files.push(e)}GetFileContent(e,t){if(e.content!==null){t();return}let r=null;if(e.source===X.Url)r=Kr(e.fileUrl,L.Binary);else if(e.source===X.File)r=Zr(e.fileObject,L.Binary);else{t();return}r.then(i=>{e.SetContent(i)}).catch(()=>{}).finally(()=>{t()})}};var me=class{constructor(e,t,r,i){this.x=e,this.y=t,this.z=r,this.w=i}};function Mn(o,e){return P(o.x,e.x)&&P(o.y,e.y)&&P(o.z,e.z)&&P(o.w,e.w)}function Ze(o){return new me(o[0],o[1],o[2],o[3])}function xi(o,e){let t=e/2,r=Math.sin(t);return new me(o.x*r,o.y*r,o.z*r,Math.cos(t))}function In(o,e,t,r){let i=Math.cos(o/2),n=Math.cos(e/2),s=Math.cos(t/2),l=Math.sin(o/2),a=Math.sin(e/2),u=Math.sin(t/2),h=new me(0,0,0,1);if(r==="XYZ")h.x=l*n*s+i*a*u,h.y=i*a*s-l*n*u,h.z=i*n*u+l*a*s,h.w=i*n*s-l*a*u;else if(r==="YXZ")h.x=l*n*s+i*a*u,h.y=i*a*s-l*n*u,h.z=i*n*u-l*a*s,h.w=i*n*s+l*a*u;else if(r==="ZXY")h.x=l*n*s-i*a*u,h.y=i*a*s+l*n*u,h.z=i*n*u+l*a*s,h.w=i*n*s-l*a*u;else if(r==="ZYX")h.x=l*n*s-i*a*u,h.y=i*a*s+l*n*u,h.z=i*n*u-l*a*s,h.w=i*n*s+l*a*u;else if(r==="YZX")h.x=l*n*s+i*a*u,h.y=i*a*s+l*n*u,h.z=i*n*u-l*a*s,h.w=i*n*s-l*a*u;else if(r==="XZY")h.x=l*n*s-i*a*u,h.y=i*a*s-l*n*u,h.z=i*n*u+l*a*s,h.w=i*n*s+l*a*u;else return null;return h}var O=class{constructor(e){this.matrix=null,e!=null&&(this.matrix=e)}IsValid(){return this.matrix!==null}Set(e){return this.matrix=e,this}Get(){return this.matrix}Clone(){let e=[this.matrix[0],this.matrix[1],this.matrix[2],this.matrix[3],this.matrix[4],this.matrix[5],this.matrix[6],this.matrix[7],this.matrix[8],this.matrix[9],this.matrix[10],this.matrix[11],this.matrix[12],this.matrix[13],this.matrix[14],this.matrix[15]];return new O(e)}CreateIdentity(){return this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this}IsIdentity(){let e=new O().CreateIdentity().Get();for(let t=0;t<16;t++)if(!P(this.matrix[t],e[t]))return!1;return!0}CreateTranslation(e,t,r){return this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,e,t,r,1],this}CreateRotation(e,t,r,i){let n=e+e,s=t+t,l=r+r,a=e*n,u=e*s,h=e*l,f=t*s,d=t*l,c=r*l,p=i*n,m=i*s,x=i*l;return this.matrix=[1-(f+c),u+x,h-m,0,u-x,1-(a+c),d+p,0,h+m,d-p,1-(a+f),0,0,0,0,1],this}CreateRotationAxisAngle(e,t){let r=xi(e,t);return this.CreateRotation(r.x,r.y,r.z,r.w)}CreateScale(e,t,r){return this.matrix=[e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1],this}ComposeTRS(e,t,r){let i=e.x,n=e.y,s=e.z,l=t.x,a=t.y,u=t.z,h=t.w,f=r.x,d=r.y,c=r.z,p=l+l,m=a+a,x=u+u,g=l*p,C=l*m,E=l*x,T=a*m,I=a*x,w=u*x,M=h*p,A=h*m,b=h*x;return this.matrix=[(1-(T+w))*f,(C+b)*f,(E-A)*f,0,(C-b)*d,(1-(g+w))*d,(I+M)*d,0,(E+A)*c,(I-M)*c,(1-(g+T))*c,0,i,n,s,1],this}DecomposeTRS(){let e=new y(this.matrix[12],this.matrix[13],this.matrix[14]),t=vt(this.matrix[0],this.matrix[1],this.matrix[2]),r=vt(this.matrix[4],this.matrix[5],this.matrix[6]),i=vt(this.matrix[8],this.matrix[9],this.matrix[10]),n=this.Determinant();Gt(n)&&(t*=-1);let s=new y(t,r,i),l=this.matrix[0]/t,a=this.matrix[4]/r,u=this.matrix[8]/i,h=this.matrix[1]/t,f=this.matrix[5]/r,d=this.matrix[9]/i,c=this.matrix[2]/t,p=this.matrix[6]/r,m=this.matrix[10]/i,x=null,g=l+f+m;if(g>0){let C=Math.sqrt(g+1)*2;x=new me((p-d)/C,(u-c)/C,(h-a)/C,.25*C)}else if(l>f&&l>m){let C=Math.sqrt(1+l-f-m)*2;x=new me(.25*C,(a+h)/C,(u+c)/C,(p-d)/C)}else if(f>m){let C=Math.sqrt(1+f-l-m)*2;x=new me((a+h)/C,.25*C,(d+p)/C,(u-c)/C)}else{let C=Math.sqrt(1+m-l-f)*2;x=new me((u+c)/C,(d+p)/C,.25*C,(h-a)/C)}return{translation:e,rotation:x,scale:s}}Determinant(){let e=this.matrix[0],t=this.matrix[1],r=this.matrix[2],i=this.matrix[3],n=this.matrix[4],s=this.matrix[5],l=this.matrix[6],a=this.matrix[7],u=this.matrix[8],h=this.matrix[9],f=this.matrix[10],d=this.matrix[11],c=this.matrix[12],p=this.matrix[13],m=this.matrix[14],x=this.matrix[15],g=e*s-t*n,C=e*l-r*n,E=e*a-i*n,T=t*l-r*s,I=t*a-i*s,w=r*a-i*l,M=u*p-h*c,A=u*m-f*c,b=u*x-d*c,G=h*m-f*p,B=h*x-d*p,N=f*x-d*m;return g*N-C*B+E*G+T*b-I*A+w*M}Invert(){let e=this.matrix[0],t=this.matrix[1],r=this.matrix[2],i=this.matrix[3],n=this.matrix[4],s=this.matrix[5],l=this.matrix[6],a=this.matrix[7],u=this.matrix[8],h=this.matrix[9],f=this.matrix[10],d=this.matrix[11],c=this.matrix[12],p=this.matrix[13],m=this.matrix[14],x=this.matrix[15],g=e*s-t*n,C=e*l-r*n,E=e*a-i*n,T=t*l-r*s,I=t*a-i*s,w=r*a-i*l,M=u*p-h*c,A=u*m-f*c,b=u*x-d*c,G=h*m-f*p,B=h*x-d*p,N=f*x-d*m,D=g*N-C*B+E*G+T*b-I*A+w*M;if(P(D,0))return null;let V=[(s*N-l*B+a*G)/D,(r*B-t*N-i*G)/D,(p*w-m*I+x*T)/D,(f*I-h*w-d*T)/D,(l*b-n*N-a*A)/D,(e*N-r*b+i*A)/D,(m*E-c*w-x*C)/D,(u*w-f*E+d*C)/D,(n*B-s*b+a*M)/D,(t*b-e*B-i*M)/D,(c*I-p*E+x*g)/D,(h*E-u*I-d*g)/D,(s*A-n*G-l*M)/D,(e*G-t*A+r*M)/D,(p*C-c*T-m*g)/D,(u*T-h*C+f*g)/D];return new O(V)}MultiplyVector(e){let t=e[0],r=e[1],i=e[2],n=e[3],s=this.matrix[0],l=this.matrix[1],a=this.matrix[2],u=this.matrix[3],h=this.matrix[4],f=this.matrix[5],d=this.matrix[6],c=this.matrix[7],p=this.matrix[8],m=this.matrix[9],x=this.matrix[10],g=this.matrix[11],C=this.matrix[12],E=this.matrix[13],T=this.matrix[14],I=this.matrix[15];return[t*s+r*h+i*p+n*C,t*l+r*f+i*m+n*E,t*a+r*d+i*x+n*T,t*u+r*c+i*g+n*I]}MultiplyMatrix(e){let t=this.matrix[0],r=this.matrix[1],i=this.matrix[2],n=this.matrix[3],s=this.matrix[4],l=this.matrix[5],a=this.matrix[6],u=this.matrix[7],h=this.matrix[8],f=this.matrix[9],d=this.matrix[10],c=this.matrix[11],p=this.matrix[12],m=this.matrix[13],x=this.matrix[14],g=this.matrix[15],C=e.matrix[0],E=e.matrix[1],T=e.matrix[2],I=e.matrix[3],w=e.matrix[4],M=e.matrix[5],A=e.matrix[6],b=e.matrix[7],G=e.matrix[8],B=e.matrix[9],N=e.matrix[10],D=e.matrix[11],V=e.matrix[12],te=e.matrix[13],z=e.matrix[14],xe=e.matrix[15],Fe=[t*C+r*w+i*G+n*V,t*E+r*M+i*B+n*te,t*T+r*A+i*N+n*z,t*I+r*b+i*D+n*xe,s*C+l*w+a*G+u*V,s*E+l*M+a*B+u*te,s*T+l*A+a*N+u*z,s*I+l*b+a*D+u*xe,h*C+f*w+d*G+c*V,h*E+f*M+d*B+c*te,h*T+f*A+d*N+c*z,h*I+f*b+d*D+c*xe,p*C+m*w+x*G+g*V,p*E+m*M+x*B+g*te,p*T+m*A+x*N+g*z,p*I+m*b+x*D+g*xe];return new O(Fe)}};function gi(o,e){let t=o.Get(),r=e.Get();for(let i=0;i<16;i++)if(!P(t[i],r[i]))return!1;return!0}var H=class{constructor(e){e!=null?this.matrix=e:(this.matrix=new O,this.matrix.CreateIdentity())}SetMatrix(e){return this.matrix=e,this}GetMatrix(){return this.matrix}IsIdentity(){return this.matrix.IsIdentity()}AppendMatrix(e){return this.matrix=this.matrix.MultiplyMatrix(e),this}Append(e){return this.AppendMatrix(e.GetMatrix()),this}TransformCoord3D(e){let t=this.matrix.MultiplyVector([e.x,e.y,e.z,1]);return new y(t[0],t[1],t[2])}Clone(){let e=this.matrix.Clone();return new H(e)}};function bn(o,e){return gi(o.GetMatrix(),e.GetMatrix())}var Le={Empty:0,TriangleMesh:1};function Qe(o){return o.TriangleCount()>0?Le.TriangleMesh:Le.Empty}function ut(o,e,t){let r=$(e,o),i=$(t,o),n=be(r,i);return n.Normalize(),n}function Ue(o,e){if(!e.IsIdentity()){for(let t=0;t<o.VertexCount();t++){let r=o.GetVertex(t),i=e.TransformCoord3D(r);r.x=i.x,r.y=i.y,r.z=i.z}if(o.NormalCount()>0){let t=e.GetMatrix().DecomposeTRS(),r=new O().ComposeTRS(new y(0,0,0),t.rotation,new y(1,1,1)),i=new H(r);for(let n=0;n<o.NormalCount();n++){let s=o.GetNormal(n),l=i.TransformCoord3D(s);s.x=l.x,s.y=l.y,s.z=l.z}}}}function Ci(o){for(let e=0;e<o.TriangleCount();e++){let t=o.GetTriangle(e),r=t.v1;t.v1=t.v2,t.v2=r}}var ht=class{constructor(e,t){this.min=e,this.max=t}GetMin(){return this.min}GetMax(){return this.max}GetCenter(){return new y((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,(this.min.z+this.max.z)/2)}},Bt=class{constructor(){this.box=new ht(new y(1/0,1/0,1/0),new y(-1/0,-1/0,-1/0)),this.isValid=!1}GetBox(){return this.isValid?this.box:null}AddPoint(e){this.box.min.x=Math.min(this.box.min.x,e.x),this.box.min.y=Math.min(this.box.min.y,e.y),this.box.min.z=Math.min(this.box.min.z,e.z),this.box.max.x=Math.max(this.box.max.x,e.x),this.box.max.y=Math.max(this.box.max.y,e.y),this.box.max.z=Math.max(this.box.max.z,e.z),this.isValid=!0}};var ft=class{constructor(e,t){this.boundingBox=e,this.level=t,this.pointItems=[],this.childNodes=[]}AddPoint(e,t,r){let i=this.FindNodeForPoint(e);if(i===null||i.FindPointDirectly(e)!==null)return!1;if(i.pointItems.length<r.maxPointsPerNode||i.level>=r.maxTreeDepth)return i.AddPointDirectly(e,t),!0;{i.CreateChildNodes();let n=i.pointItems;i.pointItems=[];for(let s=0;s<n.length;s++){let l=n[s];if(!i.AddPoint(l.point,l.data,r))return!1}return i.AddPoint(e,t,r)}}FindPoint(e){let t=this.FindNodeForPoint(e);return t===null?null:t.FindPointDirectly(e)}AddPointDirectly(e,t){this.pointItems.push({point:e,data:t})}FindPointDirectly(e){for(let t=0;t<this.pointItems.length;t++){let r=this.pointItems[t];if(ge(e,r.point))return r.data}return null}FindNodeForPoint(e){if(!this.IsPointInBounds(e))return null;if(this.childNodes.length===0)return this;for(let t=0;t<this.childNodes.length;t++){let i=this.childNodes[t].FindNodeForPoint(e);if(i!==null)return i}return null}CreateChildNodes(){function e(l,a,u,h,f,d,c){let p=new ht(new y(a,u,h),new y(a+f,u+d,h+c));l.childNodes.push(new ft(p,l.level+1,l.options))}let t=this.boundingBox.min,r=this.boundingBox.GetCenter(),i=(this.boundingBox.max.x-this.boundingBox.min.x)/2,n=(this.boundingBox.max.y-this.boundingBox.min.y)/2,s=(this.boundingBox.max.z-this.boundingBox.min.z)/2;e(this,t.x,t.y,t.z,i,n,s),e(this,r.x,t.y,t.z,i,n,s),e(this,t.x,r.y,t.z,i,n,s),e(this,r.x,r.y,t.z,i,n,s),e(this,t.x,t.y,r.z,i,n,s),e(this,r.x,t.y,r.z,i,n,s),e(this,t.x,r.y,r.z,i,n,s),e(this,r.x,r.y,r.z,i,n,s)}IsPointInBounds(e){return At(e.x,this.boundingBox.min.x)&&At(e.y,this.boundingBox.min.y)&&At(e.z,this.boundingBox.min.z)&&St(e.x,this.boundingBox.max.x)&&St(e.y,this.boundingBox.max.y)&&St(e.z,this.boundingBox.max.z)}},Lt=class{constructor(e,t){this.options={maxPointsPerNode:10,maxTreeDepth:10},t!==void 0&&(t.maxPointsPerNode!==void 0&&(this.options.maxPointsPerNode=t.maxPointsPerNode),t.maxTreeDepth!==void 0&&(this.options.maxTreeDepth=t.maxTreeDepth)),this.rootNode=new ft(e,0,this.options)}AddPoint(e,t){return this.rootNode.AddPoint(e,t,this.options)}FindPoint(e){return this.rootNode.FindPoint(e)}};var Fr=class{constructor(){this.edges=[],this.triangles=[]}},Nr=class{constructor(e,t){this.vertex1=e,this.vertex2=t,this.triangles=[]}},Dr=class{constructor(e,t){this.edge=e,this.reversed=t}},Vr=class{constructor(){this.triEdge1=null,this.triEdge2=null,this.triEdge3=null}},Ut=class{constructor(){this.vertices=[],this.edges=[],this.triangleEdges=[],this.triangles=[],this.edgeStartToEndVertexMap=new Map}AddVertex(){return this.vertices.push(new Fr),this.vertices.length-1}AddTriangle(e,t,r){function i(u,h,f){u[h].triangles.push(f)}function n(u,h,f,d){let c=u[f],p=h[d];c.edges.push(p.edge)}function s(u,h,f,d){let c=h[f];u[c.edge].triangles.push(d)}let l=this.triangles.length,a=new Vr;a.triEdge1=this.AddTriangleEdge(e,t),a.triEdge2=this.AddTriangleEdge(t,r),a.triEdge3=this.AddTriangleEdge(r,e),i(this.vertices,e,l),i(this.vertices,t,l),i(this.vertices,r,l),n(this.vertices,this.triangleEdges,e,a.triEdge1),n(this.vertices,this.triangleEdges,t,a.triEdge2),n(this.vertices,this.triangleEdges,r,a.triEdge3),s(this.edges,this.triangleEdges,a.triEdge1,l),s(this.edges,this.triangleEdges,a.triEdge2,l),s(this.edges,this.triangleEdges,a.triEdge3,l),this.triangles.push(a)}AddTriangleEdge(e,t){let r=e,i=t,n=!1;t<e&&(r=t,i=e,n=!0);let s=this.AddEdge(r,i);return this.triangleEdges.push(new Dr(s,n)),this.triangleEdges.length-1}AddEdge(e,t){this.edgeStartToEndVertexMap.has(e)||this.edgeStartToEndVertexMap.set(e,[]);let r=this.edgeStartToEndVertexMap.get(e);for(let n=0;n<r.length;n++){let s=r[n];if(s.endVertex===t)return s.edgeIndex}let i=this.edges.length;return r.push({endVertex:t,edgeIndex:i}),this.edges.push(new Nr(e,t)),i}};function zt(o){let e=!0;return o.EnumerateMeshInstances(t=>{Qe(t)!==Le.Empty&&(e=!1)}),e}function Di(o){let e=new Bt;return o.EnumerateVertices(t=>{e.AddPoint(t)}),e.GetBox()}function Vi(o){function e(n,s,l){let a=s.FindPoint(n);return a===null&&(a=l.AddVertex(),s.AddPoint(n,a)),a}let t=Di(o),r=new Lt(t),i=new Ut;return o.EnumerateTriangleVertices((n,s,l)=>{let a=e(n,r,i),u=e(s,r,i),h=e(l,r,i);i.AddTriangle(a,u,h)}),i}function wn(o){function e(r,i,n){let s=r.triangles[i],l=r.triangleEdges[s.triEdge1],a=r.triangleEdges[s.triEdge2],u=r.triangleEdges[s.triEdge3];return l.edge===n?l.reversed:a.edge===n?a.reversed:u.edge===n?u.reversed:null}let t=Vi(o);for(let r=0;r<t.edges.length;r++){let i=t.edges[r],n=i.triangles.length;if(n===0||n%2!==0)return!1;let s=0;for(let l=0;l<i.triangles.length;l++){let a=i.triangles[l];e(t,a,r)?s+=1:s-=1}if(s!==0)return!1}return!0}function Sn(o){for(let e=0;e<o.MaterialCount();e++){let t=o.GetMaterial(e);if(t.isDefault&&!t.vertexColors)return!0}return!1}function An(o,e){for(let t=0;t<o.MaterialCount();t++){let r=o.GetMaterial(t);r.isDefault&&(r.color=e)}}var ce={Text:1,Integer:2,Number:3,Boolean:4,Percent:5,Color:6},re=class{constructor(e,t,r){this.type=e,this.name=t,this.value=r}},Te=class{constructor(e){this.name=e,this.properties=[]}PropertyCount(){return this.properties.length}AddProperty(e){this.properties.push(e)}GetProperty(e){return this.properties[e]}};var qe=class{constructor(e,t){this.nodeId=e,this.meshIndex=t}IsEqual(e){return this.nodeId===e.nodeId&&this.meshIndex===e.meshIndex}GetKey(){return this.nodeId.toString()+":"+this.meshIndex.toString()}},dt=class extends Be{constructor(e,t,r){super(),this.id=e,this.node=t,this.mesh=r}GetId(){return this.id}GetTransformation(){return this.node.GetWorldTransformation()}GetMesh(){return this.mesh}VertexCount(){return this.mesh.VertexCount()}VertexColorCount(){return this.mesh.VertexColorCount()}NormalCount(){return this.mesh.NormalCount()}TextureUVCount(){return this.mesh.TextureUVCount()}TriangleCount(){return this.mesh.TriangleCount()}EnumerateVertices(e){let t=this.node.GetWorldTransformation();t.IsIdentity()?this.mesh.EnumerateVertices(e):this.mesh.EnumerateVertices(r=>{let i=t.TransformCoord3D(r);e(i)})}EnumerateTriangleVertexIndices(e){this.mesh.EnumerateTriangleVertexIndices(e)}EnumerateTriangleVertices(e){let t=this.node.GetWorldTransformation();t.IsIdentity()?this.mesh.EnumerateTriangleVertices(e):this.mesh.EnumerateTriangleVertices((r,i,n)=>{let s=t.TransformCoord3D(r),l=t.TransformCoord3D(i),a=t.TransformCoord3D(n);e(s,l,a)})}PropertyGroupCount(){return this.mesh.PropertyGroupCount()}AddPropertyGroup(e){return this.mesh.AddPropertyGroup(e)}GetPropertyGroup(e){return this.mesh.GetPropertyGroup(e)}GetTransformedMesh(){let e=this.node.GetWorldTransformation(),t=this.mesh.Clone();return Ue(t,e),t}};var Pi=class{constructor(){this.nextId=0}GenerateId(){let e=this.nextId;return this.nextId+=1,e}},Ge={GroupNode:0,MeshNode:1},pe=class{constructor(){this.type=Ge.GroupNode,this.name="",this.parent=null,this.transformation=new H,this.childNodes=[],this.meshIndices=[],this.idGenerator=new Pi,this.id=this.idGenerator.GenerateId()}IsEmpty(){return this.childNodes.length===0&&this.meshIndices.length===0}GetType(){return this.type}SetType(e){this.type=e}GetId(){return this.id}GetName(){return this.name}SetName(e){this.name=e}HasParent(){return this.parent!==null}GetParent(){return this.parent}GetTransformation(){return this.transformation}GetWorldTransformation(){let e=this.transformation.Clone(),t=this.parent;for(;t!==null;)e.Append(t.transformation),t=t.parent;return e}SetTransformation(e){this.transformation=e}AddChildNode(e){return e.parent=this,e.idGenerator=this.idGenerator,e.id=e.idGenerator.GenerateId(),this.childNodes.push(e),this.childNodes.length-1}RemoveChildNode(e){e.parent=null;let t=this.childNodes.indexOf(e);this.childNodes.splice(t,1)}GetChildNodes(){return this.childNodes}ChildNodeCount(){return this.childNodes.length}GetChildNode(e){return this.childNodes[e]}AddMeshIndex(e){return this.meshIndices.push(e),this.meshIndices.length-1}MeshIndexCount(){return this.meshIndices.length}GetMeshIndex(e){return this.meshIndices[e]}GetMeshIndices(){return this.meshIndices}Enumerate(e){e(this);for(let t of this.childNodes)t.Enumerate(e)}EnumerateChildren(e){for(let t of this.childNodes)e(t),t.EnumerateChildren(e)}EnumerateMeshIndices(e){for(let t of this.meshIndices)e(t);for(let t of this.childNodes)t.EnumerateMeshIndices(e)}};var Ht=class extends Be{constructor(){super(),this.root=new pe,this.materials=[],this.meshes=[]}GetRootNode(){return this.root}MaterialCount(){return this.materials.length}MeshCount(){return this.meshes.length}MeshInstanceCount(){let e=0;return this.root.Enumerate(t=>{e+=t.MeshIndexCount()}),e}VertexCount(){let e=0;return this.EnumerateMeshInstances(t=>{e+=t.VertexCount()}),e}VertexColorCount(){let e=0;return this.EnumerateMeshInstances(t=>{e+=t.VertexColorCount()}),e}NormalCount(){let e=0;return this.EnumerateMeshInstances(t=>{e+=t.NormalCount()}),e}TextureUVCount(){let e=0;return this.EnumerateMeshInstances(t=>{e+=t.TextureUVCount()}),e}TriangleCount(){let e=0;return this.EnumerateMeshInstances(t=>{e+=t.TriangleCount()}),e}AddMaterial(e){return this.materials.push(e),this.materials.length-1}GetMaterial(e){return this.materials[e]}AddMesh(e){return this.meshes.push(e),this.meshes.length-1}AddMeshToRootNode(e){let t=this.AddMesh(e);return this.root.AddMeshIndex(t),t}RemoveMesh(e){this.meshes.splice(e,1),this.root.Enumerate(t=>{for(let r=0;r<t.meshIndices.length;r++)t.meshIndices[r]===e?(t.meshIndices.splice(r,1),r-=1):t.meshIndices[r]>e&&(t.meshIndices[r]-=1)})}GetMesh(e){return this.meshes[e]}GetMeshInstance(e){let t=null;if(this.root.Enumerate(s=>{s.GetId()===e.nodeId&&(t=s)}),t===null||t.GetMeshIndices().indexOf(e.meshIndex)===-1)return null;let i=this.GetMesh(e.meshIndex),n=new qe(t.GetId(),e.meshIndex);return new dt(n,t,i)}EnumerateMeshes(e){for(let t of this.meshes)e(t)}EnumerateMeshInstances(e){this.root.Enumerate(t=>{for(let r of t.GetMeshIndices()){let i=new qe(t.GetId(),r),n=this.GetMesh(r),s=new dt(i,t,n);e(s)}})}EnumerateTransformedMeshes(e){this.EnumerateMeshInstances(t=>{let r=t.GetTransformedMesh();e(r)})}EnumerateVertices(e){this.EnumerateMeshInstances(t=>{t.EnumerateVertices(e)})}EnumerateTriangleVertexIndices(e){this.EnumerateMeshInstances(t=>{t.EnumerateTriangleVertexIndices(e)})}EnumerateTriangleVertices(e){this.EnumerateMeshInstances(t=>{t.EnumerateTriangleVertices(e)})}};var Oi=class{constructor(e){this.params={getDefaultMaterialColor:()=>new F(0,0,0)},Mt(e,this.params),this.defaultMaterialIndex=null}Finalize(e){this.Reset(),this.FinalizeMeshes(e),this.FinalizeMaterials(e),this.FinalizeNodes(e)}FinalizeMaterials(e){if(!(e.VertexColorCount()>0))return;let r=new Map;for(let i=0;i<e.MeshCount();i++){let n=e.GetMesh(i);for(let s=0;s<n.TriangleCount();s++){let l=n.GetTriangle(s),a=l.HasVertexColors();r.has(l.mat)?a||r.set(l.mat,!1):r.set(l.mat,a)}}for(let[i,n]of r){let s=e.GetMaterial(i);s.vertexColors=n}}FinalizeMeshes(e){for(let t=0;t<e.MeshCount();t++){let r=e.GetMesh(t);if(Qe(r)===Le.Empty){e.RemoveMesh(t),t=t-1;continue}this.FinalizeMesh(e,r)}}FinalizeMesh(e,t){function r(n){function s(u,h,f,d,c){function p(C,E){for(let T=0;T<C.length;T++){let I=C[T];if(ge(I,E))return!0}return!1}let m=[],x=c.get(f);for(let C=0;C<x.length;C++){let E=x[C],T=u.GetTriangle(E);if(h.curve===T.curve){let I=d[E];p(m,I)||m.push(I)}}let g=new y(0,0,0);for(let C=0;C<m.length;C++)g=ri(g,m[C]);return g.MultiplyScalar(1/m.length),g.Normalize(),u.AddNormal(g)}let l=[],a=new Map;for(let u=0;u<n.VertexCount();u++)a.set(u,[]);for(let u=0;u<n.TriangleCount();u++){let h=n.GetTriangle(u),f=n.GetVertex(h.v0),d=n.GetVertex(h.v1),c=n.GetVertex(h.v2),p=ut(f,d,c);l.push(p),a.get(h.v0).push(u),a.get(h.v1).push(u),a.get(h.v2).push(u)}for(let u=0;u<n.TriangleCount();u++){let h=n.GetTriangle(u);if(!h.HasNormals()){let f=s(n,h,h.v0,l,a),d=s(n,h,h.v1,l,a),c=s(n,h,h.v2,l,a);h.SetNormals(f,d,c)}}}let i={calculateCurveNormals:!1};for(let n=0;n<t.TriangleCount();n++){let s=t.GetTriangle(n);this.FinalizeTriangle(t,s,i),s.mat===null&&(s.mat=this.GetDefaultMaterialIndex(e))}i.calculateCurveNormals&&r(t)}FinalizeTriangle(e,t,r){if(!t.HasNormals())if(t.curve===null||t.curve===0){let i=e.GetVertex(t.v0),n=e.GetVertex(t.v1),s=e.GetVertex(t.v2),l=ut(i,n,s),a=e.AddNormal(l);t.SetNormals(a,a,a)}else r.calculateCurveNormals=!0;t.curve===null&&(t.curve=0)}FinalizeNodes(e){let t=e.GetRootNode(),r=[];t.EnumerateChildren(i=>{i.IsEmpty()&&r.push(i)});for(let i=0;i<r.length;i++){let n=r[i],s=n.GetParent();s!==null&&(s.RemoveChildNode(n),s.IsEmpty()&&r.push(s))}}GetDefaultMaterialIndex(e){if(this.defaultMaterialIndex===null){let t=this.params.getDefaultMaterialColor(),r=new q;r.color=t,r.isDefault=!0,this.defaultMaterialIndex=e.AddMaterial(r)}return this.defaultMaterialIndex}Reset(){this.defaultMaterialIndex=null}};function Ti(o,e){new Oi(e).Finalize(o)}function Gn(o){function e(n){return n!=null}function t(n){return!(!e(n)||isNaN(n))}function r(n,s){return!(!t(n)||n<0||n>=s)}function i(n,s){function l(a,u,h){return!(!r(h.v0,u.VertexCount())||!r(h.v1,u.VertexCount())||!r(h.v2,u.VertexCount())||h.HasVertexColors()&&(!r(h.c0,u.VertexColorCount())||!r(h.c1,u.VertexColorCount())||!r(h.c2,u.VertexColorCount()))||!r(h.n0,u.NormalCount())||!r(h.n1,u.NormalCount())||!r(h.n2,u.NormalCount())||h.HasTextureUVs()&&(!r(h.u0,u.TextureUVCount())||!r(h.u1,u.TextureUVCount())||!r(h.u2,u.TextureUVCount()))||!r(h.mat,a.MaterialCount())||!t(h.curve))}for(let a=0;a<s.VertexCount();a++){let u=s.GetVertex(a);if(!t(u.x)||!t(u.y)||!t(u.z))return!1}for(let a=0;a<s.VertexColorCount();a++){let u=s.GetVertexColor(a);if(!t(u.r)||!t(u.g)||!t(u.b))return!1}for(let a=0;a<s.NormalCount();a++){let u=s.GetNormal(a);if(!t(u.x)||!t(u.y)||!t(u.z))return!1}for(let a=0;a<s.TextureUVCount();a++){let u=s.GetTextureUV(a);if(!t(u.x)||!t(u.y))return!1}for(let a=0;a<s.TriangleCount();a++){let u=s.GetTriangle(a);if(!l(n,s,u))return!1}return!0}for(let n=0;n<o.MeshCount();n++){let s=o.GetMesh(n);if(!i(o,s))return!1}return!0}var k=class{constructor(){this.name=null,this.extension=null,this.callbacks=null,this.model=null,this.error=null,this.message=null}Import(e,t,r,i){this.Clear(),this.name=e,this.extension=t,this.callbacks=i,this.model=new Ht,this.error=!1,this.message=null,this.ResetContent(),this.ImportContent(r,()=>{this.CreateResult(i)})}Clear(){this.name=null,this.extension=null,this.callbacks=null,this.model=null,this.error=null,this.message=null,this.ClearContent()}CreateResult(e){if(this.error){e.onError(),e.onComplete();return}if(zt(this.model)){this.SetError("The model doesn't contain any meshes."),e.onError(),e.onComplete();return}Ti(this.model,{getDefaultMaterialColor:this.callbacks.getDefaultMaterialColor}),e.onSuccess(),e.onComplete()}CanImportExtension(e){return!1}GetUpDirection(){return R.Z}ClearContent(){}ResetContent(){}ImportContent(e,t){}GetModel(){return this.model}SetError(e){this.error=!0,e!=null&&(this.message=e)}WasError(){return this.error}GetErrorMessage(){return this.message}};function ze(o,e,t){let r=o.substring(e),i=r.indexOf(t);return i!==-1&&(r=r.substring(0,i)),r.trim()}function ve(o,e){if(e!==null){let t=o.indexOf(e);t!==-1&&(o=o.substring(0,t).trim())}return o.split(/\s+/u)}function Me(o,e){function t(n,s){let l=n.trim();l.length>0&&s(l)}let r=0,i=o.indexOf(`
`,r);for(;i!==-1;)t(o.substring(r,i),e),r=i+1,i=o.indexOf(`
`,r);t(o.substring(r),e)}function Bi(o){return(o&o-1)===0}function vn(o){if(Bi(o))return o;let e=Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)));return parseInt(e,10)}function ae(o){o.transparent=!1,wt(o.opacity,1)&&(o.transparent=!0)}var _t=class extends k{constructor(){super(),this.rhino=null}CanImportExtension(e){return e==="3dm"}GetUpDirection(){return R.Z}ClearContent(){this.instanceIdToObject=null,this.instanceIdToDefinition=null}ResetContent(){this.instanceIdToObject=new Map,this.instanceIdToDefinition=new Map}ImportContent(e,t){this.rhino===null?he("loaders/rhino3dm.min.js").then(()=>{rhino3dm().then(r=>{this.rhino=r,this.ImportRhinoContent(e),t()})}).catch(()=>{t()}):(this.ImportRhinoContent(e),t())}ImportRhinoContent(e){let t=this.rhino.File3dm.fromByteArray(e);if(t===null){this.SetError("Failed to read Rhino file.");return}this.ImportRhinoDocument(t),zt(this.model)&&this.SetError("The model doesn't contain any 3D meshes. Try to save the model while you are in shaded view in Rhino.")}ImportRhinoDocument(e){this.InitRhinoInstances(e),this.ImportRhinoUserStrings(e),this.ImportRhinoGeometry(e)}InitRhinoInstances(e){let t=e.objects();for(let i=0;i<t.count;i++){let n=t.get(i),s=n.attributes();s.isInstanceDefinitionObject&&this.instanceIdToObject.set(s.id,n)}let r=e.instanceDefinitions();for(let i=0;i<r.count();i++){let n=r.get(i);this.instanceIdToDefinition.set(n.id,n)}}ImportRhinoUserStrings(e){let t=e.strings();if(t.count()>0){let r=new Te("Document user texts");for(let i=0;i<t.count();i++){let n=t.get(i);r.AddProperty(new re(ce.Text,n[0],n[1]))}this.model.AddPropertyGroup(r)}}ImportRhinoGeometry(e){let t=e.objects();for(let r=0;r<t.count;r++){let i=t.get(r);this.ImportRhinoGeometryObject(e,i,[])}}ImportRhinoGeometryObject(e,t,r){let i=t.geometry(),n=t.attributes(),s=i.objectType;if(n.isInstanceDefinitionObject&&r.length===0)return;let l=null,a=!1;if(s===this.rhino.ObjectType.Mesh)l=i,a=!1;else if(s===this.rhino.ObjectType.Extrusion)l=i.getMesh(this.rhino.MeshType.Any),a=!0;else if(s===this.rhino.ObjectType.Brep){l=new this.rhino.Mesh;let u=i.faces();for(let h=0;h<u.count;h++){let f=u.get(h),d=f.getMesh(this.rhino.MeshType.Any);d&&(l.append(d),d.delete()),f.delete()}u.delete(),l.compact(),a=!0}else if(s===this.rhino.ObjectType.SubD)i.subdivide(3),l=this.rhino.Mesh.createFromSubDControlNet(i),a=!0;else if(s===this.rhino.ObjectType.InstanceReference){let u=i.parentIdefId;if(this.instanceIdToDefinition.has(u)){let f=this.instanceIdToDefinition.get(u).getObjectIds();for(let d=0;d<f.length;d++){let c=f[d];if(this.instanceIdToObject.has(c)){let p=this.instanceIdToObject.get(c);r.push(t),this.ImportRhinoGeometryObject(e,p,r),r.pop()}}}}l!==null&&(this.ImportRhinoMesh(e,l,t,r),a&&l.delete())}ImportRhinoMesh(e,t,r,i){let n=r.attributes(),s=this.GetMaterialIndex(e,r,i),l=t.toThreejsJSON(),a=ot(l.data,s);a.SetName(n.name);let u=n.getUserStrings();if(u.length>0){let h=new Te("User texts");for(let f=0;f<u.length;f++){let d=u[f];h.AddProperty(new re(ce.Text,d[0],d[1]))}a.AddPropertyGroup(h)}if(i.length!==0){let h=new O().CreateIdentity();for(let d=i.length-1;d>=0;d--){let m=i[d].geometry().xform.toFloatArray(!1),x=new O(m);h=h.MultiplyMatrix(x)}let f=new H(h);Ue(a,f)}this.model.AddMeshToRootNode(a)}GetMaterialIndex(e,t,r){function i(l,a,u){let h=a.attributes();if(h.materialSource===l.ObjectMaterialSource.MaterialFromObject){let f=h.materialIndex;if(f>-1)return e.materials().get(f)}else if(h.materialSource===l.ObjectMaterialSource.MaterialFromLayer){let f=h.layerIndex;if(f>-1){let c=e.layers().get(f).renderMaterialIndex;if(c>-1)return e.materials().get(c)}}else if(h.materialSource===l.ObjectMaterialSource.MaterialFromParent&&u.length!==0)return i(l,u[0],[]);return null}function n(l,a){function u(c,p){c.Set(p.r,p.g,p.b)}function h(c){return c.r===0&&c.g===0&&c.b===0}function f(c){return c.r===255&&c.g===255&&c.b===255}let d=null;if(a===null)d=new q,d.color.Set(255,255,255);else{let c=a.physicallyBased();c.supported?(d=new Oe,d.metalness=c.metallic?1:0,d.roughness=c.roughness):(d=new q,u(d.ambient,a.ambientColor),u(d.specular,a.specularColor)),d.name=a.name,u(d.color,a.diffuseColor),d.opacity=1-a.transparency,ae(d),h(d.color)&&!f(a.reflectionColor)&&u(d.color,a.reflectionColor),h(d.color)&&!f(a.transparentColor)&&u(d.color,a.transparentColor)}for(let c=0;c<l.MaterialCount();c++)if(l.GetMaterial(c).IsEqual(d))return c;return l.AddMaterial(d)}let s=i(this.rhino,t,r);return n(this.model,s)}};var S={MAIN3DS:19789,EDIT3DS:15677,EDIT_MATERIAL:45055,MAT_NAME:40960,MAT_AMBIENT:40976,MAT_DIFFUSE:40992,MAT_SPECULAR:41008,MAT_SHININESS:41024,MAT_SHININESS_STRENGTH:41025,MAT_TRANSPARENCY:41040,MAT_COLOR_F:16,MAT_COLOR:17,MAT_LIN_COLOR:18,MAT_LIN_COLOR_F:19,MAT_TEXMAP:41472,MAT_TEXMAP_NAME:41728,MAT_TEXMAP_UOFFSET:41816,MAT_TEXMAP_VOFFSET:41818,MAT_TEXMAP_USCALE:41812,MAT_TEXMAP_VSCALE:41814,MAT_TEXMAP_ROTATION:41820,PERCENTAGE:48,PERCENTAGE_F:49,EDIT_OBJECT:16384,OBJ_TRIMESH:16640,OBJ_LIGHT:17920,OBJ_CAMERA:18176,TRI_VERTEX:16656,TRI_TEXVERTEX:16704,TRI_FACE:16672,TRI_TRANSFORMATION:16736,TRI_MATERIAL:16688,TRI_SMOOTH:16720,KF3DS:45056,OBJECT_NODE:45058,OBJECT_HIERARCHY:45072,OBJECT_INSTANCE_NAME:45073,OBJECT_PIVOT:45075,OBJECT_POSITION:45088,OBJECT_ROTATION:45089,OBJECT_SCALE:45090,OBJECT_ID:45104},Li=class{constructor(){this.id=-1,this.name="",this.flags=-1,this.parentId=-1,this.instanceName="",this.pivot=[0,0,0],this.positions=[],this.rotations=[],this.scales=[]}},Ui=class{constructor(){this.nodes=[],this.nodeIdToNode=new Map}IsEmpty(){return this.nodes.length===0}AddNode(e){this.nodes.push(e),this.nodeIdToNode.set(e.nodeId,e)}GetNodes(){return this.nodes}},jt=class extends k{constructor(){super()}CanImportExtension(e){return e==="3ds"}GetUpDirection(){return R.Z}ClearContent(){this.materialNameToIndex=null,this.meshNameToIndex=null,this.nodeList=null}ResetContent(){this.materialNameToIndex=new Map,this.meshNameToIndex=new Map,this.nodeList=new Ui}ImportContent(e,t){this.ProcessBinary(e),t()}ProcessBinary(e){let t=new ne(e,!0),r=t.GetByteLength();this.ReadChunks(t,r,(i,n)=>{i===S.MAIN3DS?this.ReadMainChunk(t,n):this.SkipChunk(t,n)})}ReadMainChunk(e,t){let r=this.GetChunkEnd(e,t);this.ReadChunks(e,r,(i,n)=>{i===S.EDIT3DS?this.ReadEditorChunk(e,n):i===S.KF3DS?this.ReadKeyFrameChunk(e,n):this.SkipChunk(e,n)}),this.BuildNodeHierarchy()}ReadEditorChunk(e,t){let r=this.GetChunkEnd(e,t);this.ReadChunks(e,r,(i,n)=>{i===S.EDIT_MATERIAL?this.ReadMaterialChunk(e,n):i===S.EDIT_OBJECT?this.ReadObjectChunk(e,n):this.SkipChunk(e,n)})}ReadMaterialChunk(e,t){let r=new q,i=this.GetChunkEnd(e,t),n=null,s=null;this.ReadChunks(e,i,(a,u)=>{a===S.MAT_NAME?r.name=this.ReadName(e):a===S.MAT_AMBIENT?r.ambient=this.ReadColorChunk(e,u):a===S.MAT_DIFFUSE?r.color=this.ReadColorChunk(e,u):a===S.MAT_SPECULAR?r.specular=this.ReadColorChunk(e,u):a===S.MAT_SHININESS?n=this.ReadPercentageChunk(e,u):a===S.MAT_SHININESS_STRENGTH?s=this.ReadPercentageChunk(e,u):a===S.MAT_TRANSPARENCY?(r.opacity=1-this.ReadPercentageChunk(e,u),ae(r)):a===S.MAT_TEXMAP?(r.diffuseMap=this.ReadTextureMapChunk(e,u),ae(r)):this.SkipChunk(e,u)}),n!==null&&s!==null&&(r.shininess=n*s/10);let l=this.model.AddMaterial(r);this.materialNameToIndex.set(r.name,l)}ReadTextureMapChunk(e,t){let r=new ye,i=this.GetChunkEnd(e,t);return this.ReadChunks(e,i,(n,s)=>{if(n===S.MAT_TEXMAP_NAME){let l=this.ReadName(e),a=this.callbacks.getTextureBuffer(l);r.name=l,a!==null&&(r.url=a.url,r.buffer=a.buffer)}else n===S.MAT_TEXMAP_UOFFSET?r.offset.x=e.ReadFloat32():n===S.MAT_TEXMAP_VOFFSET?r.offset.y=e.ReadFloat32():n===S.MAT_TEXMAP_USCALE?r.scale.x=e.ReadFloat32():n===S.MAT_TEXMAP_VSCALE?r.scale.y=e.ReadFloat32():n===S.MAT_TEXMAP_ROTATION?r.rotation=e.ReadFloat32()*Je:this.SkipChunk(e,s)}),r}ReadColorChunk(e,t){let r=new F(0,0,0),i=this.GetChunkEnd(e,t),n=!1;return this.ReadChunks(e,i,(s,l)=>{s===S.MAT_COLOR?n||(r.r=e.ReadUnsignedCharacter8(),r.g=e.ReadUnsignedCharacter8(),r.b=e.ReadUnsignedCharacter8()):s===S.MAT_LIN_COLOR?(r.r=e.ReadUnsignedCharacter8(),r.g=e.ReadUnsignedCharacter8(),r.b=e.ReadUnsignedCharacter8(),n=!0):s===S.MAT_COLOR_F?n||(r.r=fe(e.ReadFloat32()),r.g=fe(e.ReadFloat32()),r.b=fe(e.ReadFloat32())):s===S.MAT_LIN_COLOR_F?(r.r=fe(e.ReadFloat32()),r.g=fe(e.ReadFloat32()),r.b=fe(e.ReadFloat32()),n=!0):this.SkipChunk(e,l)}),r}ReadPercentageChunk(e,t){let r=0,i=this.GetChunkEnd(e,t);return this.ReadChunks(e,i,(n,s)=>{n===S.PERCENTAGE?r=e.ReadUnsignedInteger16()/100:n===S.PERCENTAGE_F?r=e.ReadFloat32():this.SkipChunk(e,s)}),r}ReadObjectChunk(e,t){let r=this.GetChunkEnd(e,t),i=this.ReadName(e);this.ReadChunks(e,r,(n,s)=>{n===S.OBJ_TRIMESH?this.ReadMeshChunk(e,s,i):n===S.OBJ_LIGHT?this.SkipChunk(e,s):n===S.OBJ_CAMERA?this.SkipChunk(e,s):this.SkipChunk(e,s)})}ReadMeshChunk(e,t,r){function i(h,f){if(!f.IsValid())return;let d=f.Determinant(),c=Gt(d);c&&(f=new O().CreateScale(-1,1,1).MultiplyMatrix(f));let p=f.Invert();if(p===null)return;let m=new H(p);Ue(h,m),c&&Ci(h)}let n=new j;n.SetName(r);let s=this.GetChunkEnd(e,t),l=null;if(this.ReadChunks(e,s,(h,f)=>{h===S.TRI_VERTEX?this.ReadVerticesChunk(n,e):h===S.TRI_TEXVERTEX?this.ReadTextureVerticesChunk(n,e):h===S.TRI_FACE?this.ReadFacesChunk(n,e,f):h===S.TRI_TRANSFORMATION?l=this.ReadTransformationChunk(e):this.SkipChunk(e,f)}),n.VertexCount()===n.TextureUVCount())for(let h=0;h<n.TriangleCount();h++){let f=n.GetTriangle(h);f.SetTextureUVs(f.v0,f.v1,f.v2)}let a=new O(l);i(n,a);let u=this.model.AddMesh(n);this.meshNameToIndex.set(n.GetName(),u)}ReadVerticesChunk(e,t){let r=t.ReadUnsignedInteger16();for(let i=0;i<r;i++){let n=t.ReadFloat32(),s=t.ReadFloat32(),l=t.ReadFloat32();e.AddVertex(new y(n,s,l))}}ReadTextureVerticesChunk(e,t){let r=t.ReadUnsignedInteger16();for(let i=0;i<r;i++){let n=t.ReadFloat32(),s=t.ReadFloat32();e.AddTextureUV(new v(n,s))}}ReadFacesChunk(e,t,r){let i=this.GetChunkEnd(t,r),n=t.ReadUnsignedInteger16();for(let s=0;s<n;s++){let l=t.ReadUnsignedInteger16(),a=t.ReadUnsignedInteger16(),u=t.ReadUnsignedInteger16();t.ReadUnsignedInteger16(),e.AddTriangle(new U(l,a,u))}this.ReadChunks(t,i,(s,l)=>{s===S.TRI_MATERIAL?this.ReadFaceMaterialsChunk(e,t):s===S.TRI_SMOOTH?this.ReadFaceSmoothingGroupsChunk(e,n,t):this.SkipChunk(t,l)})}ReadFaceMaterialsChunk(e,t){let r=this.ReadName(t),i=this.materialNameToIndex.get(r),n=t.ReadUnsignedInteger16();for(let s=0;s<n;s++){let l=t.ReadUnsignedInteger16(),a=e.GetTriangle(l);i!==void 0&&(a.mat=i)}}ReadFaceSmoothingGroupsChunk(e,t,r){for(let i=0;i<t;i++){let n=r.ReadUnsignedInteger32(),s=e.GetTriangle(i);s.curve=n}}ReadTransformationChunk(e){let t=[];for(let r=0;r<4;r++){for(let i=0;i<3;i++)t.push(e.ReadFloat32());r<3?t.push(0):t.push(1)}return t}ReadKeyFrameChunk(e,t){let r=this.GetChunkEnd(e,t);this.ReadChunks(e,r,(i,n)=>{i===S.OBJECT_NODE?this.ReadObjectNodeChunk(e,n):this.SkipChunk(e,n)})}BuildNodeHierarchy(){function e(r,i){function n(u){return u.positions.length===0?[0,0,0]:u.positions[0]}function s(u){function h(d){let c=[0,0,0,1],p=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);if(p>0){let m=d[3]*-.5,x=Math.sin(m)/p;c=[x*d[0],x*d[1],x*d[2],Math.cos(m)]}return c}if(u.rotations.length===0)return[0,0,0,1];let f=u.rotations[0];return h(f)}function l(u){return u.scales.length===0?[1,1,1]:u.scales[0]}let a=new O;if(a.ComposeTRS(we(n(r)),Ze(s(r)),we(l(r))),i){let u=r.pivot;a=new O().CreateTranslation(-u[0],-u[1],-u[2]).MultiplyMatrix(a)}return new H(a)}let t=this.model.GetRootNode();if(this.nodeList.IsEmpty())for(let r=0;r<this.model.MeshCount();r++)t.AddMeshIndex(r);else{let r=new Map;for(let i of this.nodeList.GetNodes()){let n=new pe;i.name.length>0&&i.name!=="$$$DUMMY"&&(n.SetName(i.name),i.instanceName.length>0&&n.SetName(n.GetName()+" "+i.instanceName)),i.parentId===65535||!r.has(i.parentId)?t.AddChildNode(n):r.get(i.parentId).AddChildNode(n),r.set(i.id,n);let s=this.meshNameToIndex.has(i.name);n.SetTransformation(e(i,s)),s&&(n.SetType(Ge.MeshNode),n.AddMeshIndex(this.meshNameToIndex.get(i.name)))}}}ReadObjectNodeChunk(e,t){function r(s,l,a){let u=[];l.Skip(10);let h=l.ReadInteger32();for(let f=0;f<h;f++){l.ReadInteger32(),l.ReadUnsignedInteger16()!==0&&l.ReadFloat32();let c=null;if(a===S.OBJECT_ROTATION){let p=l.ReadFloat32();c=s.ReadVector(l),c[3]=p}else c=s.ReadVector(l);u.push(c)}return u}let i=new Li,n=this.GetChunkEnd(e,t);this.ReadChunks(e,n,(s,l)=>{s===S.OBJECT_HIERARCHY?(i.name=this.ReadName(e),i.flags=e.ReadUnsignedInteger32(),i.parentId=e.ReadUnsignedInteger16()):s===S.OBJECT_INSTANCE_NAME?i.instanceName=this.ReadName(e):s===S.OBJECT_PIVOT?i.pivot=this.ReadVector(e):s===S.OBJECT_POSITION?i.positions=r(this,e,S.OBJECT_POSITION):s===S.OBJECT_ROTATION?i.rotations=r(this,e,S.OBJECT_ROTATION):s===S.OBJECT_SCALE?i.scales=r(this,e,S.OBJECT_SCALE):s===S.OBJECT_ID?i.id=e.ReadUnsignedInteger16():this.SkipChunk(e,l)}),this.nodeList.AddNode(i)}ReadName(e){let t="",r=0,i=0;for(;i<64&&(r=e.ReadCharacter8(),r!==0);)t=t+String.fromCharCode(r),i=i+1;return t}ReadVector(e){return[e.ReadFloat32(),e.ReadFloat32(),e.ReadFloat32()]}ReadChunks(e,t,r){for(;e.GetPosition()<=t-6;){let i=e.ReadUnsignedInteger16(),n=e.ReadUnsignedInteger32();r(i,n)}}GetChunkEnd(e,t){return e.GetPosition()+t-6}SkipChunk(e,t){e.Skip(t-6)}};var Xe=class{constructor(e,t,r,i){this.x=e,this.y=t,this.z=r,this.w=i}Clone(){return new Xe(this.x,this.y,this.z,this.w)}};var Ee={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126},Re={SCALAR:0,VEC2:1,VEC3:2,VEC4:3,MAT2:4,MAT3:5,MAT4:6},mt={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},zi={GLTF_STRING:1179937895,JSON_CHUNK_TYPE:1313821514,BINARY_CHUNK_TYPE:5130562};function Pr(o){return Ve(st(o[0]),st(o[1]),st(o[2]))}function Hn(o,e){function t(r,i){let n=r;return i!==Ee.FLOAT&&(n/=255),fe(st(n))}return new F(t(o[0],e),t(o[1],e),t(o[2],e))}var Hi=class{constructor(e){this.reader=new ne(e,!0),this.componentType=null,this.dataType=null,this.byteStride=null,this.dataCount=null,this.sparseReader=null}SetComponentType(e){this.componentType=e}SetDataType(e){e==="SCALAR"?this.dataType=Re.SCALAR:e==="VEC2"?this.dataType=Re.VEC2:e==="VEC3"?this.dataType=Re.VEC3:e==="VEC4"?this.dataType=Re.VEC4:e==="MAT2"?this.dataType=Re.MAT2:e==="MAT3"?this.dataType=Re.MAT3:e==="MAT4"&&(this.dataType=Re.MAT4)}SetByteStride(e){this.byteStride=e}SetDataCount(e){this.dataCount=e}SetSparseReader(e,t){this.sparseReader={indexReader:e,valueReader:t}}ReadArrayBuffer(e){return this.reader.ReadArrayBuffer(e)}GetDataCount(){return this.dataCount}ReadData(){if(this.dataType===null)return null;if(this.dataType===Re.SCALAR){let e=this.ReadComponent();return this.SkipBytesByStride(1),e}else if(this.dataType===Re.VEC2){let e=this.ReadComponent(),t=this.ReadComponent();return this.SkipBytesByStride(2),new v(e,t)}else if(this.dataType===Re.VEC3){let e=this.ReadComponent(),t=this.ReadComponent(),r=this.ReadComponent();return this.SkipBytesByStride(3),new y(e,t,r)}else if(this.dataType===Re.VEC4){let e=this.ReadComponent(),t=this.ReadComponent(),r=this.ReadComponent(),i=this.ReadComponent();return this.SkipBytesByStride(4),new Xe(e,t,r,i)}return null}EnumerateData(e){if(this.sparseReader===null)for(let t=0;t<this.dataCount;t++)e(this.ReadData());else{let t=[];for(let i=0;i<this.sparseReader.indexReader.GetDataCount();i++){let n=this.sparseReader.indexReader.ReadData(),s=this.sparseReader.valueReader.ReadData();t.push({index:n,value:s})}let r=0;for(let i=0;i<this.dataCount;i++){let n=this.ReadData();r<t.length&&t[r].index===i?(e(t[r].value),r+=1):e(n)}}}SkipBytes(e){this.reader.Skip(e)}ReadComponent(){return this.componentType===null?null:this.componentType===Ee.BYTE?this.reader.ReadCharacter8():this.componentType===Ee.UNSIGNED_BYTE?this.reader.ReadUnsignedCharacter8():this.componentType===Ee.SHORT?this.reader.ReadInteger16():this.componentType===Ee.UNSIGNED_SHORT?this.reader.ReadUnsignedInteger16():this.componentType===Ee.UNSIGNED_INT?this.reader.ReadInteger32():this.componentType===Ee.FLOAT?this.reader.ReadFloat32():null}SkipBytesByStride(e){if(this.byteStride===null)return;let t=e*this.GetComponentSize();this.reader.Skip(this.byteStride-t)}GetComponentSize(){return this.componentType===Ee.BYTE||this.componentType===Ee.UNSIGNED_BYTE?1:this.componentType===Ee.SHORT||this.componentType===Ee.UNSIGNED_SHORT?2:this.componentType===Ee.UNSIGNED_INT||this.componentType===Ee.FLOAT?4:0}},_i=class{constructor(){this.supportedExtensions=["KHR_draco_mesh_compression","KHR_materials_pbrSpecularGlossiness","KHR_texture_transform"],this.draco=null}LoadLibraries(e,t){if(e===void 0){t.onSuccess();return}this.draco===null&&e.indexOf("KHR_draco_mesh_compression")!==-1?he("loaders/draco_decoder.js").then(()=>{DracoDecoderModule().then(r=>{this.draco=r,t.onSuccess()})}).catch(()=>{t.onError()}):t.onSuccess()}GetUnsupportedExtensions(e){let t=[];if(e===void 0)return t;for(let r=0;r<e.length;r++){let i=e[r];this.supportedExtensions.indexOf(i)===-1&&t.push(i)}return t}ProcessMaterial(e,t,r){if(e.extensions===void 0)return null;let i=e.extensions.KHR_materials_pbrSpecularGlossiness;if(i===void 0)return null;let n=new q,s=i.diffuseFactor;s!==void 0&&(n.color=Pr(s),n.opacity=s[3]);let l=i.diffuseTexture;l!==void 0&&(n.diffuseMap=r(l));let a=i.specularFactor;a!==void 0&&(n.specular=Pr(a));let u=i.specularGlossinessTexture;u!==void 0&&(n.specularMap=r(u));let h=i.glossinessFactor;return h!==void 0&&(n.shininess=h),n}ProcessTexture(e,t){if(e.extensions===void 0)return;let r=e.extensions.KHR_texture_transform;r!==void 0&&(r.offset!==void 0&&(t.offset.x=r.offset[0],t.offset.y=-r.offset[1]),r.scale!==void 0&&(t.scale.x=r.scale[0],t.scale.y=r.scale[1]),r.rotation!==void 0&&(t.rotation=-r.rotation))}ProcessPrimitive(e,t,r,i){function n(N,D,V,te,z){let xe=D.GetAttributeByUniqueId(V,te),Fe=xe.num_components(),xt=V.num_points()*Fe,gt=xt*4,rt=N._malloc(gt);D.GetAttributeDataArrayForAllPoints(V,xe,N.DT_FLOAT32,gt,rt);let Q=new Float32Array(N.HEAPF32.buffer,rt,xt).slice();if(Fe===2)for(let _=0;_<Q.length;_+=2)z(new v(Q[_+0],Q[_+1]));else if(Fe===3)for(let _=0;_<Q.length;_+=3)z(new y(Q[_+0],Q[_+1],Q[_+2]));else if(Fe===4)for(let _=0;_<Q.length;_+=4)z(new Xe(Q[_+0],Q[_+1],Q[_+2],Q[_+3]));N._free(rt)}if(this.draco===null||r.extensions===void 0||r.extensions.KHR_draco_mesh_compression===void 0)return!1;let s=new this.draco.Decoder,l=new this.draco.DecoderBuffer,a=r.extensions.KHR_draco_mesh_compression,u=t.bufferViews[a.bufferView],f=e.GetReaderFromBufferView(u).ReadArrayBuffer(u.byteLength);if(l.Init(new Int8Array(f),f.byteLength),s.GetEncodedGeometryType(l)!==this.draco.TRIANGULAR_MESH)return!0;let c=new this.draco.Mesh;if(!s.DecodeBufferToMesh(l,c).ok())return!0;let m=a.attributes.POSITION!==void 0,x=!1,g=a.attributes.NORMAL!==void 0,C=a.attributes.TEXCOORD_0!==void 0;if(!m)return!0;let E=i.VertexCount(),T=i.VertexColorCount(),I=i.NormalCount(),w=i.TextureUVCount();n(this.draco,s,c,a.attributes.POSITION,N=>{i.AddVertex(N)}),g&&n(this.draco,s,c,a.attributes.NORMAL,N=>{i.AddNormal(N)}),C&&n(this.draco,s,c,a.attributes.TEXCOORD_0,N=>{N.y=-N.y,i.AddTextureUV(N)});let A=c.num_faces()*3,b=A*4,G=this.draco._malloc(b);s.GetTrianglesUInt32Array(c,b,G);let B=new Uint32Array(this.draco.HEAPU32.buffer,G,A).slice();for(let N=0;N<B.length;N+=3){let D=B[N],V=B[N+1],te=B[N+2];e.AddTriangle(r,i,D,V,te,x,g,C,E,T,I,w)}return this.draco._free(G),!0}},kt=class extends k{constructor(){super(),this.gltfExtensions=new _i}CanImportExtension(e){return e==="gltf"||e==="glb"}GetUpDirection(){return R.Y}ClearContent(){this.bufferContents=null,this.imageIndexToTextureParams=null}ResetContent(){this.bufferContents=[],this.imageIndexToTextureParams=new Map}ImportContent(e,t){this.extension==="gltf"?this.ProcessGltf(e,t):this.extension==="glb"&&this.ProcessBinaryGltf(e,t)}ProcessGltf(e,t){let r=J(e),i=JSON.parse(r);if(i.asset.version!=="2.0"){this.SetError("Invalid glTF version."),t();return}for(let n=0;n<i.buffers.length;n++){let s=null,l=i.buffers[n],a=it(l.uri);if(a!==null)s=a.buffer;else{let u=this.callbacks.getFileBuffer(l.uri);u!==null&&(s=u)}if(s===null){this.SetError("One of the requested buffers is missing."),t();return}this.bufferContents.push(s)}this.ProcessMainFile(i,t)}ProcessBinaryGltf(e,t){function r(u){let h=u.ReadUnsignedInteger32(),f=u.ReadUnsignedInteger32(),d=u.ReadArrayBuffer(h);return{type:f,buffer:d}}let i=new ne(e,!0);if(i.ReadUnsignedInteger32()!==zi.GLTF_STRING){this.SetError("Invalid glTF file."),t();return}if(i.ReadUnsignedInteger32()!==2){this.SetError("Invalid glTF version."),t();return}if(i.ReadUnsignedInteger32()!==i.GetByteLength()){this.SetError("Invalid glTF file."),t();return}let a=null;for(;!i.End();){let u=r(i);u.type===zi.JSON_CHUNK_TYPE?a=J(u.buffer):u.type===zi.BINARY_CHUNK_TYPE&&this.bufferContents.push(u.buffer)}if(a!==null){let u=JSON.parse(a);this.ProcessMainFile(u,t)}}ProcessMainFile(e,t){let r=this.gltfExtensions.GetUnsupportedExtensions(e.extensionsRequired);if(r.length>0){this.SetError("Unsupported extension: "+r.join(", ")+"."),t();return}this.gltfExtensions.LoadLibraries(e.extensionsRequired,{onSuccess:()=>{this.ImportModel(e),t()},onError:()=>{this.SetError("Failed to load draco decoder."),t()}})}ImportModel(e){let t=e.materials;if(t!==void 0)for(let i of t)this.ImportMaterial(e,i);let r=e.meshes;if(r!==void 0)for(let i of r)this.ImportMesh(e,i);this.ImportNodes(e),this.ImportModelProperties(e)}ImportModelProperties(e){function t(r,i,n){let s=new Te(i);for(let l in n)if(Object.prototype.hasOwnProperty.call(n,l)&&typeof n[l]=="string"){let a=new re(ce.Text,l,n[l]);s.AddProperty(a)}return s.PropertyCount()>0&&r.AddPropertyGroup(s),s}t(this.model,"Asset properties",e.asset),e.asset.extras&&t(this.model,"Extras",e.asset.extras)}GetDefaultScene(e){let t=e.scene||0;return t>=e.scenes.length?null:e.scenes[t]}ImportMaterial(e,t){let r=new Oe;if(t.name!==void 0&&(r.name=t.name),r.color=Pr([1,1,1]),t.pbrMetallicRoughness!==void 0){let n=t.pbrMetallicRoughness.baseColorFactor;n!==void 0&&(r.color=Pr(n),r.opacity=n[3]);let s=t.pbrMetallicRoughness.metallicFactor;s!==void 0&&(r.metalness=s);let l=t.pbrMetallicRoughness.roughnessFactor;l!==void 0&&(r.roughness=l);let a=t.emissiveFactor;a!==void 0&&(r.emissive=Pr(a)),r.diffuseMap=this.ImportTexture(e,t.pbrMetallicRoughness.baseColorTexture),r.metalnessMap=this.ImportTexture(e,t.pbrMetallicRoughness.metallicRoughnessTexture),r.normalMap=this.ImportTexture(e,t.normalTexture),r.emissiveMap=this.ImportTexture(e,t.emissiveTexture),r.diffuseMap!==null&&(r.multiplyDiffuseMap=!0);let u=t.alphaMode;u!==void 0&&(u==="BLEND"?r.transparent=!0:u==="MASK"&&(r.transparent=!0,r.alphaTest=t.alphaCutoff||.5))}let i=this.gltfExtensions.ProcessMaterial(t,r,n=>this.ImportTexture(e,n));i!==null&&(r=i),this.model.AddMaterial(r)}ImportTexture(e,t){if(t==null)return null;let r=new ye,n=e.textures[t.index].source,s=e.images[n],l=null;if(this.imageIndexToTextureParams.has(n))l=this.imageIndexToTextureParams.get(n);else{l={name:null,url:null,buffer:null};let a=n.toString();if(s.uri!==void 0){let u=it(s.uri);if(u!==null)l.name="Embedded_"+a+"."+Ye(u.mimeType),l.url=pr(u.buffer,u.mimeType),l.buffer=u.buffer;else{let h=this.callbacks.getTextureBuffer(s.uri);l.name=s.uri,h!==null&&(l.url=h.url,l.buffer=h.buffer)}}else if(s.bufferView!==void 0){let u=e.bufferViews[s.bufferView],h=this.GetReaderFromBufferView(u);if(h!==null){let f=h.ReadArrayBuffer(u.byteLength);l.name="Binary_"+a+"."+Ye(s.mimeType),l.url=pr(f,s.mimeType),l.buffer=f}}this.imageIndexToTextureParams.set(n,l)}return r.name=l.name,r.url=l.url,r.buffer=l.buffer,this.gltfExtensions.ProcessTexture(t,r),r}ImportMesh(e,t){let r=new j;this.model.AddMesh(r),t.name!==void 0&&r.SetName(t.name);for(let i=0;i<t.primitives.length;i++){let n=t.primitives[i];this.ImportPrimitive(e,n,r)}}ImportPrimitive(e,t,r){if(this.gltfExtensions.ProcessPrimitive(this,e,t,r)||t.attributes===void 0)return;let i=t.attributes.POSITION!==void 0,n=t.attributes.COLOR_0!==void 0,s=t.attributes.NORMAL!==void 0,l=t.attributes.TEXCOORD_0!==void 0,a=t.indices!==void 0,u=mt.TRIANGLES;if(t.mode!==void 0&&(u=t.mode),u!==mt.TRIANGLES&&u!==mt.TRIANGLE_STRIP&&u!==mt.TRIANGLE_FAN)return;let h=r.VertexCount(),f=r.VertexColorCount(),d=r.NormalCount(),c=r.TextureUVCount();if(i){let m=e.accessors[t.attributes.POSITION],x=this.GetReaderFromAccessor(e,m);if(x===null)return;x.EnumerateData(g=>{r.AddVertex(g)})}else return;if(n){let m=e.accessors[t.attributes.COLOR_0],x=this.GetReaderFromAccessor(e,m);if(x===null)return;x.EnumerateData(g=>{let C=Hn([g.x,g.y,g.z],x.componentType);r.AddVertexColor(C)})}if(s){let m=e.accessors[t.attributes.NORMAL],x=this.GetReaderFromAccessor(e,m);if(x===null)return;x.EnumerateData(g=>{r.AddNormal(g)})}if(l){let m=e.accessors[t.attributes.TEXCOORD_0],x=this.GetReaderFromAccessor(e,m);if(x===null)return;x.EnumerateData(g=>{g.y=-g.y,r.AddTextureUV(g)})}let p=[];if(a){let m=e.accessors[t.indices],x=this.GetReaderFromAccessor(e,m);if(x===null)return;x.EnumerateData(g=>{p.push(g)})}else for(let m=0;m<r.VertexCount();m++)p.push(m);if(u===mt.TRIANGLES)for(let m=0;m<p.length;m+=3){let x=p[m],g=p[m+1],C=p[m+2];this.AddTriangle(t,r,x,g,C,n,s,l,h,f,d,c)}else if(u===mt.TRIANGLE_STRIP)for(let m=0;m<p.length-2;m++){let x=p[m],g=p[m+1],C=p[m+2];if(m%2===1){let E=g;g=C,C=E}this.AddTriangle(t,r,x,g,C,n,s,l,h,f,d,c)}else if(u===mt.TRIANGLE_FAN)for(let m=1;m<p.length-1;m++){let x=p[0],g=p[m],C=p[m+1];this.AddTriangle(t,r,x,g,C,n,s,l,h,f,d,c)}}AddTriangle(e,t,r,i,n,s,l,a,u,h,f,d){let c=new U(u+r,u+i,u+n);s&&c.SetVertexColors(h+r,h+i,h+n),l&&c.SetNormals(f+r,f+i,f+n),a&&c.SetTextureUVs(d+r,d+i,d+n),e.material!==void 0&&(c.mat=e.material),t.AddTriangle(c)}ImportNodes(e){let t=this.GetDefaultScene(e);if(t===null)return;let r=this.model.GetRootNode();for(let i of t.nodes){let n=e.nodes[i];this.ImportNode(e,n,r)}}ImportNode(e,t,r){function i(s){let l=new O().CreateIdentity();if(s.matrix!==void 0)l.Set(s.matrix);else{let a=[0,0,0],u=[0,0,0,1],h=[1,1,1];s.translation!==void 0&&(a=s.translation),s.rotation!==void 0&&(u=s.rotation),s.scale!==void 0&&(h=s.scale),l.ComposeTRS(we(a),Ze(u),we(h))}return new H(l)}if(t.children===void 0&&t.mesh===void 0)return;let n=new pe;if(t.name!==void 0&&n.SetName(t.name),n.SetTransformation(i(t)),r.AddChildNode(n),t.children!==void 0)for(let s of t.children){let l=e.nodes[s];this.ImportNode(e,l,n)}t.mesh!==void 0&&((t.children===void 0||t.children.length===0)&&n.SetType(Ge.MeshNode),n.AddMeshIndex(t.mesh))}GetReaderFromBufferView(e){let t=e.buffer||0,r=this.bufferContents[t];if(r==null)return null;let i=new Hi(r);i.SkipBytes(e.byteOffset||0);let n=e.byteStride;return n!==void 0&&n!==0&&i.SetByteStride(n),i}GetReaderFromAccessor(e,t){let r=t.bufferView||0,i=e.bufferViews[r],n=this.GetReaderFromBufferView(i);if(n===null)return null;if(n.SetComponentType(t.componentType),n.SetDataType(t.type),n.SetDataCount(t.count),n.SkipBytes(t.byteOffset||0),t.sparse!==void 0){let s=this.GetReaderFromSparseAccessor(e,t.sparse.indices,t.sparse.indices.componentType,"SCALAR",t.sparse.count),l=this.GetReaderFromSparseAccessor(e,t.sparse.values,t.componentType,t.type,t.sparse.count);s!==null&&l!==null&&n.SetSparseReader(s,l)}return n}GetReaderFromSparseAccessor(e,t,r,i,n){if(t.bufferView===void 0)return null;let s=e.bufferViews[t.bufferView],l=this.GetReaderFromBufferView(s);return l===null?null:(l.SetComponentType(r),l.SetDataType(i),l.SetDataCount(n),l.SkipBytes(t.byteOffset||0),l)}};var Wt=class extends k{constructor(){super(),this.ifc=null}CanImportExtension(e){return e==="ifc"}GetUpDirection(){return R.Y}ClearContent(){this.materialNameToIndex=null,this.expressIDToMesh=null}ResetContent(){this.materialNameToIndex=new Map,this.expressIDToMesh=new Map}ImportContent(e,t){this.ifc===null?he("loaders/web-ifc-api-browser.js").then(()=>{this.ifc=new WebIFC.IfcAPI,this.ifc.Init().then(()=>{this.ImportIfcContent(e),t()})}).catch(()=>{t()}):(this.ImportIfcContent(e),t())}ImportIfcContent(e){let t=new Uint8Array(e),r=this.ifc.OpenModel(t,{COORDINATE_TO_ORIGIN:!0}),i=this.ifc.LoadAllGeometry(r);for(let n=0;n<i.size();n++){let s=i.get(n);s.geometries.size()>0&&this.ImportIfcMesh(r,s)}this.ImportProperties(r),this.ifc.CloseModel(r)}ImportIfcMesh(e,t){let r=new j;r.SetName("Mesh "+t.expressID.toString());let i=0,n=t.geometries;for(let s=0;s<n.size();s++){let l=n.get(s),a=this.ifc.GetGeometry(e,l.geometryExpressID),u=this.ifc.GetVertexArray(a.GetVertexData(),a.GetVertexDataSize()),h=this.ifc.GetIndexArray(a.GetIndexData(),a.GetIndexDataSize()),f=this.GetMaterialIndexByColor(l.color),d=new O(l.flatTransformation),c=new H(d);for(let p=0;p<u.length;p+=6){let m=u[p],x=u[p+1],g=u[p+2],C=new y(m,x,g),E=c.TransformCoord3D(C);r.AddVertex(E)}for(let p=0;p<h.length;p+=3){let m=h[p],x=h[p+1],g=h[p+2],C=new U(i+m,i+x,i+g);C.SetMaterial(f),r.AddTriangle(C)}i+=u.length/6}this.expressIDToMesh.set(t.expressID,r),this.model.AddMeshToRootNode(r)}ImportProperties(e){let t=this.ifc.GetLineIDsWithType(e,WebIFC.IFCRELDEFINESBYPROPERTIES);for(let r=0;r<t.size();r++){let i=t.get(r),n=this.ifc.GetLine(e,i);Array.isArray(n.RelatingPropertyDefinition)||n.RelatedObjects.forEach(s=>{let l=null;if(this.expressIDToMesh.has(s.value)?l=this.expressIDToMesh.get(s.value):this.ifc.GetLine(e,s.value,!0).type===WebIFC.IFCBUILDING&&(l=this.model),l===null)return;let a=n.RelatingPropertyDefinition,u=this.ifc.GetLine(e,a.value,!0);if(!u||!u.HasProperties)return;let h=new Te(u.Name.value);u.HasProperties.forEach(f=>{if(!f||!f.Name||!f.NominalValue)return;let d=null,c=this.GetIFCString(f.Name.value),p=null;switch(f.NominalValue.label){case"IFCTEXT":case"IFCLABEL":case"IFCIDENTIFIER":d=new re(ce.Text,c,this.GetIFCString(f.NominalValue.value));break;case"IFCBOOLEAN":case"IFCLOGICAL":p="Unknown",f.NominalValue.value==="T"?p="True":f.NominalValue.value==="F"&&(p="False"),d=new re(ce.Text,c,p);break;case"IFCINTEGER":case"IFCCOUNTMEASURE":d=new re(ce.Integer,c,f.NominalValue.value);break;case"IFCREAL":case"IFCLENGTHMEASURE":case"IFCPOSITIVELENGTHMEASURE":case"IFCAREAMEASURE":case"IFCVOLUMEMEASURE":case"IFCRATIOMEASURE":case"IFCPOSITIVERATIOMEASURE":case"IFCMASSMEASURE":case"IFCMASSPERLENGTHMEASURE":case"IFCPLANEANGLEMEASURE":case"IFCTHERMALTRANSMITTANCEMEASURE":d=new re(ce.Number,c,f.NominalValue.value);break;default:console.log(f.NominalValue.label),console.log(f.NominalValue.value);break}d!==null&&h.AddProperty(d)}),h.PropertyCount()>0&&l.AddPropertyGroup(h)})}}GetMaterialIndexByColor(e){let t=Ve(e.x,e.y,e.z),r="Color "+se(t.r)+se(t.g)+se(t.b)+se(parseInt(e.w*255,10));if(this.materialNameToIndex.has(r))return this.materialNameToIndex.get(r);{let i=new q;i.name=r,i.color=t,i.opacity=e.w,ae(i);let n=this.model.AddMaterial(i);return this.materialNameToIndex.set(r,n),n}}GetIFCString(e){let t=this.DecodeIFCString(e);return t.length===0&&(t="-"),t}DecodeIFCString(e){let t=/\\X2\\(.*?)\\X0\\/uig,r=e,i=t.exec(e);for(;i;){let n=String.fromCharCode(parseInt(i[1],16));r=r.replace(i[0],n),i=t.exec(e)}return r}};var ct=class{constructor(){this.name=null,this.material=null}SetName(e){return this.name=e,this}SetMaterial(e){return this.material=e,this}},$e=class{constructor(e){this.params=e||new ct,this.mesh=new j,this.params.name!==null&&this.mesh.SetName(this.params.name),this.curve=null}GetMesh(){return this.mesh}AddVertex(e,t,r){let i=new y(e,t,r);return this.mesh.AddVertex(i)}AddVertices(e){let t=[];for(let r=0;r<e.length;r++){let i=e[r];t.push(this.AddVertex(i.x,i.y,i.z))}return t}SetCurve(e){this.curve=e}ResetCurve(){this.curve=null}AddTriangle(e,t,r){let i=new U(e,t,r);return this.params.material!==null&&(i.mat=this.params.material),this.curve!==null&&i.SetCurve(this.curve),this.mesh.AddTriangle(i)}AddTriangleInverted(e,t,r){this.AddTriangle(e,r,t)}AddConvexPolygon(e){for(let t=0;t<e.length-2;t++)this.AddTriangle(e[0],e[t+1],e[t+2])}AddConvexPolygonInverted(e){for(let t=0;t<e.length-2;t++)this.AddTriangleInverted(e[0],e[t+1],e[t+2])}},pt=class{constructor(e){this.generator=e}GenerateExtrude(e,t,r){let i=[],n=[];for(let s=0;s<e.length;s++){let l=e[s];n.push(this.generator.AddVertex(l.x,l.y,0)),i.push(this.generator.AddVertex(l.x,l.y,t))}this.generator.SetCurve(r),this.GenerateSurfaceBetweenPolygons(n,i),this.generator.ResetCurve(),this.generator.AddConvexPolygonInverted(n),this.generator.AddConvexPolygon(i)}GenerateSurfaceBetweenPolygons(e,t){if(e.length!==t.length)return;let r=e.length;for(let i=0;i<r;i++){let n=i,s=i<r-1?n+1:0;this.generator.AddConvexPolygon([e[n],e[s],t[s],t[n]])}}GenerateTriangleFan(e,t){let r=e.length;for(let i=0;i<r;i++){let n=i,s=i<r-1?n+1:0;this.generator.AddTriangle(t,e[n],e[s])}}};function Ei(o,e,t,r){let i=new $e(o),n=[new v(0,0),new v(e,0),new v(e,t),new v(0,t)];return new pt(i).GenerateExtrude(n,r,null),i.GetMesh()}function yi(o,e,t,r,i){function n(h,f){return new v(h*Math.cos(f),h*Math.sin(f))}if(r<3)return null;let s=new $e(o),l=[],a=2*Math.PI/r;for(let h=0;h<r;h++){let f=n(e,h*a);l.push(f)}return new pt(s).GenerateExtrude(l,t,i?1:null),s.GetMesh()}function Mi(o,e,t,r){function i(c,p,m){return new y(c*Math.sin(p)*Math.cos(m),c*Math.sin(p)*Math.sin(m),c*Math.cos(p))}if(t<3)return null;let n=new $e(o),s=new pt(n);n.SetCurve(r?1:null);let l=[],a=t+1,u=Math.PI/t,h=2*Math.PI/t;for(let c=1;c<a-1;c++){let p=[],m=c*u;for(let x=0;x<t;x++){let g=x*h,C=i(e,m,-g);p.push(n.AddVertex(C.x,C.y,C.z))}c>1&&s.GenerateSurfaceBetweenPolygons(l[l.length-1],p),l.push(p)}let f=n.AddVertex(0,0,e),d=n.AddVertex(0,0,-e);return s.GenerateTriangleFan(l[0].slice().reverse(),f),s.GenerateTriangleFan(l[l.length-1],d),n.ResetCurve(),n.GetMesh()}function Ii(o,e,t){function r(n,s,l,a,u){let h=new y(l,a,u);h.MultiplyScalar(s/h.Length()),n.AddVertex(h.x,h.y,h.z)}if(bt(t))return null;let i=new $e(o);if(e==="tetrahedron"){let n=1;r(i,t,+n,+n,+n),r(i,t,-n,-n,+n),r(i,t,-n,+n,-n),r(i,t,+n,-n,-n),i.AddTriangle(0,1,3),i.AddTriangle(0,2,1),i.AddTriangle(0,3,2),i.AddTriangle(1,2,3)}else if(e==="hexahedron"){let n=1;r(i,t,+n,+n,+n),r(i,t,+n,+n,-n),r(i,t,+n,-n,+n),r(i,t,+n,-n,-n),r(i,t,-n,+n,+n),r(i,t,-n,+n,-n),r(i,t,-n,-n,+n),r(i,t,-n,-n,-n),i.AddConvexPolygon([0,1,5,4]),i.AddConvexPolygon([0,2,3,1]),i.AddConvexPolygon([0,4,6,2]),i.AddConvexPolygon([1,3,7,5]),i.AddConvexPolygon([2,6,7,3]),i.AddConvexPolygon([4,5,7,6])}else if(e==="octahedron"){let n=1,s=0;r(i,t,+n,+s,+s),r(i,t,-n,+s,+s),r(i,t,+s,+n,+s),r(i,t,+s,-n,+s),r(i,t,+s,+s,+n),r(i,t,+s,+s,-n),i.AddTriangle(0,2,4),i.AddTriangle(0,3,5),i.AddTriangle(0,4,3),i.AddTriangle(0,5,2),i.AddTriangle(1,2,5),i.AddTriangle(1,3,4),i.AddTriangle(1,4,2),i.AddTriangle(1,5,3)}else if(e==="dodecahedron"){let n=1,s=0,l=(1+Math.sqrt(5))/2,a=1/l;r(i,t,+n,+n,+n),r(i,t,+n,+n,-n),r(i,t,+n,-n,+n),r(i,t,-n,+n,+n),r(i,t,+n,-n,-n),r(i,t,-n,+n,-n),r(i,t,-n,-n,+n),r(i,t,-n,-n,-n),r(i,t,+s,+a,+l),r(i,t,+s,+a,-l),r(i,t,+s,-a,+l),r(i,t,+s,-a,-l),r(i,t,+a,+l,+s),r(i,t,+a,-l,+s),r(i,t,-a,+l,+s),r(i,t,-a,-l,+s),r(i,t,+l,+s,+a),r(i,t,-l,+s,+a),r(i,t,+l,+s,-a),r(i,t,-l,+s,-a),i.AddConvexPolygon([0,8,10,2,16]),i.AddConvexPolygon([0,16,18,1,12]),i.AddConvexPolygon([0,12,14,3,8]),i.AddConvexPolygon([1,9,5,14,12]),i.AddConvexPolygon([1,18,4,11,9]),i.AddConvexPolygon([2,10,6,15,13]),i.AddConvexPolygon([2,13,4,18,16]),i.AddConvexPolygon([3,14,5,19,17]),i.AddConvexPolygon([3,17,6,10,8]),i.AddConvexPolygon([4,13,15,7,11]),i.AddConvexPolygon([5,9,11,7,19]),i.AddConvexPolygon([6,17,19,7,15])}else if(e==="icosahedron"){let n=1,s=0,l=(1+Math.sqrt(5))/2;r(i,t,+s,+n,+l),r(i,t,+s,+n,-l),r(i,t,+s,-n,+l),r(i,t,+s,-n,-l),r(i,t,+n,+l,+s),r(i,t,+n,-l,+s),r(i,t,-n,+l,+s),r(i,t,-n,-l,+s),r(i,t,+l,+s,+n),r(i,t,+l,+s,-n),r(i,t,-l,+s,+n),r(i,t,-l,+s,-n),i.AddTriangle(0,2,8),i.AddTriangle(0,4,6),i.AddTriangle(0,6,10),i.AddTriangle(0,8,4),i.AddTriangle(0,10,2),i.AddTriangle(1,3,11),i.AddTriangle(1,4,9),i.AddTriangle(1,6,4),i.AddTriangle(1,9,3),i.AddTriangle(1,11,6),i.AddTriangle(2,5,8),i.AddTriangle(2,7,5),i.AddTriangle(2,10,7),i.AddTriangle(3,5,7),i.AddTriangle(3,7,11),i.AddTriangle(3,9,5),i.AddTriangle(4,8,9),i.AddTriangle(5,9,8),i.AddTriangle(6,11,10),i.AddTriangle(7,10,11)}return i.GetMesh()}var qt=class extends k{constructor(){super()}CanImportExtension(e){return e==="o3dv"}GetUpDirection(){return R.Z}ClearContent(){}ResetContent(){}ImportContent(e,t){let r=J(e),i=JSON.parse(r);if(i.root===void 0){t();return}if(i.materials!==void 0)for(let s=0;s<i.materials.length;s++){let l=i.materials[s];this.ImportMaterial(l)}if(i.meshes!==void 0)for(let s=0;s<i.meshes.length;s++){let l=i.meshes[s];this.ImportMesh(l)}let n=i.nodes[i.root];this.ImportNode(i,n,this.model.GetRootNode()),this.ImportProperties(this.model,i),t()}ImportMaterial(e){let t=new Oe;t.color.Set(255,255,255),e.name!==void 0&&(t.name=e.name),e.color!==void 0&&(t.color=si(e.color)),t.metalness=Ne(e.metalness,0),t.roughness=Ne(e.roughness,1),this.model.AddMaterial(t)}ImportMesh(e){let t=new ct;e.name!==void 0&&t.SetName(e.name),e.material!==void 0&&t.SetMaterial(e.material);let r=e.parameters;if(r===void 0)return;let i=null;if(e.type==="cuboid"){if(r.size_x===void 0||r.size_y===void 0||r.size_z===void 0)return;i=Ei(t,r.size_x,r.size_y,r.size_z)}else if(e.type==="cylinder"){if(r.radius===void 0||r.height===void 0)return;let n=Ne(r.segments,25),s=Ne(r.smooth,!0);i=yi(t,r.radius,r.height,n,s)}else if(e.type==="sphere"){if(r.radius===void 0)return;let n=Ne(r.segments,20),s=Ne(r.smooth,!0);i=Mi(t,r.radius,n,s)}else if(e.type==="platonic"){if(r.solid_type===void 0)return;let n=Ne(r.radius,1);i=Ii(t,r.solid_type,n)}i!==null&&(this.ImportProperties(i,e),this.model.AddMesh(i))}ImportNode(e,t,r){if(t.name!==void 0&&r.SetName(t.name),t.transformation!==void 0){let i=this.GetTransformation(t.transformation);r.SetTransformation(i)}if(t.children!==void 0)for(let i of t.children){let n=e.nodes[i],s=new pe;r.AddChildNode(s),this.ImportNode(e,n,s)}t.mesh!==void 0&&((t.children===void 0||t.children.length===0)&&r.SetType(Ge.MeshNode),r.AddMeshIndex(t.mesh))}ImportProperties(e,t){if(t.properties!==void 0){let r=new Te("Properties");e.AddPropertyGroup(r);for(let i of t.properties){let n=new re(ce.Text,i.name,i.value);r.AddProperty(n)}}}GetTransformation(e){let t=new y(0,0,0),r=new me(0,0,0,1),i=new y(1,1,1);e.translation!==void 0&&(t=we(e.translation)),e.rotation!==void 0&&(r=Ze(e.rotation)),e.scale!==void 0&&(i=we(e.scale));let n=new O().ComposeTRS(t,r,i);return new H(n)}};var ji=class{constructor(e){this.mesh=e,this.globalToMeshVertices=new Map,this.globalToMeshVertexColors=new Map,this.globalToMeshNormals=new Map,this.globalToMeshUvs=new Map}AddVertex(e,t){return this.GetLocalIndex(e,t,this.globalToMeshVertices,r=>this.mesh.AddVertex(new y(r.x,r.y,r.z)))}AddVertexColor(e,t){return this.GetLocalIndex(e,t,this.globalToMeshVertexColors,r=>this.mesh.AddVertexColor(new F(r.r,r.g,r.b)))}AddNormal(e,t){return this.GetLocalIndex(e,t,this.globalToMeshNormals,r=>this.mesh.AddNormal(new y(r.x,r.y,r.z)))}AddUV(e,t){return this.GetLocalIndex(e,t,this.globalToMeshUvs,r=>this.mesh.AddTextureUV(new v(r.x,r.y)))}AddTriangle(e){this.mesh.AddTriangle(e)}GetLocalIndex(e,t,r,i){if(isNaN(e)||e<0||e>=t.length)return null;if(r.has(e))return r.get(e);{let n=t[e],s=i(n);return r.set(e,s),s}}};function bi(o,e,t){return Ve(parseFloat(o),parseFloat(e),parseFloat(t))}var Xt=class extends k{constructor(){super()}CanImportExtension(e){return e==="obj"}GetUpDirection(){return R.Y}ClearContent(){this.globalVertices=null,this.globalVertexColors=null,this.globalNormals=null,this.globalUvs=null,this.currentMeshConverter=null,this.currentMaterial=null,this.currentMaterialIndex=null,this.meshNameToConverter=null,this.materialNameToIndex=null}ResetContent(){this.globalVertices=[],this.globalVertexColors=[],this.globalNormals=[],this.globalUvs=[],this.currentMeshConverter=null,this.currentMaterial=null,this.currentMaterialIndex=null,this.meshNameToConverter=new Map,this.materialNameToIndex=new Map}ImportContent(e,t){let r=J(e);Me(r,i=>{this.WasError()||this.ProcessLine(i)}),t()}ProcessLine(e){if(e[0]==="#")return;let t=ve(e,"#");if(t.length===0)return;let r=t[0].toLowerCase();t.shift(),!this.ProcessMeshParameter(r,t,e)&&this.ProcessMaterialParameter(r,t,e)}AddNewMesh(e){if(this.meshNameToConverter.has(e))this.currentMeshConverter=this.meshNameToConverter.get(e);else{let t=new j;t.SetName(e),this.model.AddMeshToRootNode(t),this.currentMeshConverter=new ji(t),this.meshNameToConverter.set(e,this.currentMeshConverter)}}ProcessMeshParameter(e,t,r){if(e==="g"||e==="o"){if(t.length===0)return!0;let i=ze(r,e.length,"#");return this.AddNewMesh(i),!0}else{if(e==="v")return t.length<3||(this.globalVertices.push(new y(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))),t.length>=6&&this.globalVertexColors.push(bi(t[3],t[4],t[5]))),!0;if(e==="vn")return t.length<3||this.globalNormals.push(new y(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))),!0;if(e==="vt")return t.length<2||this.globalUvs.push(new v(parseFloat(t[0]),parseFloat(t[1]))),!0;if(e==="f")return t.length<3||this.ProcessFace(t),!0}return!1}ProcessMaterialParameter(e,t,r){function i(n,s,l){let a=new ye,u=ze(s,n.length,"#"),h=l.getTextureBuffer(u);return a.name=u,h!==null&&(a.url=h.url,a.buffer=h.buffer),a}if(e==="newmtl"){if(t.length===0)return!0;let n=new q,s=ze(r,e.length,"#"),l=this.model.AddMaterial(n);return n.name=s,this.currentMaterial=n,this.materialNameToIndex.set(s,l),!0}else if(e==="usemtl"){if(t.length===0)return!0;let n=ze(r,e.length,"#");return this.materialNameToIndex.has(n)&&(this.currentMaterialIndex=this.materialNameToIndex.get(n)),!0}else if(e==="mtllib"){if(t.length===0)return!0;let n=ze(r,e.length,"#"),s=this.callbacks.getFileBuffer(n);if(s!==null){let l=J(s);Me(l,a=>{this.WasError()||this.ProcessLine(a)})}return!0}else{if(e==="map_kd")return this.currentMaterial===null||t.length===0||(this.currentMaterial.diffuseMap=i(e,r,this.callbacks),ae(this.currentMaterial)),!0;if(e==="map_ks")return this.currentMaterial===null||t.length===0||(this.currentMaterial.specularMap=i(e,r,this.callbacks)),!0;if(e==="map_bump"||e==="bump")return this.currentMaterial===null||t.length===0||(this.currentMaterial.bumpMap=i(e,r,this.callbacks)),!0;if(e==="ka")return this.currentMaterial===null||t.length<3||(this.currentMaterial.ambient=bi(t[0],t[1],t[2])),!0;if(e==="kd")return this.currentMaterial===null||t.length<3||(this.currentMaterial.color=bi(t[0],t[1],t[2])),!0;if(e==="ks")return this.currentMaterial===null||t.length<3||(this.currentMaterial.specular=bi(t[0],t[1],t[2])),!0;if(e==="ns")return this.currentMaterial===null||t.length<1||(this.currentMaterial.shininess=parseFloat(t[0])/1e3),!0;if(e==="tr")return this.currentMaterial===null||t.length<1||(this.currentMaterial.opacity=1-parseFloat(t[0]),ae(this.currentMaterial)),!0;if(e==="d")return this.currentMaterial===null||t.length<1||(this.currentMaterial.opacity=parseFloat(t[0]),ae(this.currentMaterial)),!0}return!1}ProcessFace(e){function t(l,a){return l>0?l-1:a+l}let r=[],i=[],n=[],s=[];for(let l=0;l<e.length;l++){let a=e[l].split("/");r.push(t(parseInt(a[0],10),this.globalVertices.length)),this.globalVertices.length===this.globalVertexColors.length&&i.push(t(parseInt(a[0],10),this.globalVertices.length)),a.length>1&&a[1].length>0&&s.push(t(parseInt(a[1],10),this.globalUvs.length)),a.length>2&&a[2].length>0&&n.push(t(parseInt(a[2],10),this.globalNormals.length))}this.currentMeshConverter===null&&this.AddNewMesh("");for(let l=0;l<r.length-2;l++){let a=this.currentMeshConverter.AddVertex(r[0],this.globalVertices),u=this.currentMeshConverter.AddVertex(r[l+1],this.globalVertices),h=this.currentMeshConverter.AddVertex(r[l+2],this.globalVertices);if(a===null||u===null||h===null){this.SetError("Invalid vertex index.");break}let f=new U(a,u,h);if(i.length===r.length){let d=this.currentMeshConverter.AddVertexColor(i[0],this.globalVertexColors),c=this.currentMeshConverter.AddVertexColor(i[l+1],this.globalVertexColors),p=this.currentMeshConverter.AddVertexColor(i[l+2],this.globalVertexColors);if(d===null||c===null||p===null){this.SetError("Invalid vertex color index.");break}f.SetVertexColors(d,c,p)}if(n.length===r.length){let d=this.currentMeshConverter.AddNormal(n[0],this.globalNormals),c=this.currentMeshConverter.AddNormal(n[l+1],this.globalNormals),p=this.currentMeshConverter.AddNormal(n[l+2],this.globalNormals);if(d===null||c===null||p===null){this.SetError("Invalid normal index.");break}f.SetNormals(d,c,p)}if(s.length===r.length){let d=this.currentMeshConverter.AddUV(s[0],this.globalUvs),c=this.currentMeshConverter.AddUV(s[l+1],this.globalUvs),p=this.currentMeshConverter.AddUV(s[l+2],this.globalUvs);if(d===null||c===null||p===null){this.SetError("Invalid uv index.");break}f.SetTextureUVs(d,c,p)}this.currentMaterialIndex!==null&&(f.mat=this.currentMaterialIndex),this.currentMeshConverter.AddTriangle(f)}}};var Yt=class extends k{constructor(){super()}CanImportExtension(e){return e==="off"}GetUpDirection(){return R.Y}ClearContent(){this.mesh=null,this.status=null}ResetContent(){this.mesh=new j,this.model.AddMeshToRootNode(this.mesh),this.status={vertexCount:0,faceCount:0,foundVertex:0,foundFace:0}}ImportContent(e,t){let r=J(e);Me(r,i=>{this.WasError()||this.ProcessLine(i)}),t()}ProcessLine(e){if(e[0]==="#")return;let t=ve(e,"#");if(t.length!==0&&t[0]!=="OFF"){if(this.status.vertexCount===0&&this.status.faceCount===0){t.length>1&&(this.status.vertexCount=parseInt(t[0],10),this.status.faceCount=parseInt(t[1],10));return}if(this.status.foundVertex<this.status.vertexCount){t.length>=3&&(this.mesh.AddVertex(new y(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))),this.status.foundVertex+=1);return}if(this.status.foundFace<this.status.faceCount){if(t.length>=4){let r=parseInt(t[0],10);if(t.length<r+1)return;for(let i=0;i<r-2;i++){let n=parseInt(t[1]),s=parseInt(t[i+2]),l=parseInt(t[i+3]),a=new U(n,s,l);this.mesh.AddTriangle(a)}this.status.foundFace+=1}return}}}};var et={Ok:1,NoVertices:2,NoFaces:3,UnknownError:4},ki=class{constructor(){this.format=null,this.elements=[]}SetFormat(e){this.format=e}AddElement(e,t){this.elements.push({name:e,count:t,format:[]})}GetElements(){return this.elements}AddSingleFormat(e,t){this.elements[this.elements.length-1].format.push({name:t,isSingle:!0,elemType:e})}AddListFormat(e,t,r){this.elements[this.elements.length-1].format.push({name:r,isSingle:!1,countType:e,elemType:t})}GetElement(e){for(let t=0;t<this.elements.length;t++){let r=this.elements[t];if(r.name===e)return r}return null}Check(){let e=this.GetElement("vertex");if(e===null||e.length===0||e.format.length<3)return et.NoVertices;let t=this.GetElement("face");if(this.format==="ascii"){if(t===null||t.count===0||t.format.length<0)return et.NoFaces}else if(this.format==="binary_little_endian"||this.format==="binary_big_endian"){let r=this.GetElement("tristrips"),i=t!==null&&t.count>0&&t.format.length>0,n=r!==null&&r.count>0&&r.format.length>0;if(!i&&!n)return et.NoFaces}else return et.UnknownError;return et.Ok}},Wi=class{constructor(e){this.model=e,this.colorToMaterial=new Map}GetMaterialIndexByColor(e){let t="Color "+se(e[0])+se(e[1])+se(e[2])+se(e[3]);if(this.colorToMaterial.has(t))return this.colorToMaterial.get(t);{let r=new q;r.name=t,r.color=new F(e[0],e[1],e[2]),r.opacity=e[3]/255,ae(r);let i=this.model.AddMaterial(r);return this.colorToMaterial.set(t,i),i}}},Jt=class extends k{constructor(){super()}CanImportExtension(e){return e==="ply"}GetUpDirection(){return R.Y}ClearContent(){this.mesh=null}ResetContent(){this.mesh=new j,this.model.AddMeshToRootNode(this.mesh)}ImportContent(e,t){let r=this.GetHeaderContent(e),i=this.ReadHeader(r),n=i.Check();if(n===et.Ok)if(i.format==="ascii"){let s=J(e);s=s.substring(r.length),this.ReadAsciiContent(i,s)}else(i.format==="binary_little_endian"||i.format==="binary_big_endian")&&this.ReadBinaryContent(i,e,r.length);else n===et.NoVertices?this.SetError("The model contains no vertices."):n===et.NoFaces?this.SetError("The model contains no faces."):this.SetError("Invalid header information.");t()}GetHeaderContent(e){let t="",r=new Uint8Array(e),i=0;for(i=0;i<e.byteLength&&(t+=String.fromCharCode(r[i]),!t.endsWith("end_header"));i++);for(i+=1;i<e.byteLength;){let n=String.fromCharCode(r[i]);if(t+=n,i+=1,n===`
`)break}return t}ReadHeader(e){let t=new ki;return Me(e,r=>{let i=ve(r,null);i.length===0||i[0]==="comment"||i[0]!=="ply"&&(i[0]==="format"&&i.length>=2?t.SetFormat(i[1]):i[0]==="element"&&i.length>=3?t.AddElement(i[1],parseInt(i[2],10)):i[0]==="property"&&i.length>=3&&(i[1]==="list"&&i.length>=5?t.AddListFormat(i[2],i[3],i[4]):t.AddSingleFormat(i[1],i[2])))}),t}ReadAsciiContent(e,t){let r=e.GetElement("vertex"),i=e.GetElement("face"),n=0,s=0;Me(t,l=>{if(this.WasError())return;let a=ve(l,null);if(!(a.length===0||a[0]==="comment")){if(n<r.count){a.length>=3&&(this.mesh.AddVertex(new y(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]))),n+=1);return}if(i!==null&&s<i.count){if(a.length>=4){let u=parseInt(a[0],10);if(a.length<u+1)return;for(let h=0;h<u-2;h++){let f=parseInt(a[1]),d=parseInt(a[h+2]),c=parseInt(a[h+3]),p=new U(f,d,c);this.mesh.AddTriangle(p)}s+=1}return}}})}ReadBinaryContent(e,t,r){function i(h,f){function d(c,p){return p==="char"||p==="int8"?c.ReadCharacter8():p==="uchar"||p==="uint8"?c.ReadUnsignedCharacter8():p==="short"||p==="int16"?c.ReadInteger16():p==="ushort"||p==="uint16"?c.ReadUnsignedInteger16():p==="int"||p==="int32"?c.ReadInteger32():p==="uint"||p==="uint32"?c.ReadUnsignedInteger32():p==="float"||p==="float32"?c.ReadFloat32():p==="double"||p==="double64"?c.ReadDouble64():null}if(f.isSingle)return d(h,f.elemType);{let c=[],p=d(h,f.countType);for(let m=0;m<p;m++)c.push(d(h,f.elemType));return c}}function n(h,f,d){for(let c=d;c<f.length;c++)i(h,f[c])}function s(h,f,d){let c=null,p=null,m=null,x=255;for(let g=d;g<f.length;g++){let C=f[g],E=i(h,C);C.name==="red"?c=E:C.name==="green"?p=E:C.name==="blue"?m=E:C.name==="alpha"&&(x=E)}return c!==null&&p!==null&&m!==null?[c,p,m,x]:null}let l=null;if(e.format==="binary_little_endian")l=new ne(t,!0);else if(e.format==="binary_big_endian")l=new ne(t,!1);else return;l.Skip(r);let a=new Wi(this.model),u=e.GetElements();for(let h=0;h<u.length;h++){let f=u[h];if(f.name==="vertex")for(let d=0;d<f.count;d++){let c=i(l,f.format[0]),p=i(l,f.format[1]),m=i(l,f.format[2]),x=s(l,f.format,3);x!==null&&this.mesh.AddVertexColor(new F(x[0],x[1],x[2])),this.mesh.AddVertex(new y(c,p,m))}else if(f.name==="face")for(let d=0;d<f.count;d++){let c=i(l,f.format[0]),p=s(l,f.format,1);for(let m=0;m<c.length-2;m++){let x=c[0],g=c[m+1],C=c[m+2],E=new U(x,g,C);p!==null?E.mat=a.GetMaterialIndexByColor(p):this.mesh.VertexColorCount()>0&&E.SetVertexColors(x,g,C),this.mesh.AddTriangle(E)}}else if(f.name==="tristrips")for(let d=0;d<f.count;d++){let c=i(l,f.format[0]);n(l,f.format,1);let p=!0;for(let m=0;m<c.length-2;m++){let x=c[m],g=c[m+1],C=c[m+2];if(C===-1){m+=2,p=!0;continue}if(!p){let T=g;g=C,C=T}p=!p;let E=new U(x,g,C);this.mesh.AddTriangle(E)}}else n(l,f.format,0)}}};var Kt=class extends k{constructor(){super()}CanImportExtension(e){return e==="stl"}GetUpDirection(){return R.Z}ClearContent(){this.mesh=null,this.triangle=null}ResetContent(){this.mesh=new j,this.model.AddMeshToRootNode(this.mesh),this.triangle=null}ImportContent(e,t){if(this.IsBinaryStlFile(e))this.ProcessBinary(e);else{let r=J(e);Me(r,i=>{this.WasError()||this.ProcessLine(i)})}t()}IsBinaryStlFile(e){let t=e.byteLength;if(t<84)return!1;let r=new ne(e,!0);r.Skip(80);let i=r.ReadUnsignedInteger32();return t===i*50+84}ProcessLine(e){if(e[0]==="#")return;let t=ve(e,"#");if(t.length===0)return;let r=t[0];if(r==="solid"){if(t.length>1){let i=ze(e,r.length,"#");this.mesh.SetName(i)}return}if(r==="facet"){if(this.triangle=new U(-1,-1,-1),t.length>=5&&t[1]==="normal"){let i=new y(parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4]));if(Cr(i.Length())){let n=this.mesh.AddNormal(i);this.triangle.SetNormals(n,n,n)}}return}if(r==="vertex"&&this.triangle!==null){if(t.length>=4){let i=this.mesh.AddVertex(new y(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])));this.triangle.v0===-1?this.triangle.v0=i:this.triangle.v1===-1?this.triangle.v1=i:this.triangle.v2===-1&&(this.triangle.v2=i)}return}if(r==="endfacet"&&this.triangle!==null){this.triangle.v0!==-1&&this.triangle.v1!==-1&&this.triangle.v2!==null&&this.mesh.AddTriangle(this.triangle),this.triangle=null;return}}ProcessBinary(e){function t(s){let l=new y;return l.x=s.ReadFloat32(),l.y=s.ReadFloat32(),l.z=s.ReadFloat32(),l}function r(s,l){let a=t(l);return s.AddVertex(a)}let i=new ne(e,!0);i.Skip(80);let n=i.ReadUnsignedInteger32();for(let s=0;s<n;s++){let l=t(i),a=r(this.mesh,i),u=r(this.mesh,i),h=r(this.mesh,i);i.Skip(2);let f=new U(a,u,h);if(Cr(l.Length())){let d=this.mesh.AddNormal(l);f.SetNormals(d,d,d)}this.mesh.AddTriangle(f)}}};var He=class extends k{constructor(){super()}GetExternalLibraries(){return null}CreateLoader(e){return null}GetMainObject(e){return e}IsMeshVisible(e){return!0}ClearContent(){this.loader=null,this.materialIdToIndex=null,this.objectUrlToFileName=null}ResetContent(){this.loader=null,this.materialIdToIndex=new Map,this.objectUrlToFileName=new Map}ImportContent(e,t){async function r(n,s,l){try{for(let a=0;a<n.length;a++)await he(n[a])}catch{l()}s()}let i=this.GetExternalLibraries();if(i===null){t();return}r(i,()=>{this.LoadModel(e,t)},()=>{t()})}LoadModel(e,t){let r=!1,i=new THREE.LoadingManager(()=>{r=!0}),n=nt(e);i.setURLModifier(l=>{if(l===n)return l;let a=Y(l);if(De(l).length>0){let h=this.callbacks.getFileBuffer(l);if(h!==null){let f=nt(h);return this.objectUrlToFileName.set(f,a),f}}return l});let s=this.CreateLoader(i);if(s===null){t();return}s.load(n,l=>{Jr(()=>r?(this.OnThreeObjectsLoaded(l,t),!1):!0)},()=>{},l=>{this.SetError(l),t()})}OnThreeObjectsLoaded(e,t){function r(l){let a=new O().CreateIdentity();return l.updateMatrix(),l.matrix!==void 0&&l.matrix!==null&&a.Set(l.matrix.elements),new H(a)}function i(l,a,u,h){let f=new pe;u.name!==void 0&&f.SetName(u.name),f.SetTransformation(r(u)),h.AddChildNode(f);for(let d of u.children)i(l,a,d,f);if(u.isMesh&&l.IsMeshVisible(u)){u.children.length===0&&f.SetType(Ge.MeshNode);let d=l.ConvertThreeMesh(u),c=a.AddMesh(d);f.AddMeshIndex(c)}}let n=this.GetMainObject(e),s=this.model.GetRootNode();s.SetTransformation(r(n));for(let l of n.children)i(this,this.model,l,s);t()}ConvertThreeMesh(e){let t=null;if(Array.isArray(e.material)){if(t=ot(e.geometry,null),e.geometry.attributes.color===void 0||e.geometry.attributes.color===null){let r=[];for(let i=0;i<e.material.length;i++){let n=e.material[i],s=this.FindOrCreateMaterial(n);r.push(s)}for(let i=0;i<e.geometry.groups.length;i++){let n=e.geometry.groups[i],s=n.start;n.count===1/0?s=t.TriangleCount():s=n.start/3+n.count/3;for(let l=n.start/3;l<s;l++)t.GetTriangle(l).SetMaterial(r[n.materialIndex])}}}else{let r=this.FindOrCreateMaterial(e.material);t=ot(e.geometry,r)}return e.name!==void 0&&e.name!==null&&t.SetName(e.name),t}FindOrCreateMaterial(e){if(this.materialIdToIndex.has(e.id))return this.materialIdToIndex.get(e.id);let t=this.ConvertThreeMaterial(e),r=this.model.AddMaterial(t);return this.materialIdToIndex.set(e.id,r),r}ConvertThreeMaterial(e){function t(i,n){function s(l){if(l.data!==void 0&&l.data!==null){let a=new ImageData(l.width,l.height),u=l.width*l.height*4;for(let h=0;h<u;h++)a.data[h]=l.data[h];return THREE.ImageUtils.getDataURL(a)}else return THREE.ImageUtils.getDataURL(l)}if(i==null||i.image===void 0||i.image===null)return null;try{let l=s(i.image),a=it(l),u=new ye,h=null;return n.has(i.image.src)?h=n.get(i.image.src):i.name!==void 0&&i.name!==null?h=i.name+"."+Ye(a.mimeType):h="Embedded_"+i.id.toString()+"."+Ye(a.mimeType),u.name=h,u.url=l,u.buffer=a.buffer,u.rotation=i.rotation,u.offset.x=i.offset.x,u.offset.y=i.offset.y,u.scale.x=i.repeat.x,u.scale.y=i.repeat.y,u}catch{return null}}let r=new q;return r.name=e.name,r.color=Ft(e.color),r.opacity=e.opacity,r.transparent=e.transparent,r.alphaTest=e.alphaTest,e.type==="MeshPhongMaterial"&&(r.specular=Ft(e.specular),r.shininess=e.shininess/100),r.diffuseMap=t(e.map,this.objectUrlToFileName),r.normalMap=t(e.normalMap,this.objectUrlToFileName),r.bumpMap=t(e.bumpMap,this.objectUrlToFileName),r}},Zt=class extends He{constructor(){super()}CanImportExtension(e){return e==="fbx"}GetUpDirection(){return R.Y}GetExternalLibraries(){return["loaders/fflate.min.js","three_loaders/TGALoader.js","three_loaders/FBXLoader.js"]}CreateLoader(e){return e.addHandler(/\.tga$/i,new THREE.TGALoader(e)),new THREE.FBXLoader(e)}GetMainObject(e){return e}},Qt=class extends He{constructor(){super()}CanImportExtension(e){return e==="dae"}GetUpDirection(){return R.Y}GetExternalLibraries(){return["three_loaders/TGALoader.js","three_loaders/ColladaLoader.js"]}CreateLoader(e){return e.addHandler(/\.tga$/i,new THREE.TGALoader(e)),new THREE.ColladaLoader(e)}GetMainObject(e){return e.scene}},$t=class extends He{constructor(){super()}CanImportExtension(e){return e==="wrl"}GetUpDirection(){return R.Y}GetExternalLibraries(){return["three_loaders/chevrotain.min.js","three_loaders/VRMLLoader.js"]}CreateLoader(e){return new THREE.VRMLLoader(e)}GetMainObject(e){return e}IsMeshVisible(e){let t=!0;if(Array.isArray(e.material)){for(let r=0;r<e.material.length;r++)if(e.material[r].side===THREE.BackSide){t=!1;break}}else t=e.material.side!==THREE.BackSide;return t}},er=class extends He{constructor(){super()}CanImportExtension(e){return e==="3mf"}GetUpDirection(){return R.Z}GetExternalLibraries(){return["loaders/fflate.min.js","three_loaders/3MFLoader.js"]}CreateLoader(e){return new THREE.ThreeMFLoader(e)}GetMainObject(e){return e}};var tr=class{constructor(){this.defaultColor=new F(200,200,200)}},_e={NoImportableFile:1,FailedToLoadFile:2,ImportFailed:3,UnknownError:4},tt=class{constructor(e,t){this.code=e,this.message=t}},Or=class{constructor(){this.model=null,this.mainFile=null,this.upVector=null,this.usedFiles=null,this.missingFiles=null}},Br=class{constructor(e){this.getBufferCallback=e,this.fileBuffers=new Map,this.textureBuffers=new Map}GetFileBuffer(e){let t=Y(e);if(this.fileBuffers.has(t))return this.fileBuffers.get(t);let r=this.getBufferCallback(t);return this.fileBuffers.set(t,r),r}GetTextureBuffer(e){let t=Y(e);if(this.textureBuffers.has(t))return this.textureBuffers.get(t);let r=null,i=this.getBufferCallback(t);return i!==null&&(r={url:nt(i),buffer:i}),this.textureBuffers.set(t,r),r}},rr=class{constructor(){this.importers=[new Xt,new Kt,new Yt,new Jt,new jt,new kt,new qt,new _t,new Wt,new Zt,new Qt,new $t,new er],this.fileList=new at,this.model=null,this.usedFiles=[],this.missingFiles=[]}AddImporter(e){this.importers.push(e)}ImportFiles(e,t,r,i){this.LoadFiles(e,t,()=>{i.onFilesLoaded(),cr(()=>{this.ImportLoadedFiles(r,i)})})}LoadFiles(e,t,r){let i=new at(this.importers);t===X.Url?i.FillFromFileUrls(e):t===X.File&&i.FillFromFileObjects(e);let n=!1;if(this.HasImportableFile(i))n=!0;else{let s=!1;for(let l=0;l<this.missingFiles.length;l++){let a=this.missingFiles[l];i.ContainsFileByPath(a)&&(s=!0)}if(!s)n=!0;else{let l=i.GetFiles();this.fileList.ExtendFromFileList(l),n=!1}}n&&(this.fileList=i),this.fileList.GetContent(()=>{this.DecompressArchives(this.fileList,()=>{r()})})}ImportLoadedFiles(e,t){let r=this.GetImportableFiles(this.fileList);if(r.length===0){t.onImportError(new tt(_e.NoImportableFile,null));return}if(r.length===1||!t.onSelectMainFile){let i=r[0];this.ImportLoadedMainFile(i,e,t)}else{let i=r.map(n=>n.file.name);t.onSelectMainFile(i,n=>{if(n===null){t.onImportError(new tt(_e.NoImportableFile,null));return}cr(()=>{let s=r[n];this.ImportLoadedMainFile(s,e,t)})})}}ImportLoadedMainFile(e,t,r){if(e===null||e.file===null||e.file.content===null){r.onImportError(new tt(_e.FailedToLoadFile,null));return}this.RevokeModelUrls(),this.model=null,this.usedFiles=[],this.missingFiles=[],this.usedFiles.push(e.file.name);let i=e.importer,n=new Br(s=>{let l=null,a=this.fileList.FindFileByPath(s);return a===null||a.content===null?(this.missingFiles.push(s),l=null):(this.usedFiles.push(s),l=a.content),l});i.Import(e.file.name,e.file.extension,e.file.content,{getDefaultMaterialColor:()=>t.defaultColor,getFileBuffer:s=>n.GetFileBuffer(s),getTextureBuffer:s=>n.GetTextureBuffer(s),onSuccess:()=>{this.model=i.GetModel();let s=new Or;s.mainFile=e.file.name,s.model=this.model,s.usedFiles=this.usedFiles,s.missingFiles=this.missingFiles,s.upVector=i.GetUpDirection(),r.onImportSuccess(s)},onError:()=>{let s=i.GetErrorMessage();r.onImportError(new tt(_e.ImportFailed,s))},onComplete:()=>{i.Clear()}})}DecompressArchives(e,t){let r=e.GetFiles(),i=[];for(let n of r)n.extension==="zip"&&i.push(n);if(i.length===0){t();return}he("loaders/fflate.min.js").then(()=>{for(let n=0;n<i.length;n++){let s=i[n],l=new Uint8Array(s.content),a=fflate.unzipSync(l);for(let u in a)if(Object.prototype.hasOwnProperty.call(a,u)){let h=new lt(u,X.Decompressed);h.SetContent(a[u].buffer),e.AddFile(h)}}t()}).catch(()=>{t()})}GetFileList(){return this.fileList}HasImportableFile(e){return this.GetImportableFiles(e).length>0}GetImportableFiles(e){function t(n,s){for(let l=0;l<s.length;l++){let a=s[l];if(a.CanImportExtension(n.extension))return a}return null}let r=[],i=e.GetFiles();for(let n=0;n<i.length;n++){let s=i[n],l=t(s,this.importers);l!==null&&r.push({file:s,importer:l})}return r}RevokeModelUrls(){if(this.model!==null)for(let e=0;e<this.model.MaterialCount();e++)this.model.GetMaterial(e).EnumerateTextureMaps(r=>{r.url!==null&&$r(r.url)})}};var Z={IntegerToString(o){return o.toString()},StringToInteger(o){return parseInt(o,10)},NumberToString(o){let e=5;return o.toPrecision(e)},StringToNumber(o){return parseFloat(o)},ModelUrlsToString:function(o){return o===null?null:o.join(",")},StringToModelUrls:function(o){return o===null||o.length===0?null:o.split(",")},CameraToString:function(o){return o===null?null:[this.NumberToString(o.eye.x),this.NumberToString(o.eye.y),this.NumberToString(o.eye.z),this.NumberToString(o.center.x),this.NumberToString(o.center.y),this.NumberToString(o.center.z),this.NumberToString(o.up.x),this.NumberToString(o.up.y),this.NumberToString(o.up.z)].join(",")},StringToCamera:function(o){if(o===null||o.length===0)return null;let e=o.split(",");return e.length!==9?null:new Ae(new y(this.StringToNumber(e[0]),this.StringToNumber(e[1]),this.StringToNumber(e[2])),new y(this.StringToNumber(e[3]),this.StringToNumber(e[4]),this.StringToNumber(e[5])),new y(this.StringToNumber(e[6]),this.StringToNumber(e[7]),this.StringToNumber(e[8])))},ColorToString:function(o){return o===null?null:[this.IntegerToString(o.r),this.IntegerToString(o.g),this.IntegerToString(o.b)].join(",")},StringToColor:function(o){if(o===null||o.length===0)return null;let e=o.split(",");return e.length!==3?null:new F(this.StringToInteger(e[0]),this.StringToInteger(e[1]),this.StringToInteger(e[2]))},EdgeSettingsToString:function(o){return o===null?null:[o.showEdges?"on":"off",this.ColorToString(o.edgeColor),this.IntegerToString(o.edgeThreshold)].join(",")},StringToEdgeSettings:function(o){if(o===null||o.length===0)return null;let e=o.split(",");return e.length!==5?null:{showEdges:e[0]==="on",edgeColor:new F(this.StringToInteger(e[1]),this.StringToInteger(e[2]),this.StringToInteger(e[3])),edgeThreshold:this.StringToInteger(e[4])}}},Lr=class{constructor(e){this.separator=e,this.paramList=""}AddModelUrls(e){return this.AddUrlPart("model",Z.ModelUrlsToString(e)),this}AddCamera(e){return this.AddUrlPart("camera",Z.CameraToString(e)),this}AddBackgroundColor(e){return this.AddUrlPart("backgroundcolor",Z.ColorToString(e)),this}AddDefaultColor(e){return this.AddUrlPart("defaultcolor",Z.ColorToString(e)),this}AddEdgeSettings(e){return this.AddUrlPart("edgesettings",Z.EdgeSettingsToString(e)),this}AddUrlPart(e,t){e===null||t===null||(this.paramList.length>0&&(this.paramList+=this.separator),this.paramList+=e+"="+t)}GetParameterList(){return this.paramList}},Ur=class{constructor(e,t){this.separator=t,this.paramList=e}GetModelUrls(){if(this.paramList.indexOf("=")===-1)return this.paramList.split(",");let e=this.GetKeywordParams("model");return Z.StringToModelUrls(e)}GetCamera(){let e=this.GetKeywordParams("camera");return Z.StringToCamera(e)}GetBackgroundColor(){let e=this.GetKeywordParams("backgroundcolor");return Z.StringToColor(e)}GetDefaultColor(){let e=this.GetKeywordParams("defaultcolor");return Z.StringToColor(e)}GetEdgeSettings(){let e=this.GetKeywordParams("edgesettings");return Z.StringToEdgeSettings(e)}GetKeywordParams(e){if(this.paramList===null||this.paramList.length===0)return null;let t=e+"=",r=this.paramList.split(this.separator);for(let i=0;i<r.length;i++){let n=r[i];if(n.startsWith(t))return n.substring(t.length)}return null}};function qi(){return new Lr("$")}function Rn(o){return new Ur(o,"$")}function Fn(o){let e=qi();return e.AddModelUrls(o),e.GetParameterList()}var ir=class{constructor(){this.forceMediumpForMaterials=!1}},nr=class{constructor(){this.defaultMaterial=null}},zr=class{constructor(e){this.callbacks=e,this.texturesNeeded=0,this.texturesLoaded=0,this.threeObject=null}OnTextureNeeded(){this.texturesNeeded+=1}OnTextureLoaded(){this.texturesLoaded+=1,this.callbacks.onTextureLoaded(),this.Finish()}OnModelLoaded(e){this.threeObject=e,this.Finish()}Finish(){this.threeObject!==null&&this.texturesNeeded===this.texturesLoaded&&this.callbacks.onModelLoaded(this.threeObject)}},Hr=class{constructor(e,t){this.meshInstances=[],this.AddNode(e,t)}AddNode(e,t){let r=e.GetTransformation().GetMatrix(),i=new THREE.Matrix4().fromArray(r.Get());t.applyMatrix4(i);for(let n of e.GetChildNodes()){let s=new THREE.Object3D;t.add(s),this.AddNode(n,s)}for(let n of e.GetMeshIndices())this.meshInstances.push({node:e,threeNode:t,meshIndex:n})}GetMeshInstances(){return this.meshInstances}};function wi(o,e,t,r){function i(d,c,p,m,x,g){function C(b,G){G.wrapS=THREE.RepeatWrapping,G.wrapT=THREE.RepeatWrapping,G.rotation=b.rotation,G.offset.x=b.offset.x,G.offset.y=b.offset.y,G.repeat.x=b.scale.x,G.repeat.y=b.scale.y}function E(b,G,B,N){if(B===null||!B.IsValid())return;let D=new THREE.TextureLoader;b.OnTextureNeeded(),D.load(B.url,V=>{C(B,V),G.needsUpdate=!0,N(V),b.OnTextureLoaded()},null,V=>{b.OnTextureLoaded()})}let T=c.GetMaterial(p),I=de(T.color);T.vertexColors&&I.setRGB(1,1,1);let w={color:I,vertexColors:T.vertexColors,opacity:T.opacity,transparent:T.transparent,alphaTest:T.alphaTest,side:THREE.DoubleSide};x.forceMediumpForMaterials&&(w.precision="mediump");let M=null;if(m===oe.Phong){if(M=new THREE.MeshPhongMaterial(w),T.type===ee.Phong){let b=de(T.specular);P(T.shininess,0)&&b.setRGB(0,0,0),M.specular=b,M.shininess=T.shininess*100,E(d,M,T.specularMap,G=>{M.specularMap=G})}}else m===oe.Physical&&(M=new THREE.MeshStandardMaterial(w),T.type===ee.Physical&&(M.metalness=T.metalness,M.roughness=T.roughness,E(d,M,T.metalnessMap,b=>{M.metalness=1,M.roughness=1,M.metalnessMap=b,M.roughnessMap=b})));let A=de(T.emissive);return M.emissive=A,E(d,M,T.diffuseMap,b=>{T.multiplyDiffuseMap||M.color.setRGB(1,1,1),M.map=b}),E(d,M,T.bumpMap,b=>{M.bumpMap=b}),E(d,M,T.normalMap,b=>{M.normalMap=b}),E(d,M,T.emissiveMap,b=>{M.emissiveMap=b}),T.isDefault&&(g.defaultMaterial=M),M}function n(d,c,p){let m=d.GetMesh(c.meshIndex),x=m.TriangleCount(),g=[];for(let V=0;V<x;V++)g.push(V);g.sort((V,te)=>{let z=m.GetTriangle(V),xe=m.GetTriangle(te);return z.mat-xe.mat});let C=new THREE.BufferGeometry,E=[],T=[],I=new Map,w=[],M=[],A=[],b=[],G=[];G.push({start:0,end:-1});let B=m.VertexColorCount()>0,N=m.TextureUVCount()>0;for(let V=0;V<g.length;V++){let te=g[V],z=m.GetTriangle(te),xe=m.GetVertex(z.v0),Fe=m.GetVertex(z.v1),qr=m.GetVertex(z.v2);if(w.push(xe.x,xe.y,xe.z,Fe.x,Fe.y,Fe.z,qr.x,qr.y,qr.z),z.HasVertexColors()){let _=de(m.GetVertexColor(z.c0)),Ct=de(m.GetVertexColor(z.c1)),Tt=de(m.GetVertexColor(z.c2));M.push(_.r,_.g,_.b,Ct.r,Ct.g,Ct.b,Tt.r,Tt.g,Tt.b)}else B&&M.push(0,0,0,0,0,0,0,0,0);let xt=m.GetNormal(z.n0),gt=m.GetNormal(z.n1),rt=m.GetNormal(z.n2);if(A.push(xt.x,xt.y,xt.z,gt.x,gt.y,gt.z,rt.x,rt.y,rt.z),z.HasTextureUVs()){let _=m.GetTextureUV(z.u0),Ct=m.GetTextureUV(z.u1),Tt=m.GetTextureUV(z.u2);b.push(_.x,_.y,Ct.x,Ct.y,Tt.x,Tt.y)}else N&&b.push(0,0,0,0,0,0);let Q=z.mat;I.has(Q)||(I.set(Q,E.length),E.push(p[Q]),T.push(Q),V>0&&(G[G.length-1].end=V-1,G.push({start:G[G.length-1].end+1,end:-1})))}G[G.length-1].end=x-1,C.setAttribute("position",new THREE.Float32BufferAttribute(w,3)),M.length!==0&&C.setAttribute("color",new THREE.Float32BufferAttribute(M,3)),C.setAttribute("normal",new THREE.Float32BufferAttribute(A,3)),b.length!==0&&C.setAttribute("uv",new THREE.Float32BufferAttribute(b,2));for(let V=0;V<G.length;V++){let te=G[V];C.addGroup(te.start*3,(te.end-te.start+1)*3,V)}let D=new THREE.Mesh(C,E);return D.userData={originalMeshId:c,originalMaterials:T,threeMaterials:null},D}function s(d,c,p,m){let x=c.GetMesh(p.meshIndex);if(Qe(x)===Le.TriangleMesh){let C=n(c,p,m);d.add(C)}}function l(d,c,p,m){let x=c.GetRootNode(),C=new Hr(x,d).GetMeshInstances();Yr(C.length,100,{runTask:(E,T,I)=>{for(let w=E;w<=T;w++){let M=C[w],A=M.node,b=M.threeNode,G=new qe(A.GetId(),M.meshIndex);s(b,c,G,p)}I()},onReady:()=>{m.OnModelLoaded(d)}})}let a=new zr(r),u=li(o),h=[];for(let d=0;d<o.MaterialCount();d++){let c=i(a,o,d,u,e,t);h.push(c)}let f=new THREE.Object3D;l(f,o,h,a)}var sr=class{constructor(){this.importer=new rr,this.inProgress=!1,this.defaultMaterial=null,this.hasHighpDriverIssue=oi()}InProgress(){return this.inProgress}LoadModel(e,t,r,i){this.inProgress||(this.inProgress=!0,i.onLoadStart(),this.importer.ImportFiles(e,t,r,{onFilesLoaded:()=>{i.onImportStart()},onSelectMainFile:(n,s)=>{i.onSelectMainFile?i.onSelectMainFile(n,s):s(0)},onImportSuccess:n=>{i.onVisualizationStart();let s=new ir;s.forceMediumpForMaterials=this.hasHighpDriverIssue;let l=new nr;wi(n.model,s,l,{onTextureLoaded:()=>{i.onTextureLoaded()},onModelLoaded:a=>{this.defaultMaterial=l.defaultMaterial,i.onModelFinished(n,a),this.inProgress=!1}})},onImportError:n=>{i.onLoadError(n),this.inProgress=!1}}))}GetImporter(){return this.importer}GetDefaultMaterial(){return this.defaultMaterial}ReplaceDefaultMaterialColor(e){this.defaultMaterial!==null&&!this.defaultMaterial.vertexColors&&(this.defaultMaterial.color=de(e))}};var _r=class{constructor(e,t){this.parentElement=e,this.parameters={},yt(t)&&(this.parameters=t),this.canvas=document.createElement("canvas"),this.parentElement.appendChild(this.canvas),this.viewer=new Ot,this.viewer.Init(this.canvas);let r=this.parentElement.clientWidth,i=this.parentElement.clientHeight;this.viewer.Resize(r,i),this.parameters.backgroundColor&&this.viewer.SetBackgroundColor(this.parameters.backgroundColor),this.parameters.edgeSettings&&this.viewer.SetEdgeSettings(this.parameters.edgeSettings.showEdges,this.parameters.edgeSettings.edgeColor,this.parameters.edgeSettings.edgeThreshold),this.parameters.environmentMap&&this.viewer.SetEnvironmentMap(this.parameters.environmentMap),window.addEventListener("resize",()=>{this.Resize()})}LoadModelFromUrls(e){if(this.viewer.Clear(),e===null||e.length===0)return null;Qr(e);let t=new tr;this.parameters.defaultColor&&(t.defaultColor=this.parameters.defaultColor);let r=null;new sr().LoadModel(e,X.Url,t,{onLoadStart:()=>{this.canvas.style.display="none",r=document.createElement("div"),r.innerHTML="Loading model...",this.parentElement.appendChild(r)},onImportStart:()=>{r.innerHTML="Importing model..."},onVisualizationStart:()=>{r.innerHTML="Visualizing model..."},onModelFinished:(n,s)=>{this.parentElement.removeChild(r),this.canvas.style.display="inherit",this.viewer.SetMainObject(s);let l=this.viewer.GetBoundingSphere(a=>!0);this.viewer.AdjustClippingPlanesToSphere(l),this.parameters.camera?this.viewer.SetCamera(this.parameters.camera):this.viewer.SetUpVector(n.upVector,!1),this.viewer.FitSphereToWindow(l,!1)},onTextureLoaded:()=>{this.viewer.Render()},onLoadError:n=>{let s="Unknown error";n.code===_e.NoImportableFile?s="No importable file found":n.code===_e.FailedToLoadFile?s="Failed to load file for import.":n.code===_e.ImportFailed&&(s="Failed to import model."),n.message!==null&&(s+=" ("+n.message+")"),r.innerHTML=s}})}GetViewer(){return this.viewer}Resize(){let e=this.parentElement.clientWidth,t=this.parentElement.clientHeight;this.viewer.Resize(e,t)}};function Xi(o,e,t){let r=new _r(o,t);return r.LoadModelFromUrls(e),r}function Nn(o){function e(r){let i=null,n=r.getAttribute("camera");n&&(i=Z.StringToCamera(n));let s=null,l=r.getAttribute("backgroundcolor");l&&(s=Z.StringToColor(l));let a=null,u=r.getAttribute("defaultcolor");u&&(a=Z.StringToColor(u));let h=null,f=r.getAttribute("edgesettings");f&&(h=Z.StringToEdgeSettings(f));let d=null,c=r.getAttribute("environmentmap");if(c){let x=c.split(",");x.length===6&&(d=x)}let p=null,m=r.getAttribute("model");return m&&(p=Z.StringToModelUrls(m)),Xi(r,p,{camera:i,backgroundColor:s,defaultColor:a,edgeSettings:h,environmentMap:d})}let t=[];window.addEventListener("load",()=>{let r=document.getElementsByClassName("online_3d_viewer");for(let i=0;i<r.length;i++){let n=r[i],s=e(n);t.push(s)}o?.(t)})}function Yi(o,e,t){let r=Ce(o,e),i=Ce(e,t),n=Ce(o,t),s=(r+i+n)/2,l=s*(s-r)*(s-i)*(s-n);return l<0?0:Math.sqrt(l)}function Ji(o,e,t){return Tr(o,be(e,t))/6}function Dn(o){let e=0;return o.EnumerateTriangleVertices((t,r,i)=>{e+=Ji(t,r,i)}),e}function Vn(o){let e=0;return o.EnumerateTriangleVertices((t,r,i)=>{e+=Yi(t,r,i)}),e}var jr=class{constructor(){this.indices=[],this.vertices=[],this.colors=[],this.normals=[],this.uvs=[],this.material=null}GetBounds(){let e=[1/0,1/0,1/0],t=[-1/0,-1/0,-1/0];for(let r=0;r<this.vertices.length/3;r++)for(let i=0;i<3;i++)e[i]=Math.min(e[i],this.vertices[r*3+i]),t[i]=Math.max(t[i],this.vertices[r*3+i]);return{min:e,max:t}}GetByteLength(e,t){let r=this.indices.length,i=this.vertices.length+this.colors.length+this.normals.length+this.uvs.length;return r*e+i*t}},kr=class{constructor(){this.primitives=[]}PrimitiveCount(){return this.primitives.length}GetPrimitive(e){return this.primitives[e]}GetByteLength(e,t){let r=0;for(let i=0;i<this.primitives.length;i++)r+=this.primitives[i].GetByteLength(e,t);return r}};function or(o){function e(l,a,u,h){function f(m,x,g){return x!==null?m.GetVertexColor(x):g?new F(0,0,0):null}function d(m,x,g){return x!==null?m.GetTextureUV(x):g?new v(0,0):null}function c(m,x,g){let C=m.VertexColorCount()>0,E=m.TextureUVCount()>0,T=m.GetVertex(x.vertex),I=m.GetNormal(x.normal),w=g.vertices.length/3;g.indices.push(w),g.vertices.push(T.x,T.y,T.z);let M=f(m,x.color,C);M!==null&&g.colors.push(M.r/255,M.g/255,M.b/255),g.normals.push(I.x,I.y,I.z);let A=d(m,x.uv,E);return A!==null&&g.uvs.push(A.x,A.y),{index:w,color:M,normal:I,uv:A}}function p(m,x,g){function C(I,w,M){if(M===null&&w===null)return!0;let A=f(I,w,!0);return je(M,A)}function E(I,w,M){let A=I.GetNormal(w);return ge(M,A)}function T(I,w,M){if(M===null&&w===null)return!0;let A=d(I,w,!0);return Se(M,A)}for(let I=0;I<x.length;I++){let w=x[I],M=C(m,g.color,w.color),A=E(m,g.normal,w.normal),b=T(m,g.uv,w.uv);if(M&&A&&b)return w}return null}if(h.has(a.vertex)){let m=h.get(a.vertex),x=p(l,m,a);if(x!==null)u.indices.push(x.index);else{let g=c(l,a,u);m.push(g)}}else{let m=c(l,a,u);h.set(a.vertex,[m])}}let t=new kr,r=o.TriangleCount();if(r===0)return null;let i=[];for(let l=0;l<r;l++)i.push(l);i.sort((l,a)=>{let u=o.GetTriangle(l),h=o.GetTriangle(a);return u.mat-h.mat});let n=null,s=null;for(let l=0;l<i.length;l++){let a=i[l],u=o.GetTriangle(a);(n===null||n.material!==u.mat)&&(n=new jr,n.material=u.mat,s=new Map,t.primitives.push(n));let h={vertex:u.v0,color:u.c0,normal:u.n0,uv:u.u0},f={vertex:u.v1,color:u.c1,normal:u.n1,uv:u.u1},d={vertex:u.v2,color:u.c2,normal:u.n2,uv:u.u2};e(o,h,n,s),e(o,f,n,s),e(o,d,n,s)}return t}var W=class{constructor(e){this.name=e,this.content=null}GetName(){return this.name}SetName(e){this.name=e}GetTextContent(){return J(this.content)}GetBufferContent(){return this.content}SetTextContent(e){let t=It(e);this.content=t}SetBufferContent(e){this.content=e}},ie=class{constructor(){}CanExport(e,t){return!1}Export(e,t,r){let i=[];this.ExportContent(e,t,i,()=>{r(i)})}ExportContent(e,t,r,i){}GetExportedMaterialName(e){return this.GetExportedName(e,"Material")}GetExportedMeshName(e){return this.GetExportedName(e,"Mesh")}GetExportedName(e,t){return e.length===0?t:e}};var lr=class extends ie{constructor(){super(),this.rhino=null}CanExport(e,t){return e===L.Binary&&t==="3dm"}ExportContent(e,t,r,i){this.rhino===null?he("loaders/rhino3dm.min.js").then(()=>{rhino3dm().then(n=>{this.rhino=n,this.ExportRhinoContent(e,r,i)})}).catch(()=>{i()}):this.ExportRhinoContent(e,r,i)}ExportRhinoContent(e,t,r){function i(u){return{r:u.r,g:u.g,b:u.b,a:255}}let n=new W("model.3dm");t.push(n);let s=new this.rhino.File3dm;e.EnumerateTransformedMeshes(u=>{let h=or(u);for(let f=0;f<h.PrimitiveCount();f++){let d=h.GetPrimitive(f),c={data:{attributes:{position:{itemSize:3,type:"Float32Array",array:d.vertices},normal:{itemSize:3,type:"Float32Array",array:d.normals}},index:{type:"Uint16Array",array:d.indices}}},p=e.GetMaterial(d.material),m=new this.rhino.Material;m.name=this.GetExportedMaterialName(p.name),p.type===ee.Phong&&(m.ambientColor=i(p.ambient),m.specularColor=i(p.specular)),m.diffuseColor=i(p.color),m.transparency=1-p.opacity;let x=s.materials().count();s.materials().add(m);let g=new this.rhino.Mesh.createFromThreejsJSON(c),C=new this.rhino.ObjectAttributes;C.name=this.GetExportedMeshName(u.GetName()),C.materialSource=this.rhino.ObjectMaterialSource.MaterialFromObject,C.materialIndex=x,s.objects().add(g,C)}});let l=new this.rhino.File3dmWriteOptions;l.version=6;let a=s.toByteArray(l);n.SetBufferContent(a),r()}};var ar=class extends ie{constructor(){super(),this.components={index:{type:5125,size:4},number:{type:5126,size:4}}}CanExport(e,t){return e===L.Text&&t==="gltf"||e===L.Binary&&t==="glb"}ExportContent(e,t,r,i){t===L.Text?this.ExportAsciiContent(e,r):t===L.Binary&&this.ExportBinaryContent(e,r),i()}ExportAsciiContent(e,t){let r=new W("model.gltf"),i=new W("model.bin");t.push(r),t.push(i);let n=this.GetMeshData(e),s=this.GetMainBuffer(n),l=this.GetMainJson(n);l.buffers.push({uri:i.GetName(),byteLength:s.byteLength});let a=new Map;this.ExportMaterials(e,l,u=>{let h=Y(u.name);if(a.has(h))return a.get(h);{let f=new W(h);f.SetBufferContent(u.buffer),t.push(f);let d=l.textures.length;return a.set(h,d),l.images.push({uri:h}),l.textures.push({source:d}),d}}),r.SetTextContent(JSON.stringify(l,null,4)),i.SetBufferContent(s)}ExportBinaryContent(e,t){function r(T){let I=T%4;return I===0?T:T+(4-I)}function i(T,I,w){for(let M=0;M<w;M++)T.WriteUnsignedCharacter8(I)}let n=new W("model.glb");t.push(n);let s=this.GetMeshData(e),l=this.GetMainBuffer(s),a=this.GetMainJson(s),u=[],h=l.byteLength,f=new Map;this.ExportMaterials(e,a,T=>{let I=Y(T.name),w=De(T.name);if(f.has(I))return f.get(I);{let M=a.bufferViews.length,A=a.textures.length;f.set(I,A);let b=T.buffer;return u.push(b),a.bufferViews.push({buffer:0,byteOffset:h,byteLength:b.byteLength}),h+=b.byteLength,a.images.push({bufferView:M,mimeType:"image/"+w}),a.textures.push({source:A}),A}});let d=l.byteLength;for(let T=0;T<u.length;T++)d+=u[T].byteLength;let c=r(d);a.buffers.push({byteLength:c});let p=JSON.stringify(a),m=It(p),x=m.byteLength,g=r(x),C=12+8+g+8+c,E=new Ie(C,!0);E.WriteUnsignedInteger32(1179937895),E.WriteUnsignedInteger32(2),E.WriteUnsignedInteger32(C),E.WriteUnsignedInteger32(g),E.WriteUnsignedInteger32(1313821514),E.WriteArrayBuffer(m),i(E,32,g-x),E.WriteUnsignedInteger32(c),E.WriteUnsignedInteger32(5130562),E.WriteArrayBuffer(l);for(let T=0;T<u.length;T++){let I=u[T];E.WriteArrayBuffer(I)}i(E,0,c-d),n.SetBufferContent(E.GetBuffer())}GetMeshData(e){let t=[];return e.EnumerateTransformedMeshes(r=>{let i=or(r);t.push({name:r.GetName(),buffer:i,offsets:[],sizes:[]})}),t}GetMainBuffer(e){let t=0;for(let i=0;i<e.length;i++)t+=e[i].buffer.GetByteLength(this.components.index.size,this.components.number.size);let r=new Ie(t,!0);for(let i=0;i<e.length;i++){let n=e[i];for(let s=0;s<n.buffer.PrimitiveCount();s++){let l=n.buffer.GetPrimitive(s),a=r.GetPosition();for(let u=0;u<l.indices.length;u++)r.WriteUnsignedInteger32(l.indices[u]);for(let u=0;u<l.vertices.length;u++)r.WriteFloat32(l.vertices[u]);for(let u=0;u<l.colors.length;u++)r.WriteFloat32(Pe(l.colors[u]));for(let u=0;u<l.normals.length;u++)r.WriteFloat32(l.normals[u]);for(let u=0;u<l.uvs.length;u++){let h=l.uvs[u];u%2===1&&(h*=-1),r.WriteFloat32(h)}n.offsets.push(a),n.sizes.push(r.GetPosition()-a)}}return r.GetBuffer()}GetMainJson(e){class t{constructor(n,s){this.mainJson=n,this.byteOffset=s}AddBufferView(n){return this.mainJson.bufferViews.push({buffer:0,byteOffset:this.byteOffset,byteLength:n}),this.byteOffset+=n,this.mainJson.bufferViews.length-1}}let r={asset:{generator:"https://3dviewer.net",version:"2.0"},scene:0,scenes:[{nodes:[]}],nodes:[],materials:[],meshes:[],buffers:[],bufferViews:[],accessors:[]};for(let i=0;i<e.length;i++){let n=e[i];r.scenes[0].nodes.push(i),r.nodes.push({mesh:i});let s={name:this.GetExportedMeshName(n.name),primitives:[]},l=n.buffer.primitives;for(let a=0;a<l.length;a++){let u=l[a],h=new t(r,n.offsets[a]),f=h.AddBufferView(u.indices.length*this.components.index.size),d=h.AddBufferView(u.vertices.length*this.components.number.size),c=null;u.colors.length>0&&(c=h.AddBufferView(u.colors.length*this.components.number.size));let p=h.AddBufferView(u.normals.length*this.components.number.size),m=null;u.uvs.length>0&&(m=h.AddBufferView(u.uvs.length*this.components.number.size));let x={attributes:{},mode:4,material:u.material},g=u.GetBounds();r.accessors.push({bufferView:f,byteOffset:0,componentType:this.components.index.type,count:u.indices.length,type:"SCALAR"}),x.indices=r.accessors.length-1,r.accessors.push({bufferView:d,byteOffset:0,componentType:this.components.number.type,count:u.vertices.length/3,min:g.min,max:g.max,type:"VEC3"}),x.attributes.POSITION=r.accessors.length-1,c!==null&&(r.accessors.push({bufferView:c,byteOffset:0,componentType:this.components.number.type,count:u.colors.length/3,type:"VEC3"}),x.attributes.COLOR_0=r.accessors.length-1),r.accessors.push({bufferView:p,byteOffset:0,componentType:this.components.number.type,count:u.normals.length/3,type:"VEC3"}),x.attributes.NORMAL=r.accessors.length-1,m!==null&&(r.accessors.push({bufferView:m,byteOffset:0,componentType:this.components.number.type,count:u.uvs.length/2,type:"VEC2"}),x.attributes.TEXCOORD_0=r.accessors.length-1),s.primitives.push(x)}r.meshes.push(s)}return r}ExportMaterials(e,t,r){function i(n,s,l,a){function u(x,g){return[Pe(x.r/255),Pe(x.g/255),Pe(x.b/255),g]}function h(x){return[Pe(x.r/255),Pe(x.g/255),Pe(x.b/255)]}function f(x,g,C){if(g===null||!g.IsValid())return null;x.images===void 0&&(x.images=[]),x.textures===void 0&&(x.textures=[]);let T={index:C(g)};if(g.HasTransformation()){let I="KHR_texture_transform";x.extensionsUsed===void 0&&(x.extensionsUsed=[]),x.extensionsUsed.indexOf(I)===-1&&x.extensionsUsed.push(I),T.extensions={KHR_texture_transform:{offset:[g.offset.x,-g.offset.y],scale:[g.scale.x,g.scale.y],rotation:-g.rotation}}}return T}let d={name:n.GetExportedMaterialName(l.name),pbrMetallicRoughness:{baseColorFactor:u(l.color,l.opacity)},emissiveFactor:h(l.emissive),doubleSided:!0,alphaMode:"OPAQUE"};l.transparent&&(d.alphaMode="BLEND");let c=f(s,l.diffuseMap,a);if(c!==null&&(l.multiplyDiffuseMap||(d.pbrMetallicRoughness.baseColorFactor=u(new F(255,255,255),l.opacity)),d.pbrMetallicRoughness.baseColorTexture=c),l.type===ee.Physical){let x=f(s,l.metalnessMap,a);x!==null?d.pbrMetallicRoughness.metallicRoughnessTexture=x:(d.pbrMetallicRoughness.metallicFactor=l.metalness,d.pbrMetallicRoughness.roughnessFactor=l.roughness)}let p=f(s,l.normalMap,a);p!==null&&(d.normalTexture=p);let m=f(s,l.emissiveMap,a);m!==null&&(d.emissiveTexture=m),s.materials.push(d)}for(let n=0;n<e.MaterialCount();n++){let s=e.GetMaterial(n);i(this,t,s,r)}}};var Wr=class{constructor(e){this.transformation=new H,this.isMeshVisible=t=>!0,Mt(e,this)}},ur=class{constructor(e,t){this.model=e,this.settings=t||new Wr}MaterialCount(){return this.model.MaterialCount()}GetMaterial(e){return this.model.GetMaterial(e)}VertexCount(){let e=0;return this.EnumerateMeshInstances(t=>{e+=t.VertexCount()}),e}TriangleCount(){let e=0;return this.EnumerateMeshInstances(t=>{e+=t.TriangleCount()}),e}MeshInstanceCount(){let e=0;return this.EnumerateMeshInstances(t=>{e+=1}),e}EnumerateMeshInstances(e){this.model.EnumerateMeshInstances(t=>{this.settings.isMeshVisible(t.GetId())&&e(t)})}EnumerateTransformedMeshes(e){this.EnumerateMeshInstances(t=>{let r=t.GetTransformation();this.settings.transformation.IsIdentity()||r.Append(this.settings.transformation);let n=t.GetMesh().Clone();r.IsIdentity()||Ue(n,r),e(n)})}EnumerateVerticesAndTriangles(e){let t=[];this.EnumerateTransformedMeshes(i=>{t.push(i)});for(let i of t)i.EnumerateVertices(n=>{e.onVertex(n.x,n.y,n.z)});let r=0;for(let i of t)i.EnumerateTriangleVertexIndices((n,s,l)=>{e.onTriangle(n+r,s+r,l+r)}),r+=i.VertexCount()}EnumerateTrianglesWithNormals(e){this.EnumerateTransformedMeshes(t=>{t.EnumerateTriangleVertices((r,i,n)=>{let s=ut(r,i,n);e(r,i,n,s)})})}};var hr=class extends ie{constructor(){super()}CanExport(e,t){return e===L.Text&&t==="obj"}ExportContent(e,t,r,i){function n(p,m,x,g){if(x===null||!x.IsValid())return;let C=Y(x.name);if(p.WriteArrayLine([m,C]),g.findIndex(T=>T.GetName()===C)===-1){let T=new W(C);T.SetBufferContent(x.buffer),g.push(T)}}let s=new W("model.mtl"),l=new W("model.obj");r.push(s),r.push(l);let a=new ue;a.WriteLine(this.GetHeaderText());for(let p=0;p<e.MaterialCount();p++){let m=e.GetMaterial(p);a.WriteArrayLine(["newmtl",this.GetExportedMaterialName(m.name)]),a.WriteArrayLine(["Kd",m.color.r/255,m.color.g/255,m.color.b/255]),a.WriteArrayLine(["d",m.opacity]),m.type===ee.Phong&&(a.WriteArrayLine(["Ka",m.ambient.r/255,m.ambient.g/255,m.ambient.b/255]),a.WriteArrayLine(["Ks",m.specular.r/255,m.specular.g/255,m.specular.b/255]),a.WriteArrayLine(["Ns",m.shininess*1e3])),n(a,"map_Kd",m.diffuseMap,r),m.type===ee.Phong&&n(a,"map_Ks",m.specularMap,r),n(a,"bump",m.bumpMap,r)}s.SetTextContent(a.GetText());let u=new ue;u.WriteLine(this.GetHeaderText()),u.WriteArrayLine(["mtllib",s.GetName()]);let h=0,f=0,d=0,c=null;e.EnumerateTransformedMeshes(p=>{u.WriteArrayLine(["g",this.GetExportedMeshName(p.GetName())]);for(let m=0;m<p.VertexCount();m++){let x=p.GetVertex(m);u.WriteArrayLine(["v",x.x,x.y,x.z])}for(let m=0;m<p.NormalCount();m++){let x=p.GetNormal(m);u.WriteArrayLine(["vn",x.x,x.y,x.z])}for(let m=0;m<p.TextureUVCount();m++){let x=p.GetTextureUV(m);u.WriteArrayLine(["vt",x.x,x.y])}for(let m=0;m<p.TriangleCount();m++){let x=p.GetTriangle(m),g=x.v0+h+1,C=x.v1+h+1,E=x.v2+h+1,T=x.n0+f+1,I=x.n1+f+1,w=x.n2+f+1;if(x.mat!==null){let G=e.GetMaterial(x.mat),B=this.GetExportedMaterialName(G.name);B!==c&&(u.WriteArrayLine(["usemtl",B]),c=B)}let M="",A="",b="";x.HasTextureUVs()&&(M=x.u0+d+1,A=x.u1+d+1,b=x.u2+d+1),u.WriteArrayLine(["f",[g,M,T].join("/"),[C,A,I].join("/"),[E,b,w].join("/")])}h+=p.VertexCount(),f+=p.NormalCount(),d+=p.TextureUVCount()}),l.SetTextContent(u.GetText()),i()}GetHeaderText(){return"# exported by https://3dviewer.net"}};var fr=class extends ie{constructor(){super()}CanExport(e,t){return e===L.Text&&t==="off"}ExportContent(e,t,r,i){let n=new W("model.off");r.push(n);let s=new ue;s.WriteLine("OFF"),s.WriteArrayLine([e.VertexCount(),e.TriangleCount(),0]),e.EnumerateVerticesAndTriangles({onVertex:function(l,a,u){s.WriteArrayLine([l,a,u])},onTriangle:function(l,a,u){s.WriteArrayLine([3,l,a,u])}}),n.SetTextContent(s.GetText()),i()}};var dr=class extends ie{constructor(){super()}CanExport(e,t){return(e===L.Text||e===L.Binary)&&t==="ply"}ExportContent(e,t,r,i){t===L.Text?this.ExportText(e,r):this.ExportBinary(e,r),i()}ExportText(e,t){let r=new W("model.ply");t.push(r);let i=new ue,n=e.VertexCount(),s=e.TriangleCount(),l=this.GetHeaderText("ascii",n,s);i.Write(l),e.EnumerateVerticesAndTriangles({onVertex:function(a,u,h){i.WriteArrayLine([a,u,h])},onTriangle:function(a,u,h){i.WriteArrayLine([3,a,u,h])}}),r.SetTextContent(i.GetText())}ExportBinary(e,t){let r=new W("model.ply");t.push(r);let i=e.VertexCount(),n=e.TriangleCount(),s=this.GetHeaderText("binary_little_endian",i,n),l=s.length+i*3*4+n*(1+3*4),a=new Ie(l,!0);for(let u=0;u<s.length;u++)a.WriteUnsignedCharacter8(s.charCodeAt(u));e.EnumerateVerticesAndTriangles({onVertex:function(u,h,f){a.WriteFloat32(u),a.WriteFloat32(h),a.WriteFloat32(f)},onTriangle:function(u,h,f){a.WriteUnsignedCharacter8(3),a.WriteInteger32(u),a.WriteInteger32(h),a.WriteInteger32(f)}}),r.SetBufferContent(a.GetBuffer())}GetHeaderText(e,t,r){let i=new ue;return i.WriteLine("ply"),i.WriteLine("format "+e+" 1.0"),i.WriteLine("element vertex "+t),i.WriteLine("property float x"),i.WriteLine("property float y"),i.WriteLine("property float z"),i.WriteLine("element face "+r),i.WriteLine("property list uchar int vertex_index"),i.WriteLine("end_header"),i.GetText()}};var mr=class extends ie{constructor(){super()}CanExport(e,t){return(e===L.Text||e===L.Binary)&&t==="stl"}ExportContent(e,t,r,i){t===L.Text?this.ExportText(e,r):this.ExportBinary(e,r),i()}ExportText(e,t){let r=new W("model.stl");t.push(r);let i=new ue;i.WriteLine("solid Model"),e.EnumerateTrianglesWithNormals((n,s,l,a)=>{i.WriteArrayLine(["facet","normal",a.x,a.y,a.z]),i.Indent(1),i.WriteLine("outer loop"),i.Indent(1),i.WriteArrayLine(["vertex",n.x,n.y,n.z]),i.WriteArrayLine(["vertex",s.x,s.y,s.z]),i.WriteArrayLine(["vertex",l.x,l.y,l.z]),i.Indent(-1),i.WriteLine("endloop"),i.Indent(-1),i.WriteLine("endfacet")}),i.WriteLine("endsolid Model"),r.SetTextContent(i.GetText())}ExportBinary(e,t){let r=new W("model.stl");t.push(r);let i=e.TriangleCount(),n=80,s=n+4+i*50,l=new Ie(s,!0);for(let a=0;a<n;a++)l.WriteUnsignedCharacter8(0);l.WriteUnsignedInteger32(i),e.EnumerateTrianglesWithNormals((a,u,h,f)=>{l.WriteFloat32(f.x),l.WriteFloat32(f.y),l.WriteFloat32(f.z),l.WriteFloat32(a.x),l.WriteFloat32(a.y),l.WriteFloat32(a.z),l.WriteFloat32(u.x),l.WriteFloat32(u.y),l.WriteFloat32(u.z),l.WriteFloat32(h.x),l.WriteFloat32(h.y),l.WriteFloat32(h.z),l.WriteUnsignedInteger16(0)}),r.SetBufferContent(l.GetBuffer())}};var Si=class{constructor(){this.exporters=[new hr,new mr,new dr,new fr,new ar,new lr]}AddExporter(e){this.exporters.push(e)}Export(e,t,r,i,n){let s=null;for(let a=0;a<this.exporters.length;a++){let u=this.exporters[a];if(u.CanExport(r,i)){s=u;break}}if(s===null){n.onError();return}let l=new ur(e,t);s.Export(l,r,a=>{a.length===0?n.onError():n.onSuccess(a)})}};var Ai=class extends He{constructor(){super()}CanImportExtension(e){return e==="svg"}GetUpDirection(){return R.Z}GetExternalLibraries(){return["three_loaders/SVGLoader.js"]}CreateLoader(e){return new THREE.SVGLoader(e)}GetMainObject(e){function t(s){let l=s.userData.style;return!(l.fill===void 0||l.fill==="none")}function r(s,l,a){let u=null;for(let h of s)if(h.style===l&&h.opacity===a){u=h.material;break}return u===null&&(u=new THREE.MeshPhongMaterial({color:new THREE.Color().setStyle(l),opacity:a,transparent:a<1}),s.push({style:l,opacity:a,material:u})),u}let i=[],n=new THREE.Object3D;n.rotation.x=Math.PI;for(let s of e.paths){let l=THREE.SVGLoader.createShapes(s);if(t(s)){let a=s.userData.style,u=r(i,a.fill,a.opacity);for(let h of l){let f=new THREE.ExtrudeGeometry(h,{depth:10,bevelEnabled:!1}),d=new THREE.Mesh(f,u);d.name=s.userData.node.id,n.add(d)}}}return n}};return zn(_n);})();
//# sourceMappingURL=o3dv.min-dev.js.map
